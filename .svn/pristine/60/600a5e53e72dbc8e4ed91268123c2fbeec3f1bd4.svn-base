<?xml version="1.0" encoding="GB2312"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="stockReport">
	<typeAlias alias="stockReport"
		type="com.kintiger.platform.stockReport.pojo.StockReport" />
	<typeAlias alias="category"
		type="com.kintiger.platform.stockReport.pojo.Category" />
	<typeAlias alias="stockDate"
		type="com.kintiger.platform.stockReport.pojo.StockDate" />
	<typeAlias alias="kunnrInType"
		type="com.kintiger.platform.stockReport.pojo.KunnrInType" />
	<typeAlias alias="skuPercent"
		type="com.kintiger.platform.stockReport.pojo.SkuPercent" />
	<typeAlias alias="kunag"
		type="com.kintiger.platform.stockReport.pojo.Kunag" />
	<typeAlias alias="salesGoal"
		type="com.kintiger.platform.stockReport.pojo.Goal" />
	<typeAlias alias="stockManager"
		type="com.kintiger.platform.stockReport.pojo.StockManager" />
	<typeAlias alias="stockManagerSap"
		type="com.kintiger.platform.stockReport.pojo.StockManagerSap" />
	<typeAlias alias="pod"
		type="com.kintiger.platform.stockReport.pojo.Pod" />
	<typeAlias alias="orderCheck"
		type="com.kintiger.platform.stockReport.pojo.OrderCheck" />
	<typeAlias alias="kunnrManager"
		type="com.kintiger.platform.stockReport.pojo.KunnrManager" />
	<typeAlias alias="skuUnit"
		type="com.kintiger.platform.stockReport.pojo.SkuUnit" />
	<typeAlias alias="orderFollow"
		type="com.kintiger.platform.stockReport.pojo.OrderFollow" />
	<typeAlias alias="skuDistribution"
		type="com.kintiger.platform.stockReport.pojo.SkuDistribution" />
	<typeAlias alias="user"
		type="com.kintiger.platform.stockReport.pojo.AllUsers" />
	<typeAlias alias="sta"
		type="com.kintiger.platform.stockReport.pojo.Station" />


	<select id="getStockReportListCount" parameterClass="stockReport"
		resultClass="java.lang.Integer">
		<![CDATA[
		select count(*)
		       from crm.crm_tb_kunnr_stock s
		       left join crm.crm_tb_sku sku on sku.sku_id = s.sku_id
		       left join crm.crm_tb_cg cg on cg.sku_category_id = s.sku_category_id
		       left join crm.crm_tb_kunnr k on k.kunnr = s.kunnr
		       left join basis.basis_vw_user_psw u on u.user_id = s.user_id
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       left join basis.basis_tb_materiel m on m.matnr=sku.sku_sap_code
		       where s.status ='U'
		       ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ s.sku_category_id = #categoryId#]]>
		</isNotEmpty>
	    <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ s.create_date >= to_date(#startDate#,'yyyy-mm-dd')]]>
		</isNotEmpty>
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date <=to_date(#endDate#,'yyyy-mm-dd')+1]]>
		</isNotEmpty>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isEmpty property="flag" prepend="and">
			<![CDATA[ s.flag in ('kunnr_week','kunnr_month')]]>
		</isEmpty>
		<isNotEmpty property="userName" prepend="and">
			<![CDATA[ u.user_name like #userName,handler=wildcard# escape '\']]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		<isNotEmpty property="userTypes" prepend="and">
			<![CDATA[ s.user_type in ]]>
			<iterate property="userTypes" open="(" close=")" conjunction=",">#userTypes[]#
		    </iterate>
		</isNotEmpty>
		<isNotEmpty property="kunnrs" prepend="and">
			<![CDATA[ s.kunnr in ]]>
			<iterate property="kunnrs" open="(" close=")" conjunction=",">#kunnrs[]#
		    </iterate>
		</isNotEmpty>
		<isNotEmpty property="checkTime" prepend="and">
			<![CDATA[ s.check_time = #checkTime#]]>
		</isNotEmpty>
		<isNotEmpty property="productionDate" prepend="and">
			<![CDATA[ s.production_date = #productionDate#]]>
		</isNotEmpty>
		<isNotEmpty property="brand" prepend="and">
			<![CDATA[ m.matnr01 = #brand#]]>
		</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="getStockReportList" parameterClass="stockReport"
		resultClass="stockReport">
		<include refid="global.paginationStart" />
		<![CDATA[
		select s.id as stockId,
		       s.kunnr as kunnr,
		       k.name1 as kunnrName,
		       s.sku_id as skuId,
		       sku.sku_name as skuName,
		       sku.sku_code as skuCode,
		       s.user_id as userId,
		       u.user_name as userName,
		       s.create_date as createDate,
		       s.production_date as productionDate,
		       s.check_time as checkTime,
		       s.sku_category_id as categoryId,
		       cg.category_name as categoryName,
		       s.quantity as quantity,
		       s.unitdesc as unitDesc,
		       s.flag as flag,
		       ot.p_org_name as orgProvince,
		       ot.org_name as orgCity,
		       ot.rc_org_name as orgRegion,
		       kk.kunag as kunag,
		       kk.name2 as kunagName,
		       m.matnr01 as brand,
		       m.maktx01 as brandName
		       from crm.crm_tb_kunnr_stock s
		       left join crm.crm_tb_sku sku on sku.sku_id = s.sku_id
		       left join crm.crm_tb_cg cg on cg.sku_category_id = sku.sku_category_id
		       left join basis.basis_vw_user_psw u on u.user_id = s.user_id
		       left join crm.crm_tb_kunnr k on k.kunnr = s.kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       left join crm.crm_tb_kunnr_kunag kk on kk.kunnr=k.kunnr
		       left join basis.basis_tb_materiel m on m.matnr=sku.sku_sap_code
		       where s.status ='U'
		       ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ s.sku_category_id = #categoryId#]]>
		</isNotEmpty>
	    <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ s.create_date >= to_date(#startDate#,'yyyy-mm-dd')]]>
		</isNotEmpty>
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date <=to_date(#endDate#,'yyyy-mm-dd')+1]]>
		</isNotEmpty>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isEmpty property="flag" prepend="and">
			<![CDATA[ s.flag in ('kunnr_week','kunnr_month')]]>
		</isEmpty>
		<isNotEmpty property="userName" prepend="and">
			<![CDATA[ u.user_name like #userName,handler=wildcard# escape '\']]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		<isNotEmpty property="userTypes" prepend="and">
			<![CDATA[ s.user_type in ]]>
			<iterate property="userTypes" open="(" close=")" conjunction=",">#userTypes[]#
		    </iterate>
		</isNotEmpty>
		<isNotEmpty property="kunnrs" prepend="and">
			<![CDATA[ s.kunnr in ]]>
			<iterate property="kunnrs" open="(" close=")" conjunction=",">#kunnrs[]#
		    </iterate>
		</isNotEmpty>
		<isNotEmpty property="brand" prepend="and">
			<![CDATA[ m.matnr01 = #brand#]]>
		</isNotEmpty>
	    </dynamic>
			<![CDATA[order by s.create_date desc,s.kunnr,s.id]]>
		<include refid="global.paginationEnd" />
	</select>
	<select id="getStockStateManagerCount" parameterClass="stockReport"
		resultClass="java.lang.Integer">
		<![CDATA[
		select count(*)
			  from crm.crm_tb_kunnr_stock_safety s,
                    crm.crm_tb_kunnr_stock_safety ss
			   left join crm.crm_tb_sku sku on  sku.sku_id=ss.sku_id
			   left join crm.crm_tb_cg cg on cg.sku_category_id = sku.sku_category_id
			   left join crm.crm_tb_kunnr k on k.kunnr = ss.kunnr
			   left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
			   left join crm.crm_tb_sku_unitcoefficient un on un.sku_id=ss.sku_id
 			   where s.kunnr=ss.kunnr	and s.sku_id=ss.sku_id
 			   and s.safety_year=ss.safety_year 
               and s.safety_month=ss.safety_month 
               and s.is_limit='Y' and ss.is_limit='N'
               and s.status='U' and ss.status='U'
		       ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ sku.sku_category_id = #categoryId#]]>
		</isNotEmpty>
		<isNotEmpty property="searchYear" prepend="and">
			<![CDATA[ s.safety_year = #searchYear#]]>
		</isNotEmpty>
	    <isNotEmpty property="searchMonth" prepend="and">
			<![CDATA[ s.safety_month = #searchMonth#]]>
		</isNotEmpty>
		<!-- 
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date in(select max(ss.create_date)
                       from crm.crm_tb_kunnr_stock ss  group by ss.kunnr,ss.sku_id 
                       HAVING  max(ss.create_date)<=to_date(#endDate#,'yyyy-MM-dd-HH24-mi-ss')) ]]>
		</isNotEmpty>
		 
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userName" prepend="and">
			<![CDATA[ si.emp_name like #userName,handler=wildcard# escape '\']]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		-->
	    </dynamic>
	</select>
	
	<select id="getStockStateManagerList" parameterClass="stockReport"
		resultClass="stockReport">
		<!-- 
		<include refid="global.paginationStart" />
		 -->
		<![CDATA[
		select ot.rc_org_name as orgRegion,
		       ot.rc_org_id as orgRegionId,
               ot.p_org_name as orgProvince,
               ot.p_org_id as orgProvinceId,
               ot.org_name as orgCity,
               ot.org_id as orgCityId,
         	   s.kunnr as  kunnr,
               k.name1 as kunnrName,
               s.sku_id as skuId,
               sku.sku_name as skuName,
               sku.sku_sap_code as skuSapCode,
               sku.sku_category_id as categoryId,
               cg.category_name as categoryName,
               s.safety_year as searchYear,
 			   s.safety_month as searchMonth,
			   s.quantity as safeQuantityMax,
 			   ss.quantity as safeQuantityMin,
 			   un.sku_unit_coefficient as coefficient,
 			   nvl(h.latest_stock,0) as quantity
			   from crm.crm_tb_kunnr_stock_safety s
               inner join crm.crm_tb_kunnr_stock_safety ss 
               on s.kunnr=ss.kunnr	
               and s.sku_id=ss.sku_id
 			   and s.safety_year=ss.safety_year 
               and s.safety_month=ss.safety_month 
               and s.is_limit='Y' and ss.is_limit='N'
               and s.status='U' and ss.status='U'
			   left join crm.crm_tb_sku sku on  sku.sku_id=ss.sku_id
			   left join crm.crm_tb_cg cg on cg.sku_category_id = sku.sku_category_id
			   left join crm.crm_tb_kunnr k on k.kunnr = ss.kunnr
			   left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
			   left join crm.crm_tb_sku_unitcoefficient un on un.sku_id=ss.sku_id
			   left join hana_distribution_sku h on h.sku_id=un.sku_id
               and h.year=ss.safety_year and h.month=ss.safety_month
               and substr(h.kunnr,-length(ss.kunnr))=ss.kunnr
 			   where 1=1
		       ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ sku.sku_category_id = #categoryId#]]>
		</isNotEmpty>
		<isNotEmpty property="searchYear" prepend="and">
			<![CDATA[ s.safety_year = #searchYear#]]>
		</isNotEmpty>
	    <isNotEmpty property="searchMonth" prepend="and">
			<![CDATA[ s.safety_month = #searchMonth#]]>
		</isNotEmpty>
		<!-- 
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date in(select max(ss.create_date)
                       from crm.crm_tb_kunnr_stock ss  group by ss.kunnr,ss.sku_id 
                       HAVING  max(ss.create_date)<=to_date(#endDate#,'yyyy-MM-dd-HH24-mi-ss')) ]]>
		</isNotEmpty>
		
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userName" prepend="and">
			<![CDATA[ si.emp_name like #userName,handler=wildcard# escape '\']]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		 -->
	    </dynamic>
			<![CDATA[order by ot.rc_org_name,ot.p_org_name,ot.org_name, k.name1,sku.sku_name]]>
		<!-- 
		<include refid="global.paginationEnd" />
		 -->
	</select>
	
	<select id="getStockWarningListCount" parameterClass="stockReport" resultClass="java.lang.Integer">
		<![CDATA[
		select count(*)
			   from (select w.kunnr as kunnr,
               sum(w.required_quantity) as needOrder,
               sum(w.fact_quantity) as factOrder,
               max(w.required_Date) as endDate,
               max(w.fact_lastDate) as orderDate
          from crm.crm_tb_stock_warning w
         where 1=1
         ]]>
         <dynamic>
	    <isNotEmpty property="flag" prepend="and">
			<![CDATA[ w.flag =#flag#]]>
		</isNotEmpty>
         <isNotEmpty property="endDate" prepend="and">
			<![CDATA[ w.required_Date =(select a.required_date from (select b.required_date required_date
                       from crm.crm_tb_stock_warning b 
                       where  b.required_date<=to_date(#endDate#,'yyyy-MM-dd HH24-mi-ss') and flag=#flag#
                        order by b.required_date desc) a where rownum=1 )]]>
		</isNotEmpty>
          </dynamic>
          <![CDATA[
         group by w.kunnr) sw
			   left join crm.crm_tb_kunnr k on k.kunnr = sw.kunnr
			   left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
 			   where 1=1
		       ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ sw.kunnr = #kunnr#]]>
		</isNotEmpty>
	    </dynamic>
	    <![CDATA[order by ot.rc_org_name,ot.p_org_name,ot.org_name, k.name1]]>
	
	</select>
	
	<select id="getStockWarningList" parameterClass="stockReport"
		resultClass="stockReport">
		<!-- 
		<include refid="global.paginationStart" />
		 -->
		<![CDATA[
		select ot.rc_org_name as orgRegion,
               ot.p_org_name as orgProvince,
               ot.org_name as orgCity,
         	   sw.kunnr as  kunnr,
               k.name1 as kunnrName,
               sw.endDate as endDate,
               nvl(sw.needOrder,0.0) as needOrder, 
			   sw.orderDate as orderDate,
			   nvl(sw.factOrder,0.0) as factOrder
			   from (select w.kunnr as kunnr,
               sum(w.required_quantity) as needOrder,
               sum(w.fact_quantity) as factOrder,
               max(w.required_Date) as endDate,
               max(w.fact_lastDate) as orderDate
          from crm.crm_tb_stock_warning w
         where 1=1
         ]]>
         <dynamic>
	    <isNotEmpty property="flag" prepend="and">
			<![CDATA[ w.flag =#flag#]]>
		</isNotEmpty>
         <isNotEmpty property="endDate" prepend="and">
			<![CDATA[ w.required_Date =(select a.required_date from (select b.required_date required_date
                       from crm.crm_tb_stock_warning b 
                       where  b.required_date<=to_date(#endDate#,'yyyy-MM-dd HH24-mi-ss') and flag=#flag#
                        order by b.required_date desc) a where rownum=1 )]]>
		</isNotEmpty>
          </dynamic>
          <![CDATA[
         group by w.kunnr) sw
			   left join crm.crm_tb_kunnr k on k.kunnr = sw.kunnr
			   left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
 			   where 1=1
		       ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ sw.kunnr = #kunnr#]]>
		</isNotEmpty>
	    </dynamic>
			<![CDATA[order by ot.rc_org_name,ot.p_org_name,ot.org_name, k.name1]]>
		<!-- 
		<include refid="global.paginationEnd" />
		 -->
	</select>
	<select id="getStockWarningDetailList" parameterClass="stockReport"
		resultClass="stockReport">
		<!-- 
		<include refid="global.paginationStart" />
		 -->
		<![CDATA[
		select w.warning_id stockId,
       w.kunnr kunnr,
       w.name1 kunnrName,
       w.kunnr_sku skuId,
       w.skuName skuName,
       w.required_date endDate,
       w.required_quantity needOrder,
       w.fact_lastDate orderDate,
       w.fact_quantity factOrder,
       w.flag flag,
       w.userId userId,
       w.userName userName,
       w.unit_coefficient coefficient,
       sku.sku_sap_code  skuSapCode
       from crm.crm_tb_stock_warning w 
       left join crm.crm_tb_sku sku on  sku.sku_id=w.kunnr_sku
         where 1=1
         ]]>
         <dynamic>
	    <isNotEmpty property="flag" prepend="and">
			<![CDATA[ w.flag =#flag#]]>
		</isNotEmpty>
         <isNotEmpty property="endDate" prepend="and">
			<![CDATA[ w.required_Date =(select a.required_date from (select b.required_date required_date
                       from crm.crm_tb_stock_warning b 
                       where  b.required_date<=to_date(#endDate#,'yyyy-MM-dd HH24-mi-ss') and flag=#flag#
                        order by b.required_date) a where rownum=1 )]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ sw.kunnr = #kunnr#]]>
		</isNotEmpty>
          </dynamic>
         
		<!-- 
		<include refid="global.paginationEnd" />
		 -->
	</select>
	<select id="getStockReportListCountTotal" parameterClass="stockReport" resultClass="java.lang.Integer">
	    select count(*)
	           from crm.crm_vw_kunnr_stock s
	           where 1=1
	    <dynamic>
		<isNotEmpty property="checkTime" prepend="and">
			<![CDATA[ s.check_time = #checkTime#]]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		<isNotEmpty property="status" prepend="and">
			<![CDATA[ s.status = #status#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr=#kunnr#]]>
		</isNotEmpty>
		<isNotEmpty property="kunag" prepend="and">
			<![CDATA[ s.kunnr in (select k.kunnr from crm.crm_tb_kunnr_kunag k where k.kunag=#kunag#)]]>
		</isNotEmpty>
		</dynamic>
	</select>
	<insert id="createStockWarning" parameterClass="StockReport">
	    <selectKey resultClass="java.lang.Integer" keyProperty="warningId">
		<![CDATA[
			select crm.crm_seq_stock_warning.nextval as warningId from dual
		]]>
		</selectKey>
		 <![CDATA[
		insert into crm.crm_tb_stock_warning
		  (warning_id,
		   kunnr,
		   name1,
		   kunnr_sku,
		   skuName,
		   required_date,
		   required_quantity,
		   fact_lastDate,
		   fact_quantity,
		   flag,
		   create_date,
		   userid,
		   userName)
		   values 
		   (#warningId#,
		   #kunnr#,
		   #kunnrName#,
		   #skuId#,
		   #skuName#,
		   to_date(#endDate#,'yyyy-MM-dd HH24:mi:ss'),
		   #needOrder#,
		   null,
		   null,
		   'S',
		   sysdate,
		   #userId#,
		   #userName#)
     ]]>
	</insert>
	<update id="modifyStockWarning" parameterClass="stockReport">
	    <![CDATA[ update crm.crm_tb_stock_warning ]]>
	    <dynamic prepend="set">
	    <isNotEmpty property="factOrder" prepend=",">
			<![CDATA[ fact_quantity=#factOrder#]]>
		</isNotEmpty>
		<isNotEmpty property="orderDate" prepend=",">
			<![CDATA[ fact_lastDate=to_date(#orderDate#,'yyyy-MM-dd HH24:mi:ss')]]>
		</isNotEmpty>
		 <isNotEmpty property="flag" prepend=",">
			<![CDATA[ flag=#flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userId" prepend=",">
			<![CDATA[ userId=#userId#]]>
		</isNotEmpty>
		<isNotEmpty property="userName" prepend=",">
			<![CDATA[ userName=#userName#]]>
		</isNotEmpty>
		</dynamic>
	    <![CDATA[where warning_id=#stockId#]]>
	</update>
	<select id="getKunnrByStockIds" parameterClass="stockReport" resultClass="stockReport">
	    select distinct 
	           t.kunnr as kunnr,
	           t.check_time as checkTime,
	           t.flag as flag,
	           t.user_type as userType
	           from crm.crm_tb_kunnr_stock t 
	           where 1=1
	    <dynamic>
	    <isNotEmpty property="stockIds" prepend="and">
			<![CDATA[ t.id in ]]>
			<iterate property="stockIds" open="(" close=")" conjunction=",">#stockIds[]#
		    </iterate>
		</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="getStockReportKunnrAndKunagSum" parameterClass="stockReport" resultClass="java.lang.String">
	    select to_char(sum(t.quantity))
	           from crm.crm_tb_kunnr_stock t
	           where t.status='U'
	    <dynamic>
	    <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr=#kunnr#]]>
		</isNotEmpty>
		<isNotEmpty property="kunag" prepend="and">
			<![CDATA[ t.kunnr in (select k.kunnr from crm.crm_tb_kunnr_kunag k where k.kunag=#kunag#)]]>
		</isNotEmpty>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ t.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ t.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ t.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ t.user_type = #userType#]]>
		</isNotEmpty>
		</dynamic>
	</select>
	
	<update id="updateStockReport" parameterClass="stockReport">
	    <![CDATA[ update crm.crm_tb_kunnr_stock s ]]>
	    <dynamic prepend="set">
	    <isNotEmpty property="quantity" prepend=",">
			<![CDATA[ s.quantity=#quantity#]]>
		</isNotEmpty>
		<isNotEmpty property="status" prepend=",">
			<![CDATA[ s.status=#status#]]>
		</isNotEmpty>
		</dynamic>
	    <![CDATA[ where s.id=#stockId# ]]>
	</update>
	
	<update id="updateStockReportTotal" parameterClass="stockReport">
	    <![CDATA[ update crm.crm_tb_kunnr_stock_total s]]>
	    <dynamic prepend="set">
	    <isNotEmpty property="quantity" prepend=",">
			<![CDATA[ s.quantity=#quantity#]]>
		</isNotEmpty>
		<isNotEmpty property="status" prepend=",">
			<![CDATA[ s.status=#status#]]>
		</isNotEmpty>
		</dynamic>
	    <dynamic prepend="where">
	    <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr=#kunnr#]]>
		</isNotEmpty>
		<isNotEmpty property="checkTime" prepend="and">
			<![CDATA[ s.check_time=#checkTime#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag=#flag#]]>
		</isNotEmpty>
		<isNotEmpty property="stockId" prepend="and">
			<![CDATA[ s.id=#stockId#]]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type=#userType#]]>
		</isNotEmpty>
		<isNotEmpty property="statusBefore" prepend="and">
			<![CDATA[ s.status=#statusBefore#]]>
		</isNotEmpty>
		<isNotEmpty property="kunag" prepend="and">
			<![CDATA[ s.kunnr in (select k.kunnr from crm.crm_tb_kunnr_kunag k where k.kunag=#kunag#)]]>
		</isNotEmpty>
		</dynamic>
	</update>
	
	<insert id="createStockReport" parameterClass="stockReport">
		<selectKey resultClass="java.lang.Integer" keyProperty="stockId">
		<![CDATA[
			select crm.crm_seq_kunnr_stock.nextval as stockId from dual
		]]>
		</selectKey>
	<![CDATA[
		insert into crm.crm_tb_kunnr_stock
		  (id,
		   kunnr,
		   sku_id,
		   sku_category_id,
		   production_date,
		   check_time,
		   unitdesc,
		   quantity,
		   flag,
		   status,
		   create_date,
		   user_id,
		   user_type)
		values
		  (#stockId#,
		   #kunnr#,
		   #skuId#,
		   #categoryId#,
		   #productionDate#,
		   #checkTime#,
		   'Ïä',
		   #quantity#,
		   #flag#,
		   'U',
		   sysdate,
		   #userId#,
		   #userType#)
	]]>
	</insert>
	
	<insert id="createStockReportTotal" parameterClass="stockReport">
	<![CDATA[
		insert into crm.crm_tb_kunnr_stock_total
		  (id,
		   kunnr,
		   sku_id,
		   sku_category_id,
		   production_date,
		   check_time,
		   unitdesc,
		   quantity,
		   flag,
		   status,
		   create_date,
		   user_id,
		   user_type)
		values
		  (#stockId#,
		   #kunnr#,
		   #skuId#,
		   #categoryId#,
		   #productionDate#,
		   #checkTime#,
		   'Ïä',
		   #quantity#,
		   #flag#,
		   #status#,
		   sysdate,
		   #userId#,
		   #userType#)
	]]>
	</insert>
	
	<select id="getStockReportByCGListCount" parameterClass="stockReport"
		resultClass="java.lang.Integer">
		<![CDATA[select count(*)
		       from (
		       select s.kunnr as kunnr,
		       max(s.unitdesc) as unitDesc,
		       s.check_time as checkTime,
               sum(decode(s.sku_category_id,'1002',s.quantity,'')) as cg1,
               sum(decode(s.sku_category_id,'1869',s.quantity,'')) as cg2,
               sum(decode(s.sku_category_id,'1007',s.quantity,'')) as cg3,
               sum(decode(s.sku_category_id,'1895',s.quantity,'')) as cg4,
               sum(decode(s.sku_category_id,'1008',s.quantity,'')) as cg5,
               sum(decode(s.sku_category_id,'1894',s.quantity,'')) as cg6,
               sum(decode(s.sku_category_id,'1893',s.quantity,'')) as cg7,
               sum(decode(s.sku_category_id,'1006',s.quantity,'')) as cg8,
               sum(decode(s.sku_category_id,'1003',s.quantity,'')) as cg9,
               sum(decode(s.sku_category_id,'1890',s.quantity,'')) as cg10,
               sum(decode(s.sku_category_id,'1891',s.quantity,'')) as cg11,
               sum(decode(s.sku_category_id,'1892',s.quantity,'')) as cg12,
               sum(decode(s.sku_category_id,'1004',s.quantity,'')) as cg13,
               sum(decode(s.sku_category_id,'1889',s.quantity,'')) as cg14,
               sum(decode(s.sku_category_id,'1888',s.quantity,'')) as cg15,
               sum(decode(s.sku_category_id,'1887',s.quantity,'')) as cg16,
               sum(decode(s.sku_category_id,'1883',s.quantity,'')) as cg17,
               sum(decode(s.sku_category_id,'1886',s.quantity,'')) as cg18,
               sum(decode(s.sku_category_id,'1884',s.quantity,'')) as cg19,
               sum(decode(s.sku_category_id,'1009',s.quantity,'')) as cg20,
               sum(decode(s.sku_category_id,'1897',s.quantity,'')) as cg21,
               sum(decode(s.sku_category_id,'1898',s.quantity,'')) as cg22,
               sum(decode(s.sku_category_id,'1899',s.quantity,'')) as cg23,
               sum(decode(s.sku_category_id,'1900',s.quantity,'')) as cg24,
               sum(decode(s.sku_category_id,'1901',s.quantity,'')) as cg25,
               sum(decode(s.sku_category_id,'1902',s.quantity,'')) as cg26,
               sum(decode(s.sku_category_id,'1903',s.quantity,'')) as cg27,
               sum(decode(s.sku_category_id,'1904',s.quantity,'')) as cg28,
               sum(decode(s.sku_category_id,'1942',s.quantity,'')) as cg29
               from crm.crm_tb_kunnr_stock s
               left join crm.crm_tb_kunnr_kunag kg on kg.kunnr = s.kunnr
               left join basis.basis_tb_salesemp_info e on s.user_id = e.emp_id 
               where kg.kunag is null and s.flag in ('kunnr_week','kunnr_month')
                     and s.status='U'
                     and e.org_id not in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = '51237'
				         connect by prior b.org_id= b.org_parent_id)
		       ]]>
		<dynamic>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		</dynamic>
			<![CDATA[  group by s.kunnr,s.check_time]]>
		
		union all
		
		<![CDATA[
		select kg1.kunag as kunnr,
		       max(ss.unitdesc) as unitDesc,
		       ss.check_time as checkTime,
               sum(decode(ss.sku_category_id,'1002',ss.quantity,'')) as cg1,
               sum(decode(ss.sku_category_id,'1869',ss.quantity,'')) as cg2,
               sum(decode(ss.sku_category_id,'1007',ss.quantity,'')) as cg3,
               sum(decode(ss.sku_category_id,'1895',ss.quantity,'')) as cg4,
               sum(decode(ss.sku_category_id,'1008',ss.quantity,'')) as cg5,
               sum(decode(ss.sku_category_id,'1894',ss.quantity,'')) as cg6,
               sum(decode(ss.sku_category_id,'1893',ss.quantity,'')) as cg7,
               sum(decode(ss.sku_category_id,'1006',ss.quantity,'')) as cg8,
               sum(decode(ss.sku_category_id,'1003',ss.quantity,'')) as cg9,
               sum(decode(ss.sku_category_id,'1890',ss.quantity,'')) as cg10,
               sum(decode(ss.sku_category_id,'1891',ss.quantity,'')) as cg11,
               sum(decode(ss.sku_category_id,'1892',ss.quantity,'')) as cg12,
               sum(decode(ss.sku_category_id,'1004',ss.quantity,'')) as cg13,
               sum(decode(ss.sku_category_id,'1889',ss.quantity,'')) as cg14,
               sum(decode(ss.sku_category_id,'1888',ss.quantity,'')) as cg15,
               sum(decode(ss.sku_category_id,'1887',ss.quantity,'')) as cg16,
               sum(decode(ss.sku_category_id,'1883',ss.quantity,'')) as cg17,
               sum(decode(ss.sku_category_id,'1886',ss.quantity,'')) as cg18,
               sum(decode(ss.sku_category_id,'1884',ss.quantity,'')) as cg19,
               sum(decode(ss.sku_category_id,'1009',ss.quantity,'')) as cg20,
               sum(decode(ss.sku_category_id,'1897',ss.quantity,'')) as cg21,
               sum(decode(ss.sku_category_id,'1898',ss.quantity,'')) as cg22,
               sum(decode(ss.sku_category_id,'1899',ss.quantity,'')) as cg23,
               sum(decode(ss.sku_category_id,'1900',ss.quantity,'')) as cg24,
               sum(decode(ss.sku_category_id,'1901',ss.quantity,'')) as cg25,
               sum(decode(ss.sku_category_id,'1902',ss.quantity,'')) as cg26,
               sum(decode(ss.sku_category_id,'1903',ss.quantity,'')) as cg27,
               sum(decode(ss.sku_category_id,'1904',ss.quantity,'')) as cg28,
               sum(decode(ss.sku_category_id,'1942',ss.quantity,'')) as cg29
               from crm.crm_tb_kunnr_stock ss
               left join crm.crm_tb_kunnr_kunag kg1 on kg1.kunnr = ss.kunnr 
               left join basis.basis_tb_salesemp_info ee on ss.user_id = ee.emp_id
               where kg1.kunag is not null and ss.flag in ('kunnr_week','kunnr_month')
                     and ss.status='U'
                     and ee.org_id not in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = '51237'
				         connect by prior b.org_id= b.org_parent_id)
		       ]]>
		<dynamic>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ ss.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ ss.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		</dynamic>
			<![CDATA[  group by kg1.kunag,ss.check_time ) t 
		       left join crm.crm_tb_kunnr k on k.kunnr = t.kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       where 1=1
		    ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="getStockReportByCGList" parameterClass="stockReport"
		resultClass="stockReport">
		<include refid="global.paginationStart" />
		<![CDATA[select t.*,
		       k.name1 as kunnrName,
		       ot.p_org_name as orgProvince,
		       ot.org_name as orgCity,
		       ot.rc_org_name as orgRegion
		       from (
		       select s.kunnr as kunnr,
		       max(s.unitdesc) as unitDesc,
		       s.check_time as checkTime,
               sum(decode(s.sku_category_id,'1002',s.quantity,'')) as cg1,
               sum(decode(s.sku_category_id,'1869',s.quantity*1.2,'')) as cg2,
               sum(decode(s.sku_category_id,'1007',s.quantity,'')) as cg3,
               sum(decode(s.sku_category_id,'1895',s.quantity*3.2,'')) as cg4,
               sum(decode(s.sku_category_id,'1008',s.quantity*2.67,'')) as cg5,
               sum(decode(s.sku_category_id,'1894',s.quantity*3.2,'')) as cg6,
               sum(decode(s.sku_category_id,'1893',s.quantity*3,'')) as cg7,
               sum(decode(s.sku_category_id,'1006',s.quantity,'')) as cg8,
               sum(decode(s.sku_category_id,'1003',s.quantity,'')) as cg9,
               sum(decode(s.sku_category_id,'1890',s.quantity,'')) as cg10,
               sum(decode(s.sku_category_id,'1891',s.quantity*3.2,'')) as cg11,
               sum(decode(s.sku_category_id,'1892',s.quantity,'')) as cg12,
               sum(decode(s.sku_category_id,'1004',s.quantity,'')) as cg13,
               sum(decode(s.sku_category_id,'1889',s.quantity*3.2,'')) as cg14,
               sum(decode(s.sku_category_id,'1888',s.quantity*3,'')) as cg15,
               sum(decode(s.sku_category_id,'1887',s.quantity,'')) as cg16,
               sum(decode(s.sku_category_id,'1883',s.quantity*3,'')) as cg17,
               sum(decode(s.sku_category_id,'1886',s.quantity,'')) as cg18,
               sum(decode(s.sku_category_id,'1884',s.quantity*2.4,'')) as cg19,
               sum(decode(s.sku_category_id,'1009',s.quantity,'')) as cg20,
               sum(decode(s.sku_category_id,'1897',s.quantity,'')) as cg21,
               sum(decode(s.sku_category_id,'1898',s.quantity,'')) as cg22,
               sum(decode(s.sku_category_id,'1899',s.quantity,'')) as cg23,
               sum(decode(s.sku_category_id,'1900',s.quantity,'')) as cg24,
               sum(decode(s.sku_category_id,'1901',s.quantity,'')) as cg25,
               sum(decode(s.sku_category_id,'1902',s.quantity,'')) as cg26,
               sum(decode(s.sku_category_id,'1903',s.quantity,'')) as cg27,
               sum(decode(s.sku_category_id,'1904',s.quantity,'')) as cg28,
               sum(decode(s.sku_category_id,'1942',s.quantity,'')) as cg29
               from crm.crm_tb_kunnr_stock s
               left join crm.crm_tb_kunnr_kunag kg on kg.kunnr = s.kunnr 
               left join basis.basis_tb_salesemp_info e on s.user_id = e.emp_id 
               where kg.kunag is null and s.flag in ('kunnr_week','kunnr_month')
                     and s.status='U'
                     and e.org_id not in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = '51237'
				         connect by prior b.org_id= b.org_parent_id)
		       ]]>
		<dynamic>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		</dynamic>
			<![CDATA[  group by s.kunnr,s.check_time]]>
		
		union all
		
		<![CDATA[
		select kg1.kunag as kunnr,
		       max(ss.unitdesc) as unitDesc,
		       ss.check_time as checkTime,
               sum(decode(ss.sku_category_id,'1002',ss.quantity,'')) as cg1,
               sum(decode(ss.sku_category_id,'1869',ss.quantity*1.2,'')) as cg2,
               sum(decode(ss.sku_category_id,'1007',ss.quantity,'')) as cg3,
               sum(decode(ss.sku_category_id,'1895',ss.quantity*3.2,'')) as cg4,
               sum(decode(ss.sku_category_id,'1008',ss.quantity*2.67,'')) as cg5,
               sum(decode(ss.sku_category_id,'1894',ss.quantity*3.2,'')) as cg6,
               sum(decode(ss.sku_category_id,'1893',ss.quantity*3,'')) as cg7,
               sum(decode(ss.sku_category_id,'1006',ss.quantity,'')) as cg8,
               sum(decode(ss.sku_category_id,'1003',ss.quantity,'')) as cg9,
               sum(decode(ss.sku_category_id,'1890',ss.quantity,'')) as cg10,
               sum(decode(ss.sku_category_id,'1891',ss.quantity*3.2,'')) as cg11,
               sum(decode(ss.sku_category_id,'1892',ss.quantity,'')) as cg12,
               sum(decode(ss.sku_category_id,'1004',ss.quantity,'')) as cg13,
               sum(decode(ss.sku_category_id,'1889',ss.quantity*3.2,'')) as cg14,
               sum(decode(ss.sku_category_id,'1888',ss.quantity*3,'')) as cg15,
               sum(decode(ss.sku_category_id,'1887',ss.quantity,'')) as cg16,
               sum(decode(ss.sku_category_id,'1883',ss.quantity*3,'')) as cg17,
               sum(decode(ss.sku_category_id,'1886',ss.quantity,'')) as cg18,
               sum(decode(ss.sku_category_id,'1884',ss.quantity*2.4,'')) as cg19,
               sum(decode(ss.sku_category_id,'1009',ss.quantity,'')) as cg20,
               sum(decode(ss.sku_category_id,'1897',ss.quantity,'')) as cg21,
               sum(decode(ss.sku_category_id,'1898',ss.quantity,'')) as cg22,
               sum(decode(ss.sku_category_id,'1899',ss.quantity,'')) as cg23,
               sum(decode(ss.sku_category_id,'1900',ss.quantity,'')) as cg24,
               sum(decode(ss.sku_category_id,'1901',ss.quantity,'')) as cg25,
               sum(decode(ss.sku_category_id,'1902',ss.quantity,'')) as cg26,
               sum(decode(ss.sku_category_id,'1903',ss.quantity,'')) as cg27,
               sum(decode(ss.sku_category_id,'1904',ss.quantity,'')) as cg28,
               sum(decode(ss.sku_category_id,'1942',ss.quantity,'')) as cg29
               from crm.crm_tb_kunnr_stock ss
               left join crm.crm_tb_kunnr_kunag kg1 on kg1.kunnr = ss.kunnr 
               left join basis.basis_tb_salesemp_info ee on ss.user_id = ee.emp_id 
               where kg1.kunag is not null and ss.flag in ('kunnr_week','kunnr_month')
                     and ss.status='U'
                     and ee.org_id not in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = '51237'
				         connect by prior b.org_id= b.org_parent_id)
		       ]]>
		<dynamic>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ ss.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ ss.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		</dynamic>
			<![CDATA[  group by kg1.kunag,ss.check_time) t 
		       left join crm.crm_tb_kunnr k on k.kunnr = t.kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       where 1=1
		    ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
		</dynamic>
		    <![CDATA[ order by t.kunnr]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="getStockReportBySkuListCount" parameterClass="stockReport"
		resultClass="java.lang.Integer">
		<![CDATA[select count(*)
		       from (
		       select s.kunnr as kunnr,
		       max(s.unitdesc) as unitDesc,
		       s.check_time as checkTime,
               sum(decode(s.sku_id,'24',s.quantity,'')) as sku1,
               sum(decode(s.sku_id,'25',s.quantity,'')) as sku2,
               sum(decode(s.sku_id,'26',s.quantity,'')) as sku3,
               sum(decode(s.sku_id,'27',s.quantity,'')) as sku4,
               sum(decode(s.sku_id,'28',s.quantity,'')) as sku5,
               sum(decode(s.sku_id,'29',s.quantity,'')) as sku6,
               sum(decode(s.sku_id,'30',s.quantity,'')) as sku7,
               sum(decode(s.sku_id,'31',s.quantity,'')) as sku8,
               sum(decode(s.sku_id,'32',s.quantity*3.2,'')) as sku9,
               sum(decode(s.sku_id,'33',s.quantity*3,'')) as sku10,
               sum(decode(s.sku_id,'34',s.quantity*2.67,'')) as sku11,
               sum(decode(s.sku_id,'35',s.quantity,'')) as sku12,
               sum(decode(s.sku_id,'36',s.quantity*3.2,'')) as sku13,
               sum(decode(s.sku_id,'37',s.quantity,'')) as sku14,
               sum(decode(s.sku_id,'38',s.quantity*3,'')) as sku15,
               sum(decode(s.sku_id,'56',s.quantity,'')) as sku16,
               sum(decode(s.sku_id,'100',s.quantity,'')) as sku17,
               sum(decode(s.sku_id,'101',s.quantity,'')) as sku18,
               sum(decode(s.sku_id,'102',s.quantity,'')) as sku19,
               sum(decode(s.sku_id,'103',s.quantity,'')) as sku20,
               sum(decode(s.sku_id,'5031',s.quantity*3,'')) as sku21,
               sum(decode(s.sku_id,'5032',s.quantity*3.2,'')) as sku22,
               sum(decode(s.sku_id,'5033',s.quantity,'')) as sku23,
               sum(decode(s.sku_id,'5034',s.quantity*1.2,'')) as sku24,
               sum(decode(s.sku_id,'5035',s.quantity*1.2,'')) as sku25,
               sum(decode(s.sku_id,'5036',s.quantity*1.2,'')) as sku26,
               sum(decode(s.sku_id,'5037',s.quantity,'')) as sku27,
               sum(decode(s.sku_id,'5070',s.quantity*3.2,'')) as sku28,
               sum(decode(s.sku_id,'5071',s.quantity*2.4,'')) as sku29,
               sum(decode(s.sku_id,'5072',s.quantity*3,'')) as sku30,
               sum(decode(s.sku_id,'5074',s.quantity,'')) as sku31,
               sum(decode(s.sku_id,'5075',s.quantity,'')) as sku32,
               sum(decode(s.sku_id,'5076',s.quantity,'')) as sku33,
               sum(decode(s.sku_id,'5077',s.quantity,'')) as sku34,
               sum(decode(s.sku_id,'5078',s.quantity,'')) as sku35,
               sum(decode(s.sku_id,'5079',s.quantity,'')) as sku36,
               sum(decode(s.sku_id,'5110',s.quantity,'')) as sku37,
               sum(decode(s.sku_id,'5111',s.quantity,'')) as sku38,
               sum(decode(s.sku_id,'5161',s.quantity,'')) as sku39,
               sum(decode(s.sku_id,'5162',s.quantity,'')) as sku40,
               sum(decode(s.sku_id,'5163',s.quantity,'')) as sku41,
               sum(decode(s.sku_id,'5164',s.quantity,'')) as sku42,
               sum(decode(s.sku_id,'5165',s.quantity,'')) as sku43,
               sum(decode(s.sku_id,'5166',s.quantity,'')) as sku44,
               sum(decode(s.sku_id,'5167',s.quantity,'')) as sku45,
               sum(decode(s.sku_id,'5168',s.quantity,'')) as sku46,
               sum(decode(s.sku_id,'5169',s.quantity,'')) as sku47,
               sum(decode(s.sku_id,'5170',s.quantity,'')) as sku48,
               sum(decode(s.sku_id,'5171',s.quantity,'')) as sku49
               from crm.crm_tb_kunnr_stock s
               left join crm.crm_tb_kunnr_kunag kg on kg.kunnr = s.kunnr 
               left join basis.basis_tb_salesemp_info e on s.user_id = e.emp_id 
               where kg.kunag is null and s.flag in ('kunnr_week','kunnr_month')
                     and s.status='U'
                     and e.org_id not in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = '51237'
				         connect by prior b.org_id= b.org_parent_id)
		       ]]>
		<dynamic>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		</dynamic>
			<![CDATA[  group by s.kunnr,s.check_time]]>
		
		union all
		
		<![CDATA[
		select kg1.kunag as kunnr,
		       max(ss.unitdesc) as unitDesc,
		       ss.check_time as checkTime,
               sum(decode(ss.sku_id,'24',ss.quantity,'')) as sku1,
               sum(decode(ss.sku_id,'25',ss.quantity,'')) as sku2,
               sum(decode(ss.sku_id,'26',ss.quantity,'')) as sku3,
               sum(decode(ss.sku_id,'27',ss.quantity,'')) as sku4,
               sum(decode(ss.sku_id,'28',ss.quantity,'')) as sku5,
               sum(decode(ss.sku_id,'29',ss.quantity,'')) as sku6,
               sum(decode(ss.sku_id,'30',ss.quantity,'')) as sku7,
               sum(decode(ss.sku_id,'31',ss.quantity,'')) as sku8,
               sum(decode(ss.sku_id,'32',ss.quantity*3.2,'')) as sku9,
               sum(decode(ss.sku_id,'33',ss.quantity*3,'')) as sku10,
               sum(decode(ss.sku_id,'34',ss.quantity*2.67,'')) as sku11,
               sum(decode(ss.sku_id,'35',ss.quantity,'')) as sku12,
               sum(decode(ss.sku_id,'36',ss.quantity*3.2,'')) as sku13,
               sum(decode(ss.sku_id,'37',ss.quantity,'')) as sku14,
               sum(decode(ss.sku_id,'38',ss.quantity*3,'')) as sku15,
               sum(decode(ss.sku_id,'56',ss.quantity,'')) as sku16,
               sum(decode(ss.sku_id,'100',ss.quantity,'')) as sku17,
               sum(decode(ss.sku_id,'101',ss.quantity,'')) as sku18,
               sum(decode(ss.sku_id,'102',ss.quantity,'')) as sku19,
               sum(decode(ss.sku_id,'103',ss.quantity,'')) as sku20,
               sum(decode(ss.sku_id,'5031',ss.quantity*3,'')) as sku21,
               sum(decode(ss.sku_id,'5032',ss.quantity*3.2,'')) as sku22,
               sum(decode(ss.sku_id,'5033',ss.quantity,'')) as sku23,
               sum(decode(ss.sku_id,'5034',ss.quantity*1.2,'')) as sku24,
               sum(decode(ss.sku_id,'5035',ss.quantity*1.2,'')) as sku25,
               sum(decode(ss.sku_id,'5036',ss.quantity*1.2,'')) as sku26,
               sum(decode(ss.sku_id,'5037',ss.quantity,'')) as sku27,
               sum(decode(ss.sku_id,'5070',ss.quantity*3.2,'')) as sku28,
               sum(decode(ss.sku_id,'5071',ss.quantity*2.4,'')) as sku29,
               sum(decode(ss.sku_id,'5072',ss.quantity*3,'')) as sku30,
               sum(decode(ss.sku_id,'5074',ss.quantity,'')) as sku31,
               sum(decode(ss.sku_id,'5075',ss.quantity,'')) as sku32,
               sum(decode(ss.sku_id,'5076',ss.quantity,'')) as sku33,
               sum(decode(ss.sku_id,'5077',ss.quantity,'')) as sku34,
               sum(decode(ss.sku_id,'5078',ss.quantity,'')) as sku35,
               sum(decode(ss.sku_id,'5079',ss.quantity,'')) as sku36,
               sum(decode(ss.sku_id,'5110',ss.quantity,'')) as sku37,
               sum(decode(ss.sku_id,'5111',ss.quantity,'')) as sku38,
               sum(decode(ss.sku_id,'5161',ss.quantity,'')) as sku39,
               sum(decode(ss.sku_id,'5162',ss.quantity,'')) as sku40,
               sum(decode(ss.sku_id,'5163',ss.quantity,'')) as sku41,
               sum(decode(ss.sku_id,'5164',ss.quantity,'')) as sku42,
               sum(decode(ss.sku_id,'5165',ss.quantity,'')) as sku43,
               sum(decode(ss.sku_id,'5166',ss.quantity,'')) as sku44,
               sum(decode(ss.sku_id,'5167',ss.quantity,'')) as sku45,
               sum(decode(ss.sku_id,'5168',ss.quantity,'')) as sku46,
               sum(decode(ss.sku_id,'5169',ss.quantity,'')) as sku47,
               sum(decode(ss.sku_id,'5170',ss.quantity,'')) as sku48,
               sum(decode(ss.sku_id,'5171',ss.quantity,'')) as sku49
               from crm.crm_tb_kunnr_stock ss
               left join crm.crm_tb_kunnr_kunag kg1 on kg1.kunnr = ss.kunnr 
               left join basis.basis_tb_salesemp_info ee on ss.user_id = ee.emp_id 
               where kg1.kunag is not null and ss.flag in ('kunnr_week','kunnr_month')
                     and ss.status='U'
                     and ee.org_id not in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = '51237'
				         connect by prior b.org_id= b.org_parent_id)
		       ]]>
		<dynamic>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ ss.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ ss.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		</dynamic>
			<![CDATA[  group by kg1.kunag,ss.check_time ) t 
		       left join crm.crm_tb_kunnr k on k.kunnr = t.kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       where 1=1
		    ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="getStockReportBySkuList" parameterClass="stockReport"
		resultClass="stockReport">
		<include refid="global.paginationStart" />
	<![CDATA[select t.*,
		       k.name1 as kunnrName,
		       ot.p_org_name as orgProvince,
		       ot.org_name as orgCity,
		       ot.rc_org_name as orgRegion
		       from (
		       select s.kunnr as kunnr,
		       max(s.unitdesc) as unitDesc,
		       s.check_time as checkTime,
               sum(decode(s.sku_id,'24',s.quantity,'')) as sku1,
               sum(decode(s.sku_id,'25',s.quantity,'')) as sku2,
               sum(decode(s.sku_id,'26',s.quantity,'')) as sku3,
               sum(decode(s.sku_id,'27',s.quantity,'')) as sku4,
               sum(decode(s.sku_id,'28',s.quantity,'')) as sku5,
               sum(decode(s.sku_id,'29',s.quantity,'')) as sku6,
               sum(decode(s.sku_id,'30',s.quantity,'')) as sku7,
               sum(decode(s.sku_id,'31',s.quantity,'')) as sku8,
               sum(decode(s.sku_id,'32',s.quantity*3.2,'')) as sku9,
               sum(decode(s.sku_id,'33',s.quantity*3,'')) as sku10,
               sum(decode(s.sku_id,'34',s.quantity*2.67,'')) as sku11,
               sum(decode(s.sku_id,'35',s.quantity,'')) as sku12,
               sum(decode(s.sku_id,'36',s.quantity*3.2,'')) as sku13,
               sum(decode(s.sku_id,'37',s.quantity,'')) as sku14,
               sum(decode(s.sku_id,'38',s.quantity,'')) as sku15,
               sum(decode(s.sku_id,'56',s.quantity,'')) as sku16,
               sum(decode(s.sku_id,'100',s.quantity,'')) as sku17,
               sum(decode(s.sku_id,'101',s.quantity,'')) as sku18,
               sum(decode(s.sku_id,'102',s.quantity,'')) as sku19,
               sum(decode(s.sku_id,'103',s.quantity,'')) as sku20,
               sum(decode(s.sku_id,'5031',s.quantity*3,'')) as sku21,
               sum(decode(s.sku_id,'5032',s.quantity*3.2,'')) as sku22,
               sum(decode(s.sku_id,'5033',s.quantity,'')) as sku23,
               sum(decode(s.sku_id,'5034',s.quantity*1.2,'')) as sku24,
               sum(decode(s.sku_id,'5035',s.quantity*1.2,'')) as sku25,
               sum(decode(s.sku_id,'5036',s.quantity*1.2,'')) as sku26,
               sum(decode(s.sku_id,'5037',s.quantity,'')) as sku27,
               sum(decode(s.sku_id,'5070',s.quantity*3.2,'')) as sku28,
               sum(decode(s.sku_id,'5071',s.quantity*2.4,'')) as sku29,
               sum(decode(s.sku_id,'5072',s.quantity*3,'')) as sku30,
               sum(decode(s.sku_id,'5074',s.quantity,'')) as sku31,
               sum(decode(s.sku_id,'5075',s.quantity,'')) as sku32,
               sum(decode(s.sku_id,'5076',s.quantity,'')) as sku33,
               sum(decode(s.sku_id,'5077',s.quantity,'')) as sku34,
               sum(decode(s.sku_id,'5078',s.quantity,'')) as sku35,
               sum(decode(s.sku_id,'5079',s.quantity,'')) as sku36,
               sum(decode(s.sku_id,'5110',s.quantity,'')) as sku37,
               sum(decode(s.sku_id,'5111',s.quantity,'')) as sku38,
               sum(decode(s.sku_id,'5161',s.quantity,'')) as sku39,
               sum(decode(s.sku_id,'5162',s.quantity,'')) as sku40,
               sum(decode(s.sku_id,'5163',s.quantity,'')) as sku41,
               sum(decode(s.sku_id,'5164',s.quantity,'')) as sku42,
               sum(decode(s.sku_id,'5165',s.quantity,'')) as sku43,
               sum(decode(s.sku_id,'5166',s.quantity,'')) as sku44,
               sum(decode(s.sku_id,'5167',s.quantity,'')) as sku45,
               sum(decode(s.sku_id,'5168',s.quantity,'')) as sku46,
               sum(decode(s.sku_id,'5169',s.quantity,'')) as sku47,
               sum(decode(s.sku_id,'5170',s.quantity,'')) as sku48,
               sum(decode(s.sku_id,'5171',s.quantity,'')) as sku49
               from crm.crm_tb_kunnr_stock s
               left join crm.crm_tb_kunnr_kunag kg on kg.kunnr = s.kunnr 
               left join basis.basis_tb_salesemp_info e on s.user_id = e.emp_id 
               where kg.kunag is null and s.flag in ('kunnr_week','kunnr_month')
                     and s.status='U'
                     and e.org_id not in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = '51237'
				         connect by prior b.org_id= b.org_parent_id)
		       ]]>
		<dynamic>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		</dynamic>
			<![CDATA[  group by s.kunnr,s.check_time]]>
		
		union all
		
		<![CDATA[
		select kg1.kunag as kunnr,
		       max(ss.unitdesc) as unitDesc,
		       ss.check_time as checkTime,
               sum(decode(ss.sku_id,'24',ss.quantity,'')) as sku1,
               sum(decode(ss.sku_id,'25',ss.quantity,'')) as sku2,
               sum(decode(ss.sku_id,'26',ss.quantity,'')) as sku3,
               sum(decode(ss.sku_id,'27',ss.quantity,'')) as sku4,
               sum(decode(ss.sku_id,'28',ss.quantity,'')) as sku5,
               sum(decode(ss.sku_id,'29',ss.quantity,'')) as sku6,
               sum(decode(ss.sku_id,'30',ss.quantity,'')) as sku7,
               sum(decode(ss.sku_id,'31',ss.quantity,'')) as sku8,
               sum(decode(ss.sku_id,'32',ss.quantity*3.2,'')) as sku9,
               sum(decode(ss.sku_id,'33',ss.quantity*3,'')) as sku10,
               sum(decode(ss.sku_id,'34',ss.quantity*2.67,'')) as sku11,
               sum(decode(ss.sku_id,'35',ss.quantity,'')) as sku12,
               sum(decode(ss.sku_id,'36',ss.quantity*3.2,'')) as sku13,
               sum(decode(ss.sku_id,'37',ss.quantity,'')) as sku14,
               sum(decode(ss.sku_id,'38',ss.quantity,'')) as sku15,
               sum(decode(ss.sku_id,'56',ss.quantity,'')) as sku16,
               sum(decode(ss.sku_id,'100',ss.quantity,'')) as sku17,
               sum(decode(ss.sku_id,'101',ss.quantity,'')) as sku18,
               sum(decode(ss.sku_id,'102',ss.quantity,'')) as sku19,
               sum(decode(ss.sku_id,'103',ss.quantity,'')) as sku20,
               sum(decode(ss.sku_id,'5031',ss.quantity*3,'')) as sku21,
               sum(decode(ss.sku_id,'5032',ss.quantity*3.2,'')) as sku22,
               sum(decode(ss.sku_id,'5033',ss.quantity,'')) as sku23,
               sum(decode(ss.sku_id,'5034',ss.quantity*1.2,'')) as sku24,
               sum(decode(ss.sku_id,'5035',ss.quantity*1.2,'')) as sku25,
               sum(decode(ss.sku_id,'5036',ss.quantity*1.2,'')) as sku26,
               sum(decode(ss.sku_id,'5037',ss.quantity,'')) as sku27,
               sum(decode(ss.sku_id,'5070',ss.quantity*3.2,'')) as sku28,
               sum(decode(ss.sku_id,'5071',ss.quantity*2.4,'')) as sku29,
               sum(decode(ss.sku_id,'5072',ss.quantity*3,'')) as sku30,
               sum(decode(ss.sku_id,'5074',ss.quantity,'')) as sku31,
               sum(decode(ss.sku_id,'5075',ss.quantity,'')) as sku32,
               sum(decode(ss.sku_id,'5076',ss.quantity,'')) as sku33,
               sum(decode(ss.sku_id,'5077',ss.quantity,'')) as sku34,
               sum(decode(ss.sku_id,'5078',ss.quantity,'')) as sku35,
               sum(decode(ss.sku_id,'5079',ss.quantity,'')) as sku36,
               sum(decode(ss.sku_id,'5110',ss.quantity,'')) as sku37,
               sum(decode(ss.sku_id,'5111',ss.quantity,'')) as sku38,
               sum(decode(ss.sku_id,'5161',ss.quantity,'')) as sku39,
               sum(decode(ss.sku_id,'5162',ss.quantity,'')) as sku40,
               sum(decode(ss.sku_id,'5163',ss.quantity,'')) as sku41,
               sum(decode(ss.sku_id,'5164',ss.quantity,'')) as sku42,
               sum(decode(ss.sku_id,'5165',ss.quantity,'')) as sku43,
               sum(decode(ss.sku_id,'5166',ss.quantity,'')) as sku44,
               sum(decode(ss.sku_id,'5167',ss.quantity,'')) as sku45,
               sum(decode(ss.sku_id,'5168',ss.quantity,'')) as sku46,
               sum(decode(ss.sku_id,'5169',ss.quantity,'')) as sku47,
               sum(decode(ss.sku_id,'5170',ss.quantity,'')) as sku48,
               sum(decode(ss.sku_id,'5171',ss.quantity,'')) as sku49
               from crm.crm_tb_kunnr_stock ss
               left join crm.crm_tb_kunnr_kunag kg1 on kg1.kunnr = ss.kunnr 
               left join basis.basis_tb_salesemp_info ee on ss.user_id = ee.emp_id 
               where kg1.kunag is not null and ss.flag in ('kunnr_week','kunnr_month')
                     and ss.status='U'
                     and ee.org_id not in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = '51237'
				         connect by prior b.org_id= b.org_parent_id)
		       ]]>
		<dynamic>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ ss.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ ss.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		</dynamic>
			<![CDATA[  group by kg1.kunag,ss.check_time ) t 
		       left join crm.crm_tb_kunnr k on k.kunnr = t.kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       where 1=1
		    ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
		<![CDATA[ order by t.kunnr]]>
		<include refid="global.paginationEnd" />
		</dynamic>
			
	</select>
	
	<select id="getStockReportBySalesListCount" parameterClass="stockReport"
		resultClass="java.lang.Integer">
		<![CDATA[select count(*)
		       from (
		       select s.kunnr as kunnr,
		       max(s.unitdesc) as unitDesc,
		       s.check_time as checkTime,
               sum(decode(s.sku_id,'24',s.quantity,'')) as sku1,
               sum(decode(s.sku_id,'25',s.quantity,'')) as sku2,
               sum(decode(s.sku_id,'26',s.quantity,'')) as sku3,
               sum(decode(s.sku_id,'27',s.quantity,'')) as sku4,
               sum(decode(s.sku_id,'28',s.quantity,'')) as sku5,
               sum(decode(s.sku_id,'29',s.quantity,'')) as sku6,
               sum(decode(s.sku_id,'30',s.quantity,'')) as sku7,
               sum(decode(s.sku_id,'31',s.quantity,'')) as sku8,
               sum(decode(s.sku_id,'32',s.quantity,'')) as sku9,
               sum(decode(s.sku_id,'33',s.quantity,'')) as sku10,
               sum(decode(s.sku_id,'34',s.quantity,'')) as sku11,
               sum(decode(s.sku_id,'35',s.quantity,'')) as sku12,
               sum(decode(s.sku_id,'36',s.quantity,'')) as sku13,
               sum(decode(s.sku_id,'37',s.quantity,'')) as sku14,
               sum(decode(s.sku_id,'38',s.quantity,'')) as sku15,
               sum(decode(s.sku_id,'56',s.quantity,'')) as sku16,
               sum(decode(s.sku_id,'100',s.quantity,'')) as sku17,
               sum(decode(s.sku_id,'101',s.quantity,'')) as sku18,
               sum(decode(s.sku_id,'102',s.quantity,'')) as sku19,
               sum(decode(s.sku_id,'103',s.quantity,'')) as sku20
               from crm.crm_tb_kunnr_stock s
		       left join crm.crm_tb_kunnr k on k.kunnr = s.kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       where s.flag ='sales_day'
                     and s.status='U'
		       ]]>
		<dynamic>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr = #kunnr#]]>
		</isNotEmpty>
		</dynamic>
			<![CDATA[  group by s.kunnr,s.check_time)]]>
	</select>
	
	<select id="getStockReportBySalesList" parameterClass="stockReport"
		resultClass="stockReport">
		<include refid="global.paginationStart" />
	<![CDATA[select 
		       s.kunnr as kunnr,
		       ot.p_org_name as orgProvince,
		       s.check_time as checkTime,
		       max(k.name1) as kunnrName,
		       max(ot.org_name) as orgCity,
		       max(ot.rc_org_name) as orgRegion,
		       max(s.unitdesc) as unitDesc,
               sum(decode(s.sku_id,'24',s.quantity,'')) as sku1,
               sum(decode(s.sku_id,'25',s.quantity,'')) as sku2,
               sum(decode(s.sku_id,'26',s.quantity,'')) as sku3,
               sum(decode(s.sku_id,'27',s.quantity,'')) as sku4,
               sum(decode(s.sku_id,'28',s.quantity,'')) as sku5,
               sum(decode(s.sku_id,'29',s.quantity,'')) as sku6,
               sum(decode(s.sku_id,'30',s.quantity,'')) as sku7,
               sum(decode(s.sku_id,'31',s.quantity,'')) as sku8,
               sum(decode(s.sku_id,'32',s.quantity,'')) as sku9,
               sum(decode(s.sku_id,'33',s.quantity,'')) as sku10,
               sum(decode(s.sku_id,'34',s.quantity,'')) as sku11,
               sum(decode(s.sku_id,'35',s.quantity,'')) as sku12,
               sum(decode(s.sku_id,'36',s.quantity,'')) as sku13,
               sum(decode(s.sku_id,'37',s.quantity,'')) as sku14,
               sum(decode(s.sku_id,'38',s.quantity,'')) as sku15,
               sum(decode(s.sku_id,'56',s.quantity,'')) as sku16,
               sum(decode(s.sku_id,'100',s.quantity,'')) as sku17,
               sum(decode(s.sku_id,'101',s.quantity,'')) as sku18,
               sum(decode(s.sku_id,'102',s.quantity,'')) as sku19,
               sum(decode(s.sku_id,'103',s.quantity,'')) as sku20
               from crm.crm_tb_kunnr_stock s
		       left join crm.crm_tb_kunnr k on k.kunnr = s.kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       where s.flag ='sales_day'
                     and s.status='U'
		       ]]>
		<dynamic>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr = #kunnr#]]>
		</isNotEmpty>
		<![CDATA[ group by s.kunnr,ot.p_org_name,s.check_time
                  order by ot.p_org_name,s.kunnr]]>
		<include refid="global.paginationEnd" />
		</dynamic>
	</select>
	
	<select id="getSkuCount" parameterClass="orderSku" resultClass="java.lang.Integer">
	<![CDATA[
		    select count(s.sku_name) from crm.crm_tb_sku s 
		    where s.product_type = '1' and s.sku_company='1' and s.status='U'
	]]>
		<dynamic>
			<isNotEmpty property="skuName" prepend="and">
			<![CDATA[ s.sku_name like #skuName,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="getCgCount" parameterClass="orderSku" resultClass="java.lang.Integer">
	<![CDATA[
		    select count(*) from crm.crm_tb_cg t 
		    where t.company_id='1' and t.status='U' and t.sap_groups_code is not null
	]]>
		<dynamic>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ t.sku_category_id = #cgId# ]]>
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="getSkuNameList" parameterClass="orderSku" resultClass="orderSku">
	<include refid="global.paginationStart" />
	<![CDATA[
	      select distinct s.sku_id as skuId,
	      				  s.sku_name as skuName,
	      				  s.sku_unit as skuUnit,
	      				  s.sku_category_id as cgId
	      from crm.crm_tb_sku s 
	      where s.product_type = '1' and s.sku_company='1' and s.status='U'
	]]>
		<dynamic>
			<isNotEmpty property="skuName" prepend="and">
			<![CDATA[ s.sku_name like #skuName,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>			
		</dynamic>
		<![CDATA[order by s.sku_id ]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="getCategoryCount" parameterClass="category" resultClass="java.lang.Integer">
	<![CDATA[
		    select count(*) from crm.crm_tb_cg c where c.company_id = '1' and c.status = 'U'
		    and c.sku_category_id not in ('1001','1010')
	]]>
		<dynamic>
			<isNotEmpty property="categoryName" prepend="and">
			<![CDATA[ c.category_name like #categoryName,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="getCategoryNameList" parameterClass="category" resultClass="category">
	<include refid="global.paginationStart" />
	<![CDATA[
	      select distinct c.sku_category_id as categoryId,
	      				  c.category_name as categoryName
	      from crm.crm_tb_cg c 
	      where c.company_id = '1' and c.status = 'U' and c.sku_category_id not in ('1001','1010')
	]]>
		<dynamic>
			<isNotEmpty property="categoryName" prepend="and">
			<![CDATA[ c.category_name like #categoryName,handler=wildcard# escape '\' ]]>
			</isNotEmpty>			
		</dynamic>
		<![CDATA[order by c.sku_category_id ]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="getCategoryBySku" parameterClass="java.lang.Long" resultClass="java.lang.Long">
	<![CDATA[
		    select c.sku_category_id from crm.crm_tb_sku c where c.sku_id = #skuId# and c.status = 'U'
	]]>
	</select>
	
	<select id="getStockDate" parameterClass="stockDate" resultClass="stockDate">
	    <![CDATA[ select t.id as id,
	                     t.check_time as checkTime,
	                     t.start_date as startDateStr,
	                     t.end_date as endDateStr,
	                     t.modify_date as modifyDate
	                     from crm.crm_tb_kunnr_stock_date t
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="id" prepend="and">
			<![CDATA[ t.id = #id# ]]>
			</isNotEmpty>
			<isNotEmpty property="checkTime" prepend="and">
			<![CDATA[ t.id <> 6 ]]>
			</isNotEmpty>
			<isNotEmpty property="modifyDate" prepend="and">
			<![CDATA[ t.start_date <= #modifyDate# and t.end_date>=#modifyDate#]]>
			</isNotEmpty>
		</dynamic> 
	</select>
	
	<update id="updateStockDate" parameterClass="stockDate">
	    <![CDATA[ update crm.crm_tb_kunnr_stock_date t set t.modify_date = sysdate]]>
	    <dynamic>
			<isNotEmpty property="checkTime" prepend=",">
			<![CDATA[ t.check_time = #checkTime# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend=",">
			<![CDATA[ t.start_date = #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend=",">
			<![CDATA[ t.end_date = #endDate#]]>
			</isNotEmpty>
		</dynamic>
			<![CDATA[ where t.id=#id# ]]>
	</update>
	
	<select id="getLastStockDate" parameterClass="stockDate" resultClass="java.lang.String">
	    <![CDATA[ select max(t.check_time) 
	                     from crm.crm_vw_kunnr_stock t 
	                     where t.user_type='A' and t.flag in ('kunnr_week','kunnr_month')
	    ]]>
	    <dynamic>
			<isNotEmpty property="modifyDate" prepend="and">
			<![CDATA[ t.check_time <= to_char(#modifyDate#,'yyyy-MM-dd')]]>
			</isNotEmpty>
		</dynamic> 
	</select>
	
	<select id="getKunnrInTypeCount" parameterClass="kunnrInType" resultClass="java.lang.Integer">
	     <![CDATA[select count(*)
	              from crm.crm_tb_kunnr k
	                   left join crm.crm_tb_kunnr_type_tmp t on t.kunnr = k.kunnr
	              where k.org_id is not null ]]>
	     <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="kunnrName" prepend="and">
			<![CDATA[ k.name1 = #kunnrName# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		   </isNotEmpty>
		   <isNotEmpty property="type" prepend="and">
			<![CDATA[ t.kunnr_type = #type# ]]>
		   </isNotEmpty>
		   <isNotEmpty property="isNotice" prepend="and">
			<![CDATA[ t.isnotice = #isNotice# ]]>
		   </isNotEmpty>
		   <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ k.cooperation_start >= #startDate# ]]>
		   </isNotEmpty>
		   <isNotEmpty property="endDate" prepend="and">
			<![CDATA[ k.cooperation_start <= #endDate# ]]>
		   </isNotEmpty>
		 </dynamic>
	</select>
	
	<select id="getKunnrInType" parameterClass="kunnrInType" resultClass="kunnrInType">
	    <include refid="global.paginationStart" />
	     <![CDATA[select k.kunnr as kunnr,
	                     k.name1 as kunnrName,
	                     k.org_id as orgId,
	                     k.org_name as orgName,
	                     t.kunnr_type as type,
	                     t.isnotice as isNotice,
	                     k.tel_number as telNumber,
	                     k.fax_number as faxNumber,
	                     k.mob_number as mobNumber,
	                     to_char(k.cooperation_start,'yyyy-MM-dd') as kunnrStartDate
	              from crm.crm_tb_kunnr k
	                   left join crm.crm_tb_kunnr_type_tmp t on t.kunnr = k.kunnr
	              where k.org_id is not null ]]>
	     <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="kunnrName" prepend="and">
			<![CDATA[ k.name1 = #kunnrName# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		    <isNotEmpty property="type" prepend="and">
			<![CDATA[ t.kunnr_type = #type# ]]>
			</isNotEmpty>
		   <isNotEmpty property="isNotice" prepend="and">
			<![CDATA[ t.isnotice = #isNotice# ]]>
		   </isNotEmpty>
		   <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ k.cooperation_start >= #startDate# ]]>
		   </isNotEmpty>
		   <isNotEmpty property="endDate" prepend="and">
			<![CDATA[ k.cooperation_start <= #endDate# ]]>
		   </isNotEmpty>
		 </dynamic>
		 <include refid="global.paginationEnd" />
	</select>
	
	<select id="getKunnrInTypeTmpCount" parameterClass="kunnrInType" resultClass="java.lang.Integer">
	     <![CDATA[select count(*)
	              from crm.crm_tb_kunnr_type_tmp t
	              where 1=1 ]]>
	     <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr# ]]>
			</isNotEmpty>
		 </dynamic>
	</select>
	
	<update id="updateKunnrInType" parameterClass="kunnrInType">
	    <![CDATA[ update crm.crm_tb_kunnr_type_tmp t set t.kunnr_type = #type#]]>
	    <dynamic>
			<isNotEmpty property="isNotice" prepend=",">
			<![CDATA[ t.isnotice = #isNotice# ]]>
			</isNotEmpty>
	    </dynamic>
	          <![CDATA[ where t.kunnr=#kunnr# ]]>
	</update>
	
	<insert id="createKunnrInType" parameterClass="kunnrInType">
	    <![CDATA[ insert into crm.crm_tb_kunnr_type_tmp(
	               kunnr_type,
	               kunnr,
	               isnotice
	              )
	              values(
	              #type#,
	              #kunnr#,
	              #isNotice#) ]]>
	</insert>
	
	<select id="searchSkuPercentListCount" parameterClass="skuPercent" resultClass="java.lang.Integer">
	     <![CDATA[select count(*)
	              from crm.crm_tb_sku_percent s
	                   left join crm.crm_tb_sku t on s.sku_id = t.sku_id
	                   left join crm.crm_tb_cg c on c.sku_category_id = s.sku_category_id
	              where 1=1 ]]>
	     <dynamic>
			<isNotEmpty property="skuName" prepend="and">
			<![CDATA[ t.sku_name like #skuName,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
			<isNotEmpty property="cgName" prepend="and">
			<![CDATA[ c.category_name like #cgName,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
		 </dynamic>
	</select>
	
	<select id="searchSkuPercentList" parameterClass="skuPercent" resultClass="skuPercent">
	    <include refid="global.paginationStart" />
	     <![CDATA[select s.sku_id as skuId,
	                     s.sku_category_id as cgId,
	                     s.sku_percent as skuPercent,
	                     t.sku_name as skuName,
	                     c.category_name as cgName
	              from crm.crm_tb_sku_percent s
	                   left join crm.crm_tb_sku t on s.sku_id = t.sku_id
	                   left join crm.crm_tb_cg c on c.sku_category_id = s.sku_category_id
	              where 1=1 ]]>
	     <dynamic>
			<isNotEmpty property="skuName" prepend="and">
			<![CDATA[ t.sku_name like #skuName,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
			<isNotEmpty property="cgName" prepend="and">
			<![CDATA[ c.category_name like #cgName,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ c.sku_category_id = #cgId# ]]>
			</isNotEmpty>
		 </dynamic>
		 <![CDATA[ order by s.sku_category_id,s.sku_id ]]>
		 <include refid="global.paginationEnd" />
	</select>
	
	<update id="updateSkuPercent" parameterClass="skuPercent">
	    <![CDATA[ update crm.crm_tb_sku_percent t set t.sku_percent = #skuPercent#
	              where t.sku_id=#skuId# ]]>
	</update>
	
	<select id="searchSkuPercentSum" parameterClass="skuPercent" resultClass="skuPercent">
	     <![CDATA[select decode(sum(s.sku_percent),null,0,sum(s.sku_percent)) as skuPercent
	              from crm.crm_tb_sku_percent s
	              where 1=1 ]]>
	     <dynamic>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id <> #skuId# ]]>
			</isNotEmpty>
		 </dynamic>
	</select>
	
	<insert id="createKunag" parameterClass="kunag">
	      <![CDATA[ insert into crm.crm_tb_kunnr_kunag(
	                kunnr,
	                kunag,
	                name1,
	                name2
	                )
	                values(
	                #kunnr#,
	                #kunag#,
	                #name1#,
	                #name2#) ]]>
	</insert>
	
	<select id="searchKunagCount" parameterClass="kunag" resultClass="java.lang.Integer">
	     <![CDATA[select count(*)
	              from crm.crm_tb_kunnr_kunag k
	              left join crm.crm_tb_kunnr kk on k.kunnr=kk.kunnr
	              left join crm.crm_tb_kunnrbusiness b on b.kunnr=k.kunnr
	              where 1=1 ]]>
	     <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="kunag" prepend="and">
			<![CDATA[ k.kunag = #kunag# ]]>
			</isNotEmpty>
			<isNotEmpty property="name1" prepend="and">
			<![CDATA[ k.name1 like #name1,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
			<isNotEmpty property="name2" prepend="and">
			<![CDATA[ k.name2 like #name2,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ kk.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
			</isNotEmpty>
			<isEqual property="isImportant" prepend="and" compareValue="Y">
			<![CDATA[ b.is_important='X']]>
			</isEqual>
			<isEqual property="isImportant" prepend="and" compareValue="N">
			<![CDATA[ b.is_important is null]]>
			</isEqual>
			<isNotEmpty property="isMain" prepend="and">
			<![CDATA[ (k.kunnr = #kunnr# and k.kunag is null)
			           or  (k.kunnr = #kunnr# and k.kunag = #kunnr#)]]>
			</isNotEmpty>
		 </dynamic>
	</select>
	
	<select id="searchKunag" parameterClass="kunag" resultClass="kunag">
	<include refid="global.paginationStart" />
	     <![CDATA[select k.kunnr as kunnr,
	                     k.name1 as name1,
	                     k.kunag as kunag,
	                     k.name2 as name2,
	                     kk.org_name as orgName,
	                     b.is_important isImportant
	              from crm.crm_tb_kunnr_kunag k
	              left join crm.crm_tb_kunnr kk on k.kunnr=kk.kunnr
	              left join crm.crm_tb_kunnrbusiness b on b.kunnr=k.kunnr
	              where 1=1 ]]>
	     <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="kunag" prepend="and">
			<![CDATA[ k.kunag = #kunag# ]]>
			</isNotEmpty>
			<isNotEmpty property="name1" prepend="and">
			<![CDATA[ k.name1 like #name1,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
			<isNotEmpty property="name2" prepend="and">
			<![CDATA[ k.name2 like #name2,handler=wildcard# escape '\' ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ kk.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
			</isNotEmpty>
			<isEqual property="isImportant" prepend="and" compareValue="Y">
			<![CDATA[ b.is_important='X']]>
			</isEqual>
			<isEqual property="isImportant" prepend="and" compareValue="N">
			<![CDATA[ b.is_important is null]]>
			</isEqual>
		 </dynamic>
		 <![CDATA[ order by k.kunnr ]]>
	<include refid="global.paginationEnd" />
	</select>
	
	<delete id="deleteKunag">
	     <![CDATA[ delete crm.crm_tb_kunnr_kunag ]]>
	</delete>
	
	<select id="searchSalesGoalCGListCount" parameterClass="salesGoal" resultClass="java.lang.Integer">
	    <![CDATA[
	    select count(*) from (
	        select dg.kunnr as kunnr,
	               dg.goal_year as goalYear,
	               dg.goal_month as goalMonth,
	               max(k.name1) as kunnrName,
	               max(t.rc_org_name) as orgRegion,
	               max(t.p_org_name) as orgProvince,
	               max(t.org_name) as orgCity,
			       max(dg.create_date) as createDate,
			       max(user_id) as userId,
			       max(goal_type) as goalType,
			       sum(decode(dg.matter_num ,'A1',dg.box_num,0)) as cgA1,
			       sum(decode(dg.matter_num ,'A2',dg.box_num,0)) as cgA2,
			       sum(decode(dg.matter_num ,'A3',dg.box_num,0)) as cgA3,
			       sum(decode(dg.matter_num ,'A4',dg.box_num,0)) as cgA4,
			       sum(decode(dg.matter_num ,'A5',dg.box_num,0)) as cgA5,
			       sum(decode(dg.matter_num ,'A6',dg.box_num,0)) as cgA6,
			       sum(decode(dg.matter_num ,'A7',dg.box_num,0)) as cgA7,
			       sum(decode(dg.matter_num ,'A8',dg.box_num,0)) as cgA8,
			       sum(decode(dg.matter_num ,'B1',dg.box_num,0)) as cgB1,
			       sum(decode(dg.matter_num ,'B3',dg.box_num,0)) as cgB3,
			       sum(decode(dg.matter_num ,'B6',dg.box_num,0)) as cgB6,
			       sum(decode(dg.matter_num ,'B8',dg.box_num,0)) as cgB8,
			       sum(decode(dg.matter_num ,'C1',dg.box_num,0)) as cgC1,
			       sum(decode(dg.matter_num ,'C6',dg.box_num,0)) as cgC6,
			       sum(decode(dg.matter_num ,'C7',dg.box_num,0)) as cgC7,
			       sum(decode(dg.matter_num ,'C8',dg.box_num,0)) as cgC8,
			       sum(decode(dg.matter_num ,'D10',dg.box_num,0)) as cgD10,
			       sum(decode(dg.matter_num ,'D9',dg.box_num,0)) as cgD9,
			       sum(decode(dg.matter_num ,'E1',dg.box_num,0)) as cgE1,
			       sum(decode(dg.matter_num ,'H7',dg.box_num,0)) as cgH7,
			       sum(decode(dg.matter_num ,'F1',dg.box_num,0)) as cgF1,
			       sum(decode(dg.matter_num ,'F8',dg.box_num,0)) as cgF8,
			       sum(decode(dg.matter_num ,'G1',dg.box_num,0)) as cgG1,
			       sum(decode(dg.matter_num ,'G8',dg.box_num,0)) as cgG8,
			       sum(decode(dg.matter_num ,'J1',dg.box_num,0)) as cgJ1,
			       sum(decode(dg.matter_num ,'J8',dg.box_num,0)) as cgJ8,
			       sum(decode(dg.matter_num ,'K1',dg.box_num,0)) as cgK1,
			       sum(decode(dg.matter_num ,'K8',dg.box_num,0)) as cgK8,
			       sum(decode(dg.matter_num ,'D3',dg.box_num,0)) as cgD3
			  from crm.crm_tb_goal_production dg
			  left join crm.crm_tb_kunnr k on k.kunnr = dg.kunnr
			  left join basis.basis_tb_org_temp t on t.org_id = k.org_id
			  where dg.status='U'
		]]>
		<dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ dg.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ dg.goal_year = #goalYear# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ dg.goal_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalType" prepend="and">
			<![CDATA[ dg.goal_type = #goalType# ]]>
			</isNotEmpty>
		 </dynamic>
		 <![CDATA[group by dg.kunnr,dg.goal_year,dg.goal_month  ]]>
		 <![CDATA[order by dg.kunnr,dg.goal_year,dg.goal_month  ]]>
		 )
	</select>
	
	<select id="searchSalesGoalCGList" parameterClass="salesGoal" resultClass="salesGoal">
	    <include refid="global.paginationStart" />
	    <![CDATA[
	        select dg.kunnr as kunnr,
	               dg.goal_year as goalYear,
	               dg.goal_month as goalMonth,
	               o.org_name as orgName,
	               max(k.name1) as kunnrName,
	               max(t.rc_org_name) as orgRegion,
	               max(t.p_org_name) as orgProvince,
	               max(t.org_name) as orgCity,
			       max(dg.create_date) as createDate,
			       max(user_id) as userId,
			       max(goal_type) as goalType,
			       sum(decode(dg.matter_num ,'A1',dg.box_num,0)) as cgA1,
			       sum(decode(dg.matter_num ,'A2',dg.box_num,0)) as cgA2,
			       sum(decode(dg.matter_num ,'A3',dg.box_num,0)) as cgA3,
			       sum(decode(dg.matter_num ,'A4',dg.box_num,0)) as cgA4,
			       sum(decode(dg.matter_num ,'A5',dg.box_num,0)) as cgA5,
			       sum(decode(dg.matter_num ,'A6',dg.box_num,0)) as cgA6,
			       sum(decode(dg.matter_num ,'A7',dg.box_num,0)) as cgA7,
			       sum(decode(dg.matter_num ,'A8',dg.box_num,0)) as cgA8,
			       sum(decode(dg.matter_num ,'B1',dg.box_num,0)) as cgB1,
			       sum(decode(dg.matter_num ,'B3',dg.box_num,0)) as cgB3,
			       sum(decode(dg.matter_num ,'B6',dg.box_num,0)) as cgB6,
			       sum(decode(dg.matter_num ,'B8',dg.box_num,0)) as cgB8,
			       sum(decode(dg.matter_num ,'C1',dg.box_num,0)) as cgC1,
			       sum(decode(dg.matter_num ,'C6',dg.box_num,0)) as cgC6,
			       sum(decode(dg.matter_num ,'C7',dg.box_num,0)) as cgC7,
			       sum(decode(dg.matter_num ,'C8',dg.box_num,0)) as cgC8,
			       sum(decode(dg.matter_num ,'D10',dg.box_num,0)) as cgD10,
			       sum(decode(dg.matter_num ,'D9',dg.box_num,0)) as cgD9,
			       sum(decode(dg.matter_num ,'E1',dg.box_num,0)) as cgE1,
			       sum(decode(dg.matter_num ,'H7',dg.box_num,0)) as cgH7,
			       sum(decode(dg.matter_num ,'F1',dg.box_num,0)) as cgF1,
			       sum(decode(dg.matter_num ,'F8',dg.box_num,0)) as cgF8,
			       sum(decode(dg.matter_num ,'G1',dg.box_num,0)) as cgG1,
			       sum(decode(dg.matter_num ,'G8',dg.box_num,0)) as cgG8,
			       sum(decode(dg.matter_num ,'J1',dg.box_num,0)) as cgJ1,
			       sum(decode(dg.matter_num ,'J8',dg.box_num,0)) as cgJ8,
			       sum(decode(dg.matter_num ,'K1',dg.box_num,0)) as cgK1,
			       sum(decode(dg.matter_num ,'K8',dg.box_num,0)) as cgK8,
			       sum(decode(dg.matter_num ,'D3',dg.box_num,0)) as cgD3
			  from crm.crm_tb_goal_production dg
			  left join crm.crm_tb_kunnr k on k.kunnr = dg.kunnr
			  left join basis.basis_tb_org_temp t on t.org_id = k.org_id
			  left join basis.basis_tb_org o on o.org_id = dg.org_id
			  where dg.status='U'
		]]>
		<dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ dg.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ dg.goal_year = #goalYear# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ dg.goal_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalType" prepend="and">
			<![CDATA[ dg.goal_type = #goalType# ]]>
			</isNotEmpty>
		 </dynamic>
		 <![CDATA[group by dg.kunnr,dg.goal_year,dg.goal_month,o.org_name]]>
		 <![CDATA[order by dg.kunnr,dg.goal_year,dg.goal_month  ]]>
		 <include refid="global.paginationEnd" />
	</select>
	
	<select id="searchSalesGoalCGDetailListCount" parameterClass="salesGoal" resultClass="java.lang.Integer">
	    <![CDATA[
	    select count(*) from (
	        select p.kunnr as kunnr,
	               p.goal_year as goalYear,
	               p.goal_month as goalMonth,
	               max(o.org_name) as orgName,
	               max(k.name1) as kunnrName,
	               p.matter_num as matterNum,
			       max(p.create_date) as createDate,
			       max(p.user_id) as userId,
			       max(e.emp_name) as userName,
			       sum(p.box_num) as boxNum,
			       max(p.goal_type) as goalType,
			       p.org_id as orgId,
			       p.goal_mark as goalMark,
			       max(tm.maktx) as matterName
			  from crm.crm_tb_goal_production p
			  left join basis.basis_tb_materiel tm on p.matter_num = tm.matnr
			  left join crm.crm_tb_kunnr k on k.kunnr = p.kunnr
			  left join basis.basis_tb_org o on o.org_id = p.org_id
			  left join basis.basis_tb_salesemp_info e on e.emp_id=p.user_id
			  where p.status='U'
		]]>
		<dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ p.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="brand" prepend="and">
			<![CDATA[ tm.matnr01 = #brand# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ p.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
			</isNotEmpty>
			<isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ p.goal_year = #goalYear# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ p.goal_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalType" prepend="and">
			<![CDATA[ p.goal_type = #goalType# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMark" prepend="and">
			<![CDATA[ p.goal_mark = #goalMark# ]]>
			</isNotEmpty>
			<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ p.matter_num = #matterNum# ]]>
			</isNotEmpty>
			<isEqual property="flag" compareValue="Y" prepend="and">
			<![CDATA[ k.name1 is null ]]>
			</isEqual>
			<isEqual property="flag" compareValue="N" prepend="and">
			<![CDATA[ k.name1 is not null ]]>
			</isEqual>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ to_char(to_date(p.goal_year||p.goal_month,'yyyyMM'),'yyyy-MM') >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ to_char(to_date(p.goal_year||p.goal_month,'yyyyMM'),'yyyy-MM') <= #endDate# ]]>
			</isNotEmpty>
			<![CDATA[ group by p.org_id,p.kunnr,p.goal_year,p.goal_month,p.matter_num,p.goal_mark) ]]>
		 </dynamic>
	</select>
	
	<select id="searchSalesGoalCGDetailListSum" parameterClass="salesGoal" resultClass="java.lang.String">
	    <![CDATA[
	        select to_char(sum(p.box_num))
			  from crm.crm_tb_goal_production p
			  left join basis.basis_tb_materiel tm on p.matter_num = tm.matnr
			  left join crm.crm_tb_kunnr k on k.kunnr = p.kunnr
			  left join basis.basis_tb_org o on o.org_id = p.org_id
			  left join basis.basis_tb_salesemp_info e on e.emp_id=p.user_id
			  where p.status='U'
		]]>
		<dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ p.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="brand" prepend="and">
			<![CDATA[ tm.matnr01 = #brand# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ p.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
			</isNotEmpty>
			<isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ p.goal_year = #goalYear# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ p.goal_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalType" prepend="and">
			<![CDATA[ p.goal_type = #goalType# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMark" prepend="and">
			<![CDATA[ p.goal_mark = #goalMark# ]]>
			</isNotEmpty>
			<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ p.matter_num = #matterNum# ]]>
			</isNotEmpty>
			<isEqual property="flag" compareValue="Y" prepend="and">
			<![CDATA[ k.name1 is null ]]>
			</isEqual>
			<isEqual property="flag" compareValue="N" prepend="and">
			<![CDATA[ k.name1 is not null ]]>
			</isEqual>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ to_char(to_date(p.goal_year||p.goal_month,'yyyyMM'),'yyyy-MM') >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ to_char(to_date(p.goal_year||p.goal_month,'yyyyMM'),'yyyy-MM') <= #endDate# ]]>
			</isNotEmpty>
		 </dynamic>
	</select>
	
	<select id="searchSalesGoalCGDetailList" parameterClass="salesGoal" resultClass="salesGoal">
	    <include refid="global.paginationStart" />
	    <![CDATA[
	        select p.kunnr as kunnr,
	               p.goal_year as goalYear,
	               p.goal_month as goalMonth,
	               max(o.org_name) as orgName,
	               max(k.name1) as kunnrName,
	               p.matter_num as matterNum,
			       max(p.create_date) as createDate,
			       max(p.user_id) as userId,
			       max(e.emp_name) as userName,
			       sum(p.box_num) as boxNum,
			       max(p.goal_type) as goalType,
			       p.org_id as orgId,
			       p.goal_mark as goalMark,
			       max(tm.maktx) as matterName,
			       tm.maktx01 as brand,
			       sum(p.box_num)-max(nvl(pp.box_num,0)) boxNumD
			  from crm.crm_tb_goal_production p
			  left join crm.crm_tb_kunnr k on k.kunnr = p.kunnr
			  left join basis.basis_tb_materiel tm on p.matter_num = tm.matnr
			  left join basis.basis_tb_org o on o.org_id = p.org_id
			  left join basis.basis_tb_salesemp_info e on e.emp_id=p.user_id
			  left join (select p.goal_year,p.goal_month,p.org_id,p.matter_num,sum(p.box_num) box_num 
			                    from crm.crm_tb_goal_production p where p.goal_mark='Y' and p.status='U'
                                group by p.goal_year,p.goal_month,p.org_id,p.matter_num
                                ) pp on pp.org_id=p.org_id and pp.goal_year=p.goal_year and pp.goal_month=p.goal_month and pp.matter_num=p.matter_num
			  where p.status='U'
		]]>
		<dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ p.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="brand" prepend="and">
			<![CDATA[ tm.matnr01 = #brand# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ p.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
			</isNotEmpty>
			<isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ p.goal_year = #goalYear# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ p.goal_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalType" prepend="and">
			<![CDATA[ p.goal_type = #goalType# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMark" prepend="and">
			<![CDATA[ p.goal_mark = #goalMark# ]]>
			</isNotEmpty>
			<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ p.matter_num = #matterNum# ]]>
			</isNotEmpty>
			<isEqual property="flag" compareValue="Y" prepend="and">
			<![CDATA[ k.name1 is null ]]>
			</isEqual>
			<isEqual property="flag" compareValue="N" prepend="and">
			<![CDATA[ k.name1 is not null ]]>
			</isEqual>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ to_char(to_date(p.goal_year||p.goal_month,'yyyyMM'),'yyyy-MM') >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ to_char(to_date(p.goal_year||p.goal_month,'yyyyMM'),'yyyy-MM') <= #endDate# ]]>
			</isNotEmpty>
		 </dynamic>
		 <![CDATA[  group by p.org_id,p.kunnr,p.goal_year,p.goal_month,p.matter_num,p.goal_mark,tm.maktx01
		            order by p.org_id,p.kunnr,p.goal_year,p.goal_month,p.matter_num  ]]>
		 <include refid="global.paginationEnd" />
	</select>
	
	<insert id="createSalesGoal" parameterClass="salesGoal">
	    <![CDATA[
	      insert into crm.crm_tb_goal_production(
	             kunnr,
                 goal_year,
                 goal_month,
                 user_id,
                 create_date,
                 matter_num,
                 box_num,
                 goal_type,
                 org_id,
                 goal_mark,
                 status
                 )
                 values(
                 #kunnr#,
                 #goalYear#,
                 #goalMonth#,
                 #userId#,
                 sysdate,
                 #matterNum#,
                 #boxNum#,
                 #goalType#,
                 #orgId#,
                 #goalMark#,
                 'U'
                 )
	    ]]> 
	</insert>
	
	<select id="getLastStockByCG" parameterClass="stockReport"
		resultClass="java.lang.Integer">
		<![CDATA[
		select sum(t.quantity) as quantity
           from crm.crm_tb_kunnr_stock t
           where t.check_time =
            (select max(t1.check_time)
             from crm.crm_tb_kunnr_stock t1
           where t1.check_time <#checkTime#)
		       ]]>
		<dynamic>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ t.sku_category_id = #categoryId#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ t.flag = #flag#]]>
		</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="getLastCheckTime" parameterClass="stockReport"
		resultClass="java.lang.String">
		<![CDATA[
		select max(t.check_time)
             from crm.crm_tb_kunnr_stock t
             where t.check_time <=#checkTime# and flag in ('kunnr_week','kunnr_month')
		       ]]>
		<dynamic>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ t.sku_category_id = #categoryId#]]>
		</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="getStockManagerSapListCount" parameterClass="stockManagerSap"
		resultClass="java.lang.Integer">
		<![CDATA[
		select count(*)
               from crm.crm_tb_kunnr_stock_manager t
               where 1=1
		       ]]>
		<dynamic>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="createDate" prepend="and">
			<![CDATA[ t.create_date = #createDate#]]>
		</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="getStockManagerSapList" parameterClass="stockManagerSap"
		resultClass="stockManagerSap">
		<include refid="global.paginationStart" />
		<![CDATA[
		select t.kunnr as kunnr,
		       t.matter_num as matterNum,
               t.on_way onWayNum,
               t.out_put_not outPutNotNum,
               t.create_date createDate
               from crm.crm_tb_kunnr_stock_manager t
               where 1=1
		       ]]>
		<dynamic>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="createDate" prepend="and">
			<![CDATA[ t.create_date = #createDate#]]>
		</isNotEmpty>
	    </dynamic>
	    <include refid="global.paginationEnd" />
	</select>
	
	<select id="getStockManagerSap" parameterClass="stockManagerSap"
		resultClass="stockManagerSap">
		<![CDATA[
		select t.kunnr as kunnr,
		       t.matter_num as matterNum,
               t.on_way onWayNum,
               t.out_put_not outPutNotNum,
               t.create_date createDate,
               t.out_put_not_check as outPutNotCheck,
               t.stock_pod as stockPod
               from crm.crm_tb_kunnr_stock_manager t
               where 1=1
		       ]]>
		<dynamic>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
		<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ t.matter_num = #matterNum#]]>
		</isNotEmpty>
		<isNotEmpty property="createDate" prepend="and">
			<![CDATA[ t.create_date = #createDate#]]>
		</isNotEmpty>
	    </dynamic>
	</select>
	
	<insert id="createStockManagerSap" parameterClass="stockManagerSap">
	    insert into crm.crm_tb_kunnr_stock_manager(
	         kunnr,
	         matter_num,
	         on_way,
             out_put_not,
             create_date,
             out_put_not_check,
             stock_pod
	    ) values (
	         #kunnr#,
		     #matterNum#,
             #onWayNum#,
             #outPutNotNum#,
             #createDate#,
             #outPutNotCheck#,
             #stockPod#
	    )
	</insert>
	
	<select id="searchPodListCount" parameterClass="pod" resultClass="java.lang.Integer">
		<![CDATA[
		select count(*)
               from crm.crm_tb_kunnr_pod t
               where 1=1
		       ]]>
		<dynamic>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="mvgr1" prepend="and">
			<![CDATA[ t.mvgr1 = #mvgr1#]]>
		</isNotEmpty>
		<isNotEmpty property="createDate" prepend="and">
			<![CDATA[ t.create_date = #createDate#]]>
		</isNotEmpty>
	    </dynamic>
	</select>
	
	<insert id="createPod" parameterClass="pod">
	    <![CDATA[
	       insert into crm.crm_tb_kunnr_pod(
	           kunnr,
	           mvgr1,
	           lfimg,
	           vrkme,
	           create_date
	       ) values (
	           #kunnr#,
	           #mvgr1#,
	           #lfimg#,
	           #vrkme#,
	           #createDate#
	       )
	    ]]>
	</insert>
	
	<select id="getStockReportSalesByCGListCount" parameterClass="stockReport"
		resultClass="java.lang.Integer">
		<![CDATA[select count(*)
		from 
		   ( select nvl(nvl(s.kunnr,p.kunnr),s1.kunnr) as kunnr,
                 nvl(s.cg1,0)as cg1, 
                 nvl(s.cg2,0)as cg2,
                 nvl(s.cg3,0)as cg3,
                 nvl(s.cg4,0)as cg4,
                 nvl(s.cg5,0)as cg5,
                 nvl(s.cg6,0)as cg6,
                 nvl(s.cg7,0)as cg7,
                 nvl(s.cg8,0)as cg8,
                 nvl(s.cg9,0)as cg9,
                 nvl(s.cg10,0)as cg10,
                 nvl(s.cg11,0)as cg11, 
                 nvl(s.cg12,0)as cg12,
                 nvl(s.cg13,0)as cg13,
                 nvl(s.cg14,0)as cg14,
                 nvl(s.cg15,0)as cg15,
                 nvl(s.cg16,0)as cg16,
                 nvl(s.cg17,0)as cg17,
                 nvl(s.cg18,0)as cg18,
                 nvl(s.cg19,0)as cg19,
                 nvl(s.cg20,0)as cg20,
                 nvl(p.pod1,0)as pod1, 
                 nvl(p.pod2,0)as pod2,
                 nvl(p.pod3,0)as pod3,
                 nvl(p.pod4,0)as pod4,
                 nvl(p.pod5,0)as pod5,
                 nvl(p.pod6,0)as pod6,
                 nvl(p.pod7,0)as pod7,
                 nvl(p.pod8,0)as pod8,
                 nvl(p.pod9,0)as pod9,
                 nvl(p.pod10,0)as pod10,
                 nvl(p.pod11,0)as pod11, 
                 nvl(p.pod12,0)as pod12,
                 nvl(p.pod13,0)as pod13,
                 nvl(p.pod14,0)as pod14,
                 nvl(p.pod15,0)as pod15,
                 nvl(p.pod16,0)as pod16,
                 nvl(p.pod17,0)as pod17,
                 nvl(p.pod18,0)as pod18,
                 nvl(p.pod19,0)as pod19,
                 nvl(p.pod20,0)as pod20,
                 nvl(s1.lastStock1,0)as lastStock1, 
                 nvl(s1.lastStock2,0)as lastStock2,
                 nvl(s1.lastStock3,0)as lastStock3,
                 nvl(s1.lastStock4,0)as lastStock4,
                 nvl(s1.lastStock5,0)as lastStock5,
                 nvl(s1.lastStock6,0)as lastStock6,
                 nvl(s1.lastStock7,0)as lastStock7,
                 nvl(s1.lastStock8,0)as lastStock8,
                 nvl(s1.lastStock9,0)as lastStock9,
                 nvl(s1.lastStock10,0)as lastStock10,
                 nvl(s1.lastStock11,0)as lastStock11, 
                 nvl(s1.lastStock12,0)as lastStock12,
                 nvl(s1.lastStock13,0)as lastStock13,
                 nvl(s1.lastStock14,0)as lastStock14,
                 nvl(s1.lastStock15,0)as lastStock15,
                 nvl(s1.lastStock16,0)as lastStock16,
                 nvl(s1.lastStock17,0)as lastStock17,
                 nvl(s1.lastStock18,0)as lastStock18,
                 nvl(s1.lastStock19,0)as lastStock19,
                 nvl(s1.lastStock20,0)as lastStock20 
        from
        (select 
               s.kunnr as kunnr,
               sum(decode(s.sku_category_id,'1002',s.quantity,'0')) as cg1,
               sum(decode(s.sku_category_id,'1869',s.quantity,'0')) as cg2,
               sum(decode(s.sku_category_id,'1007',s.quantity,'0')) as cg3,
               sum(decode(s.sku_category_id,'1895',s.quantity,'0')) as cg4,
               sum(decode(s.sku_category_id,'1008',s.quantity,'0')) as cg5,
               sum(decode(s.sku_category_id,'1894',s.quantity,'0')) as cg6,
               sum(decode(s.sku_category_id,'1893',s.quantity,'0')) as cg7,
               sum(decode(s.sku_category_id,'1006',s.quantity,'0')) as cg8,
               sum(decode(s.sku_category_id,'1003',s.quantity,'0')) as cg9,
               sum(decode(s.sku_category_id,'1890',s.quantity,'0')) as cg10,
               sum(decode(s.sku_category_id,'1891',s.quantity,'0')) as cg11,
               sum(decode(s.sku_category_id,'1892',s.quantity,'0')) as cg12,
               sum(decode(s.sku_category_id,'1004',s.quantity,'0')) as cg13,
               sum(decode(s.sku_category_id,'1889',s.quantity,'0')) as cg14,
               sum(decode(s.sku_category_id,'1888',s.quantity,'0')) as cg15,
               sum(decode(s.sku_category_id,'1887',s.quantity,'0')) as cg16,
               sum(decode(s.sku_category_id,'1883',s.quantity,'0')) as cg17,
               sum(decode(s.sku_category_id,'1886',s.quantity,'0')) as cg18,
               sum(decode(s.sku_category_id,'1884',s.quantity,'0')) as cg19,
               sum(decode(s.sku_category_id,'1009',s.quantity,'0')) as cg20
               from crm.crm_tb_kunnr_stock s
               left join crm.crm_tb_kunnr_kunag kg on kg.kunnr = s.kunnr
               where kg.kunag is null ]]>
               <dynamic>
		       <isNotEmpty property="checkTime" prepend="and">
			     <![CDATA[ s.check_time = #checkTime#]]>
		       </isNotEmpty>
		       </dynamic>
         <![CDATA[group by s.kunnr
         
         union all      
               
         select 
               kg1.kunag as kunnr,
               sum(decode(ss.sku_category_id,'1002',ss.quantity,'0')) as cg1,
               sum(decode(ss.sku_category_id,'1869',ss.quantity,'0')) as cg2,
               sum(decode(ss.sku_category_id,'1007',ss.quantity,'0')) as cg3,
               sum(decode(ss.sku_category_id,'1895',ss.quantity,'0')) as cg4,
               sum(decode(ss.sku_category_id,'1008',ss.quantity,'0')) as cg5,
               sum(decode(ss.sku_category_id,'1894',ss.quantity,'0')) as cg6,
               sum(decode(ss.sku_category_id,'1893',ss.quantity,'0')) as cg7,
               sum(decode(ss.sku_category_id,'1006',ss.quantity,'0')) as cg8,
               sum(decode(ss.sku_category_id,'1003',ss.quantity,'0')) as cg9,
               sum(decode(ss.sku_category_id,'1890',ss.quantity,'0')) as cg10,
               sum(decode(ss.sku_category_id,'1891',ss.quantity,'0')) as cg11,
               sum(decode(ss.sku_category_id,'1892',ss.quantity,'0')) as cg12,
               sum(decode(ss.sku_category_id,'1004',ss.quantity,'0')) as cg13,
               sum(decode(ss.sku_category_id,'1889',ss.quantity,'0')) as cg14,
               sum(decode(ss.sku_category_id,'1888',ss.quantity,'0')) as cg15,
               sum(decode(ss.sku_category_id,'1887',ss.quantity,'0')) as cg16,
               sum(decode(ss.sku_category_id,'1883',ss.quantity,'0')) as cg17,
               sum(decode(ss.sku_category_id,'1886',ss.quantity,'0')) as cg18,
               sum(decode(ss.sku_category_id,'1884',ss.quantity,'0')) as cg19,
               sum(decode(ss.sku_category_id,'1009',ss.quantity,'0')) as cg20
               from crm.crm_tb_kunnr_stock ss
               left join crm.crm_tb_kunnr_kunag kg1 on kg1.kunnr = ss.kunnr
               where kg1.kunag is not null ]]>
               <dynamic>
		       <isNotEmpty property="checkTime" prepend="and">
			     <![CDATA[ ss.check_time = #checkTime#]]>
		       </isNotEmpty>
		       </dynamic>
        <![CDATA[group by kg1.kunag
               ) s
        full join       
        (select 
               p.kunnr as kunnr,
               sum(decode(p.mvgr1,'A1',p.lfimg,'0')) as pod1,
               sum(decode(p.mvgr1,'A2',p.lfimg,'0')) as pod2,
               sum(decode(p.mvgr1,'A3',p.lfimg,'0')) as pod3,
               sum(decode(p.mvgr1,'A4',p.lfimg,'0')) as pod4,
               sum(decode(p.mvgr1,'A5',p.lfimg,'0')) as pod5,
               sum(decode(p.mvgr1,'A6',p.lfimg,'0')) as pod6,
               sum(decode(p.mvgr1,'A7',p.lfimg,'0')) as pod7,
               sum(decode(p.mvgr1,'A8',p.lfimg,'0')) as pod8,
               sum(decode(p.mvgr1,'B1',p.lfimg,'0')) as pod9,
               sum(decode(p.mvgr1,'B3',p.lfimg,'0')) as pod10,
               sum(decode(p.mvgr1,'B6',p.lfimg,'0')) as pod11,
               sum(decode(p.mvgr1,'B8',p.lfimg,'0')) as pod12,
               sum(decode(p.mvgr1,'C1',p.lfimg,'0')) as pod13,
               sum(decode(p.mvgr1,'C6',p.lfimg,'0')) as pod14,
               sum(decode(p.mvgr1,'C7',p.lfimg,'0')) as pod15,
               sum(decode(p.mvgr1,'C8',p.lfimg,'0')) as pod16,
               sum(decode(p.mvgr1,'D10',p.lfimg,'0')) as pod17,
               sum(decode(p.mvgr1,'D9',p.lfimg,'0')) as pod18,
               sum(decode(p.mvgr1,'E1',p.lfimg,'0')) as pod19,
               sum(decode(p.mvgr1,'H7',p.lfimg,'0')) as pod20
               from crm.crm_tb_kunnr_pod p
               left join crm.crm_tb_kunnr_kunag kg on kg.kunnr = p.kunnr
               where kg.kunag is null ]]>
               <dynamic>
		       <isNotEmpty property="checkTime" prepend="and">
			     <![CDATA[ p.create_date = #checkTime#]]>
		       </isNotEmpty>
		       </dynamic>
         <![CDATA[ group by p.kunnr
        
        union all
        
        select 
               kg1.kunag as kunnr,
               sum(decode(pp.mvgr1,'A1',pp.lfimg,'0')) as pod1,
               sum(decode(pp.mvgr1,'A2',pp.lfimg,'0')) as pod2,
               sum(decode(pp.mvgr1,'A3',pp.lfimg,'0')) as pod3,
               sum(decode(pp.mvgr1,'A4',pp.lfimg,'0')) as pod4,
               sum(decode(pp.mvgr1,'A5',pp.lfimg,'0')) as pod5,
               sum(decode(pp.mvgr1,'A6',pp.lfimg,'0')) as pod6,
               sum(decode(pp.mvgr1,'A7',pp.lfimg,'0')) as pod7,
               sum(decode(pp.mvgr1,'A8',pp.lfimg,'0')) as pod8,
               sum(decode(pp.mvgr1,'B1',pp.lfimg,'0')) as pod9,
               sum(decode(pp.mvgr1,'B3',pp.lfimg,'0')) as pod10,
               sum(decode(pp.mvgr1,'B6',pp.lfimg,'0')) as pod11,
               sum(decode(pp.mvgr1,'B8',pp.lfimg,'0')) as pod12,
               sum(decode(pp.mvgr1,'C1',pp.lfimg,'0')) as pod13,
               sum(decode(pp.mvgr1,'C6',pp.lfimg,'0')) as pod14,
               sum(decode(pp.mvgr1,'C7',pp.lfimg,'0')) as pod15,
               sum(decode(pp.mvgr1,'C8',pp.lfimg,'0')) as pod16,
               sum(decode(pp.mvgr1,'D10',pp.lfimg,'0')) as pod17,
               sum(decode(pp.mvgr1,'D9',pp.lfimg,'0')) as pod18,
               sum(decode(pp.mvgr1,'E1',pp.lfimg,'0')) as pod19,
               sum(decode(pp.mvgr1,'H7',pp.lfimg,'0')) as pod20
               from crm.crm_tb_kunnr_pod pp
               left join crm.crm_tb_kunnr_kunag kg1 on kg1.kunnr = pp.kunnr
               where kg1.kunag is not null ]]>
               <dynamic>
		       <isNotEmpty property="checkTime" prepend="and">
			     <![CDATA[ pp.create_date = #checkTime#]]>
		       </isNotEmpty>
		       </dynamic>
         <![CDATA[group by kg1.kunag
               ) p on s.kunnr = p.kunnr
        full join    
       (select  
               s1.kunnr as kunnr,
               sum(decode(s1.sku_category_id,'1002',s1.quantity,'0')) as lastStock1,
               sum(decode(s1.sku_category_id,'1869',s1.quantity,'0')) as lastStock2,
               sum(decode(s1.sku_category_id,'1007',s1.quantity,'0')) as lastStock3,
               sum(decode(s1.sku_category_id,'1895',s1.quantity,'0')) as lastStock4,
               sum(decode(s1.sku_category_id,'1008',s1.quantity,'0')) as lastStock5,
               sum(decode(s1.sku_category_id,'1894',s1.quantity,'0')) as lastStock6,
               sum(decode(s1.sku_category_id,'1893',s1.quantity,'0')) as lastStock7,
               sum(decode(s1.sku_category_id,'1006',s1.quantity,'0')) as lastStock8,
               sum(decode(s1.sku_category_id,'1003',s1.quantity,'0')) as lastStock9,
               sum(decode(s1.sku_category_id,'1890',s1.quantity,'0')) as lastStock10,
               sum(decode(s1.sku_category_id,'1891',s1.quantity,'0')) as lastStock11,
               sum(decode(s1.sku_category_id,'1892',s1.quantity,'0')) as lastStock12,
               sum(decode(s1.sku_category_id,'1004',s1.quantity,'0')) as lastStock13,
               sum(decode(s1.sku_category_id,'1889',s1.quantity,'0')) as lastStock14,
               sum(decode(s1.sku_category_id,'1888',s1.quantity,'0')) as lastStock15,
               sum(decode(s1.sku_category_id,'1887',s1.quantity,'0')) as lastStock16,
               sum(decode(s1.sku_category_id,'1883',s1.quantity,'0')) as lastStock17,
               sum(decode(s1.sku_category_id,'1886',s1.quantity,'0')) as lastStock18,
               sum(decode(s1.sku_category_id,'1884',s1.quantity,'0')) as lastStock19,
               sum(decode(s1.sku_category_id,'1009',s1.quantity,'0')) as lastStock20
               from crm.crm_tb_kunnr_stock s1
               left join crm.crm_tb_kunnr_kunag kg on kg.kunnr = s1.kunnr
               where kg.kunag is null and s1.flag='kunnr_month']]>
               <dynamic>
		       <isNotEmpty property="productionDate" prepend="and">
			     <![CDATA[ s1.check_time = #productionDate#]]>
		       </isNotEmpty>
		       </dynamic>
          <![CDATA[      group by s1.kunnr
         
         union all
        
         select  
               kg1.kunag as kunnr,
               sum(decode(ss1.sku_category_id,'1002',ss1.quantity,'0')) as lastStock1,
               sum(decode(ss1.sku_category_id,'1869',ss1.quantity,'0')) as lastStock2,
               sum(decode(ss1.sku_category_id,'1007',ss1.quantity,'0')) as lastStock3,
               sum(decode(ss1.sku_category_id,'1895',ss1.quantity,'0')) as lastStock4,
               sum(decode(ss1.sku_category_id,'1008',ss1.quantity,'0')) as lastStock5,
               sum(decode(ss1.sku_category_id,'1894',ss1.quantity,'0')) as lastStock6,
               sum(decode(ss1.sku_category_id,'1893',ss1.quantity,'0')) as lastStock7,
               sum(decode(ss1.sku_category_id,'1006',ss1.quantity,'0')) as lastStock8,
               sum(decode(ss1.sku_category_id,'1003',ss1.quantity,'0')) as lastStock9,
               sum(decode(ss1.sku_category_id,'1890',ss1.quantity,'0')) as lastStock10,
               sum(decode(ss1.sku_category_id,'1891',ss1.quantity,'0')) as lastStock11,
               sum(decode(ss1.sku_category_id,'1892',ss1.quantity,'0')) as lastStock12,
               sum(decode(ss1.sku_category_id,'1004',ss1.quantity,'0')) as lastStock13,
               sum(decode(ss1.sku_category_id,'1889',ss1.quantity,'0')) as lastStock14,
               sum(decode(ss1.sku_category_id,'1888',ss1.quantity,'0')) as lastStock15,
               sum(decode(ss1.sku_category_id,'1887',ss1.quantity,'0')) as lastStock16,
               sum(decode(ss1.sku_category_id,'1883',ss1.quantity,'0')) as lastStock17,
               sum(decode(ss1.sku_category_id,'1886',ss1.quantity,'0')) as lastStock18,
               sum(decode(ss1.sku_category_id,'1884',ss1.quantity,'0')) as lastStock19,
               sum(decode(ss1.sku_category_id,'1009',ss1.quantity,'0')) as lastStock20
               from crm.crm_tb_kunnr_stock ss1
               left join crm.crm_tb_kunnr_kunag kg1 on kg1.kunnr = ss1.kunnr
               where kg1.kunag is not null and ss1.flag='kunnr_month' ]]>
               <dynamic>
		       <isNotEmpty property="productionDate" prepend="and">
			     <![CDATA[ ss1.check_time = #productionDate#]]>
		       </isNotEmpty>
		       </dynamic>
        <![CDATA[group by kg1.kunag
               ) s1 on p.kunnr = s1.kunnr 
               ) t
               left join crm.crm_tb_kunnr k on k.kunnr = t.kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       where 1=1
		    ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
		</dynamic>
		    <![CDATA[ order by ot.p_org_name,t.kunnr]]>
	</select>
	
	<select id="getStockReportSalesByCGList" parameterClass="stockReport"
		resultClass="stockReport">
		<include refid="global.paginationStart" />
		 <![CDATA[select t.*,
		       k.name1 as kunnrName,
		       ot.p_org_name as orgProvince,
		       ot.org_name as orgCity,
		       ot.rc_org_name as orgRegion
		from 
		   ( select nvl(nvl(s.kunnr,p.kunnr),s1.kunnr) as kunnr,
                 nvl(s.cg1,0)as cg1, 
                 nvl(s.cg2,0)as cg2,
                 nvl(s.cg3,0)as cg3,
                 nvl(s.cg4,0)as cg4,
                 nvl(s.cg5,0)as cg5,
                 nvl(s.cg6,0)as cg6,
                 nvl(s.cg7,0)as cg7,
                 nvl(s.cg8,0)as cg8,
                 nvl(s.cg9,0)as cg9,
                 nvl(s.cg10,0)as cg10,
                 nvl(s.cg11,0)as cg11, 
                 nvl(s.cg12,0)as cg12,
                 nvl(s.cg13,0)as cg13,
                 nvl(s.cg14,0)as cg14,
                 nvl(s.cg15,0)as cg15,
                 nvl(s.cg16,0)as cg16,
                 nvl(s.cg17,0)as cg17,
                 nvl(s.cg18,0)as cg18,
                 nvl(s.cg19,0)as cg19,
                 nvl(s.cg20,0)as cg20,
                 nvl(p.pod1,0)as pod1, 
                 nvl(p.pod2,0)as pod2,
                 nvl(p.pod3,0)as pod3,
                 nvl(p.pod4,0)as pod4,
                 nvl(p.pod5,0)as pod5,
                 nvl(p.pod6,0)as pod6,
                 nvl(p.pod7,0)as pod7,
                 nvl(p.pod8,0)as pod8,
                 nvl(p.pod9,0)as pod9,
                 nvl(p.pod10,0)as pod10,
                 nvl(p.pod11,0)as pod11, 
                 nvl(p.pod12,0)as pod12,
                 nvl(p.pod13,0)as pod13,
                 nvl(p.pod14,0)as pod14,
                 nvl(p.pod15,0)as pod15,
                 nvl(p.pod16,0)as pod16,
                 nvl(p.pod17,0)as pod17,
                 nvl(p.pod18,0)as pod18,
                 nvl(p.pod19,0)as pod19,
                 nvl(p.pod20,0)as pod20,
                 nvl(s1.lastStock1,0)as lastStock1, 
                 nvl(s1.lastStock2,0)as lastStock2,
                 nvl(s1.lastStock3,0)as lastStock3,
                 nvl(s1.lastStock4,0)as lastStock4,
                 nvl(s1.lastStock5,0)as lastStock5,
                 nvl(s1.lastStock6,0)as lastStock6,
                 nvl(s1.lastStock7,0)as lastStock7,
                 nvl(s1.lastStock8,0)as lastStock8,
                 nvl(s1.lastStock9,0)as lastStock9,
                 nvl(s1.lastStock10,0)as lastStock10,
                 nvl(s1.lastStock11,0)as lastStock11, 
                 nvl(s1.lastStock12,0)as lastStock12,
                 nvl(s1.lastStock13,0)as lastStock13,
                 nvl(s1.lastStock14,0)as lastStock14,
                 nvl(s1.lastStock15,0)as lastStock15,
                 nvl(s1.lastStock16,0)as lastStock16,
                 nvl(s1.lastStock17,0)as lastStock17,
                 nvl(s1.lastStock18,0)as lastStock18,
                 nvl(s1.lastStock19,0)as lastStock19,
                 nvl(s1.lastStock20,0)as lastStock20 
        from
        (select 
               s.kunnr as kunnr,
               sum(decode(s.sku_category_id,'1002',s.quantity,'0')) as cg1,
               sum(decode(s.sku_category_id,'1869',s.quantity,'0')) as cg2,
               sum(decode(s.sku_category_id,'1007',s.quantity,'0')) as cg3,
               sum(decode(s.sku_category_id,'1895',s.quantity,'0')) as cg4,
               sum(decode(s.sku_category_id,'1008',s.quantity,'0')) as cg5,
               sum(decode(s.sku_category_id,'1894',s.quantity,'0')) as cg6,
               sum(decode(s.sku_category_id,'1893',s.quantity,'0')) as cg7,
               sum(decode(s.sku_category_id,'1006',s.quantity,'0')) as cg8,
               sum(decode(s.sku_category_id,'1003',s.quantity,'0')) as cg9,
               sum(decode(s.sku_category_id,'1890',s.quantity,'0')) as cg10,
               sum(decode(s.sku_category_id,'1891',s.quantity,'0')) as cg11,
               sum(decode(s.sku_category_id,'1892',s.quantity,'0')) as cg12,
               sum(decode(s.sku_category_id,'1004',s.quantity,'0')) as cg13,
               sum(decode(s.sku_category_id,'1889',s.quantity,'0')) as cg14,
               sum(decode(s.sku_category_id,'1888',s.quantity,'0')) as cg15,
               sum(decode(s.sku_category_id,'1887',s.quantity,'0')) as cg16,
               sum(decode(s.sku_category_id,'1883',s.quantity,'0')) as cg17,
               sum(decode(s.sku_category_id,'1886',s.quantity,'0')) as cg18,
               sum(decode(s.sku_category_id,'1884',s.quantity,'0')) as cg19,
               sum(decode(s.sku_category_id,'1009',s.quantity,'0')) as cg20
               from crm.crm_tb_kunnr_stock s
               left join crm.crm_tb_kunnr_kunag kg on kg.kunnr = s.kunnr
               where kg.kunag is null ]]>
               <dynamic>
		       <isNotEmpty property="checkTime" prepend="and">
			     <![CDATA[ s.check_time = #checkTime#]]>
		       </isNotEmpty>
		       </dynamic>
         <![CDATA[group by s.kunnr
         
         union all      
               
         select 
               kg1.kunag as kunnr,
               sum(decode(ss.sku_category_id,'1002',ss.quantity,'0')) as cg1,
               sum(decode(ss.sku_category_id,'1869',ss.quantity,'0')) as cg2,
               sum(decode(ss.sku_category_id,'1007',ss.quantity,'0')) as cg3,
               sum(decode(ss.sku_category_id,'1895',ss.quantity,'0')) as cg4,
               sum(decode(ss.sku_category_id,'1008',ss.quantity,'0')) as cg5,
               sum(decode(ss.sku_category_id,'1894',ss.quantity,'0')) as cg6,
               sum(decode(ss.sku_category_id,'1893',ss.quantity,'0')) as cg7,
               sum(decode(ss.sku_category_id,'1006',ss.quantity,'0')) as cg8,
               sum(decode(ss.sku_category_id,'1003',ss.quantity,'0')) as cg9,
               sum(decode(ss.sku_category_id,'1890',ss.quantity,'0')) as cg10,
               sum(decode(ss.sku_category_id,'1891',ss.quantity,'0')) as cg11,
               sum(decode(ss.sku_category_id,'1892',ss.quantity,'0')) as cg12,
               sum(decode(ss.sku_category_id,'1004',ss.quantity,'0')) as cg13,
               sum(decode(ss.sku_category_id,'1889',ss.quantity,'0')) as cg14,
               sum(decode(ss.sku_category_id,'1888',ss.quantity,'0')) as cg15,
               sum(decode(ss.sku_category_id,'1887',ss.quantity,'0')) as cg16,
               sum(decode(ss.sku_category_id,'1883',ss.quantity,'0')) as cg17,
               sum(decode(ss.sku_category_id,'1886',ss.quantity,'0')) as cg18,
               sum(decode(ss.sku_category_id,'1884',ss.quantity,'0')) as cg19,
               sum(decode(ss.sku_category_id,'1009',ss.quantity,'0')) as cg20
               from crm.crm_tb_kunnr_stock ss
               left join crm.crm_tb_kunnr_kunag kg1 on kg1.kunnr = ss.kunnr
               where kg1.kunag is not null ]]>
               <dynamic>
		       <isNotEmpty property="checkTime" prepend="and">
			     <![CDATA[ ss.check_time = #checkTime#]]>
		       </isNotEmpty>
		       </dynamic>
        <![CDATA[group by kg1.kunag
               ) s
        full join       
        (select 
               p.kunnr as kunnr,
               sum(decode(p.mvgr1,'A1',p.lfimg,'0')) as pod1,
               sum(decode(p.mvgr1,'A2',p.lfimg,'0')) as pod2,
               sum(decode(p.mvgr1,'A3',p.lfimg,'0')) as pod3,
               sum(decode(p.mvgr1,'A4',p.lfimg,'0')) as pod4,
               sum(decode(p.mvgr1,'A5',p.lfimg,'0')) as pod5,
               sum(decode(p.mvgr1,'A6',p.lfimg,'0')) as pod6,
               sum(decode(p.mvgr1,'A7',p.lfimg,'0')) as pod7,
               sum(decode(p.mvgr1,'A8',p.lfimg,'0')) as pod8,
               sum(decode(p.mvgr1,'B1',p.lfimg,'0')) as pod9,
               sum(decode(p.mvgr1,'B3',p.lfimg,'0')) as pod10,
               sum(decode(p.mvgr1,'B6',p.lfimg,'0')) as pod11,
               sum(decode(p.mvgr1,'B8',p.lfimg,'0')) as pod12,
               sum(decode(p.mvgr1,'C1',p.lfimg,'0')) as pod13,
               sum(decode(p.mvgr1,'C6',p.lfimg,'0')) as pod14,
               sum(decode(p.mvgr1,'C7',p.lfimg,'0')) as pod15,
               sum(decode(p.mvgr1,'C8',p.lfimg,'0')) as pod16,
               sum(decode(p.mvgr1,'D10',p.lfimg,'0')) as pod17,
               sum(decode(p.mvgr1,'D9',p.lfimg,'0')) as pod18,
               sum(decode(p.mvgr1,'E1',p.lfimg,'0')) as pod19,
               sum(decode(p.mvgr1,'H7',p.lfimg,'0')) as pod20
               from crm.crm_tb_kunnr_pod p
               left join crm.crm_tb_kunnr_kunag kg on kg.kunnr = p.kunnr
               where kg.kunag is null ]]>
               <dynamic>
		       <isNotEmpty property="checkTime" prepend="and">
			     <![CDATA[ p.create_date = #checkTime#]]>
		       </isNotEmpty>
		       </dynamic>
         <![CDATA[ group by p.kunnr
        
        union all
        
        select 
               kg1.kunag as kunnr,
               sum(decode(pp.mvgr1,'A1',pp.lfimg,'0')) as pod1,
               sum(decode(pp.mvgr1,'A2',pp.lfimg,'0')) as pod2,
               sum(decode(pp.mvgr1,'A3',pp.lfimg,'0')) as pod3,
               sum(decode(pp.mvgr1,'A4',pp.lfimg,'0')) as pod4,
               sum(decode(pp.mvgr1,'A5',pp.lfimg,'0')) as pod5,
               sum(decode(pp.mvgr1,'A6',pp.lfimg,'0')) as pod6,
               sum(decode(pp.mvgr1,'A7',pp.lfimg,'0')) as pod7,
               sum(decode(pp.mvgr1,'A8',pp.lfimg,'0')) as pod8,
               sum(decode(pp.mvgr1,'B1',pp.lfimg,'0')) as pod9,
               sum(decode(pp.mvgr1,'B3',pp.lfimg,'0')) as pod10,
               sum(decode(pp.mvgr1,'B6',pp.lfimg,'0')) as pod11,
               sum(decode(pp.mvgr1,'B8',pp.lfimg,'0')) as pod12,
               sum(decode(pp.mvgr1,'C1',pp.lfimg,'0')) as pod13,
               sum(decode(pp.mvgr1,'C6',pp.lfimg,'0')) as pod14,
               sum(decode(pp.mvgr1,'C7',pp.lfimg,'0')) as pod15,
               sum(decode(pp.mvgr1,'C8',pp.lfimg,'0')) as pod16,
               sum(decode(pp.mvgr1,'D10',pp.lfimg,'0')) as pod17,
               sum(decode(pp.mvgr1,'D9',pp.lfimg,'0')) as pod18,
               sum(decode(pp.mvgr1,'E1',pp.lfimg,'0')) as pod19,
               sum(decode(pp.mvgr1,'H7',pp.lfimg,'0')) as pod20
               from crm.crm_tb_kunnr_pod pp
               left join crm.crm_tb_kunnr_kunag kg1 on kg1.kunnr = pp.kunnr
               where kg1.kunag is not null ]]>
               <dynamic>
		       <isNotEmpty property="checkTime" prepend="and">
			     <![CDATA[ pp.create_date = #checkTime#]]>
		       </isNotEmpty>
		       </dynamic>
         <![CDATA[group by kg1.kunag
               ) p on s.kunnr = p.kunnr
        full join    
       (select  
               s1.kunnr as kunnr,
               sum(decode(s1.sku_category_id,'1002',s1.quantity,'0')) as lastStock1,
               sum(decode(s1.sku_category_id,'1869',s1.quantity,'0')) as lastStock2,
               sum(decode(s1.sku_category_id,'1007',s1.quantity,'0')) as lastStock3,
               sum(decode(s1.sku_category_id,'1895',s1.quantity,'0')) as lastStock4,
               sum(decode(s1.sku_category_id,'1008',s1.quantity,'0')) as lastStock5,
               sum(decode(s1.sku_category_id,'1894',s1.quantity,'0')) as lastStock6,
               sum(decode(s1.sku_category_id,'1893',s1.quantity,'0')) as lastStock7,
               sum(decode(s1.sku_category_id,'1006',s1.quantity,'0')) as lastStock8,
               sum(decode(s1.sku_category_id,'1003',s1.quantity,'0')) as lastStock9,
               sum(decode(s1.sku_category_id,'1890',s1.quantity,'0')) as lastStock10,
               sum(decode(s1.sku_category_id,'1891',s1.quantity,'0')) as lastStock11,
               sum(decode(s1.sku_category_id,'1892',s1.quantity,'0')) as lastStock12,
               sum(decode(s1.sku_category_id,'1004',s1.quantity,'0')) as lastStock13,
               sum(decode(s1.sku_category_id,'1889',s1.quantity,'0')) as lastStock14,
               sum(decode(s1.sku_category_id,'1888',s1.quantity,'0')) as lastStock15,
               sum(decode(s1.sku_category_id,'1887',s1.quantity,'0')) as lastStock16,
               sum(decode(s1.sku_category_id,'1883',s1.quantity,'0')) as lastStock17,
               sum(decode(s1.sku_category_id,'1886',s1.quantity,'0')) as lastStock18,
               sum(decode(s1.sku_category_id,'1884',s1.quantity,'0')) as lastStock19,
               sum(decode(s1.sku_category_id,'1009',s1.quantity,'0')) as lastStock20
               from crm.crm_tb_kunnr_stock s1
               left join crm.crm_tb_kunnr_kunag kg on kg.kunnr = s1.kunnr
               where kg.kunag is null and s1.flag='kunnr_month' ]]>
               <dynamic>
		       <isNotEmpty property="productionDate" prepend="and">
			     <![CDATA[ s1.check_time = #productionDate#]]>
		       </isNotEmpty>
		       </dynamic>
          <![CDATA[      group by s1.kunnr
         
         union all
        
         select  
               kg1.kunag as kunnr,
               sum(decode(ss1.sku_category_id,'1002',ss1.quantity,'0')) as lastStock1,
               sum(decode(ss1.sku_category_id,'1869',ss1.quantity,'0')) as lastStock2,
               sum(decode(ss1.sku_category_id,'1007',ss1.quantity,'0')) as lastStock3,
               sum(decode(ss1.sku_category_id,'1895',ss1.quantity,'0')) as lastStock4,
               sum(decode(ss1.sku_category_id,'1008',ss1.quantity,'0')) as lastStock5,
               sum(decode(ss1.sku_category_id,'1894',ss1.quantity,'0')) as lastStock6,
               sum(decode(ss1.sku_category_id,'1893',ss1.quantity,'0')) as lastStock7,
               sum(decode(ss1.sku_category_id,'1006',ss1.quantity,'0')) as lastStock8,
               sum(decode(ss1.sku_category_id,'1003',ss1.quantity,'0')) as lastStock9,
               sum(decode(ss1.sku_category_id,'1890',ss1.quantity,'0')) as lastStock10,
               sum(decode(ss1.sku_category_id,'1891',ss1.quantity,'0')) as lastStock11,
               sum(decode(ss1.sku_category_id,'1892',ss1.quantity,'0')) as lastStock12,
               sum(decode(ss1.sku_category_id,'1004',ss1.quantity,'0')) as lastStock13,
               sum(decode(ss1.sku_category_id,'1889',ss1.quantity,'0')) as lastStock14,
               sum(decode(ss1.sku_category_id,'1888',ss1.quantity,'0')) as lastStock15,
               sum(decode(ss1.sku_category_id,'1887',ss1.quantity,'0')) as lastStock16,
               sum(decode(ss1.sku_category_id,'1883',ss1.quantity,'0')) as lastStock17,
               sum(decode(ss1.sku_category_id,'1886',ss1.quantity,'0')) as lastStock18,
               sum(decode(ss1.sku_category_id,'1884',ss1.quantity,'0')) as lastStock19,
               sum(decode(ss1.sku_category_id,'1009',ss1.quantity,'0')) as lastStock20
               from crm.crm_tb_kunnr_stock ss1
               left join crm.crm_tb_kunnr_kunag kg1 on kg1.kunnr = ss1.kunnr
               where kg1.kunag is not null and ss1.flag='kunnr_month' ]]>
               <dynamic>
		       <isNotEmpty property="productionDate" prepend="and">
			     <![CDATA[ ss1.check_time = #productionDate#]]>
		       </isNotEmpty>
		       </dynamic>
        <![CDATA[group by kg1.kunag
               ) s1 on p.kunnr = s1.kunnr 
               ) t
               left join crm.crm_tb_kunnr k on k.kunnr = t.kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       where 1=1
		    ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr#]]>
		</isNotEmpty>
		</dynamic>
		    <![CDATA[ order by ot.p_org_name,t.kunnr]]> 
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="searchStockCheckCount" parameterClass="stockReport"
		resultClass="java.lang.Integer">
	<![CDATA[select count(*)
		       from crm.crm_tb_kunnr k
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       left join
		       (select kg.kunnr as kunnr,
		               s.check_time as check_time,
		               sum(s.quantity) as quantity,
		               s.flag as flag
		               from crm.crm_tb_kunnr_stock s
		               left join crm.crm_tb_kunnr_kunag kg on s.kunnr = kg.kunnr
		               left join basis.basis_tb_salesemp_info e on s.user_id = e.emp_id 
		               where kg.kunag is null and s.flag in ('kunnr_month','kunnr_week') 
		                     and e.org_id not in (select b.org_id from basis.basis_tb_org b 
				                                   start with b.org_id = '51237'
				                                   connect by prior b.org_id= b.org_parent_id)
				             and s.status = 'U']]>
				      <dynamic>
		              <isNotEmpty property="productionStartDate" prepend="and">
			              <![CDATA[ s.check_time >= #productionStartDate#]]>
		              </isNotEmpty>
		              <isNotEmpty property="productionEndDate" prepend="and">
			              <![CDATA[ s.check_time <= #productionEndDate#]]>
		              </isNotEmpty>
		              </dynamic>
		<![CDATA[     group by kg.kunnr,s.check_time,s.flag ]]>
		        
		       union all
		       
		 <![CDATA[select kg.kunag as kunnr,
		              s.check_time as check_time,
		              sum(s.quantity) as quantity,
		              s.flag as flag
		              from crm.crm_tb_kunnr_stock s
		              left join crm.crm_tb_kunnr_kunag kg on s.kunnr = kg.kunnr
		              left join basis.basis_tb_salesemp_info e on s.user_id = e.emp_id 
		              where kg.kunag is not null and s.flag in ('kunnr_month','kunnr_week') 
		                     and e.org_id not in (select b.org_id from basis.basis_tb_org b 
				                                   start with b.org_id = '51237'
				                                   connect by prior b.org_id= b.org_parent_id)
				             and s.status = 'U']]>
				      <dynamic>
		              <isNotEmpty property="productionStartDate" prepend="and">
			              <![CDATA[ s.check_time >= #productionStartDate#]]>
		              </isNotEmpty>
		              <isNotEmpty property="productionEndDate" prepend="and">
			              <![CDATA[ s.check_time <= #productionEndDate#]]>
		              </isNotEmpty>
		              </dynamic>
		<![CDATA[     group by kg.kunag,s.check_time,s.flag 
		       ) s on k.kunnr = s.kunnr
		       left join (select kg.kunnr from crm.crm_tb_kunnr_kunag kg
		                         where kg.kunag is not null
		                               and kg.kunnr <> kg.kunag) kg on k.kunnr = kg.kunnr 
		       where kg.kunnr is null  ]]>
		<dynamic>
		<isNotEmpty property="orgId" prepend="and">
		<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr#]]>
		</isNotEmpty>
		<isEqual property="stockFlag" prepend="and" compareValue="1">
		   <![CDATA[ s.quantity is null]]>
		</isEqual>
		<isEqual property="stockFlag" prepend="and" compareValue="2">
		   <![CDATA[ s.quantity is not null]]>
		</isEqual>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="searchStockCheck" parameterClass="stockReport"
		resultClass="stockReport">
		<include refid="global.paginationStart" />
	<![CDATA[select k.kunnr as kunnr,
		       k.name1 as kunnrName,
		       ot.p_org_name as orgProvince,
		       ot.org_name as orgCity,
		       ot.rc_org_name as orgRegion,
		       s.check_time as checkTime,
		       s.quantity as quantity,
		       s.flag as flag,
		       k.status as kunnrStatus
		       from crm.crm_tb_kunnr k
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       left join
		       (select kg.kunnr as kunnr,
		               s.check_time as check_time,
		               sum(s.quantity) as quantity,
		               s.flag as flag
		               from crm.crm_tb_kunnr_stock s
		               left join crm.crm_tb_kunnr_kunag kg on s.kunnr = kg.kunnr
		               left join basis.basis_tb_salesemp_info e on s.user_id = e.emp_id 
		               where kg.kunag is null and s.flag in ('kunnr_month','kunnr_week') 
		                     and e.org_id not in (select b.org_id from basis.basis_tb_org b 
				                                   start with b.org_id = '51237'
				                                   connect by prior b.org_id= b.org_parent_id)
				             and s.status = 'U' ]]>
				      <dynamic>
		              <isNotEmpty property="productionStartDate" prepend="and">
			              <![CDATA[ s.check_time >= #productionStartDate#]]>
		              </isNotEmpty>
		              <isNotEmpty property="productionEndDate" prepend="and">
			              <![CDATA[ s.check_time <= #productionEndDate#]]>
		              </isNotEmpty>
		              </dynamic>
		<![CDATA[     group by kg.kunnr,s.check_time,s.flag ]]>
		           
		       union all
		       
		 <![CDATA[select kg.kunag as kunnr,
		              s.check_time as check_time,
		              sum(s.quantity) as quantity,
		              s.flag as flag
		              from crm.crm_tb_kunnr_stock s
		              left join crm.crm_tb_kunnr_kunag kg on s.kunnr = kg.kunnr
		              left join basis.basis_tb_salesemp_info e on s.user_id = e.emp_id 
		              where kg.kunag is not null and s.flag in ('kunnr_month','kunnr_week') 
		                     and e.org_id not in (select b.org_id from basis.basis_tb_org b 
				                                   start with b.org_id = '51237'
				                                   connect by prior b.org_id= b.org_parent_id)
				             and s.status = 'U' ]]>
				      <dynamic>
		              <isNotEmpty property="productionStartDate" prepend="and">
			              <![CDATA[ s.check_time >= #productionStartDate#]]>
		              </isNotEmpty>
		              <isNotEmpty property="productionEndDate" prepend="and">
			              <![CDATA[ s.check_time <= #productionEndDate#]]>
		              </isNotEmpty>
		              </dynamic>
		 <![CDATA[group by kg.kunag,s.check_time,s.flag
		       ) s on k.kunnr = s.kunnr
		       left join (select kg.kunnr from crm.crm_tb_kunnr_kunag kg
		                         where kg.kunag is not null
		                               and kg.kunnr <> kg.kunag) kg on k.kunnr = kg.kunnr 
		       where kg.kunnr is null  ]]>
		<dynamic>
		<isNotEmpty property="orgId" prepend="and">
		<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr#]]>
		</isNotEmpty>
		<isEqual property="stockFlag" prepend="and" compareValue="1">
		   <![CDATA[ s.quantity is null]]>
		</isEqual>
		<isEqual property="stockFlag" prepend="and" compareValue="2">
		   <![CDATA[ s.quantity is not null]]>
		</isEqual>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		</dynamic>
		<![CDATA[  order by ot.p_org_name,s.kunnr,s.check_time ]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="searchStockManagerCount" parameterClass="stockManager" resultClass="java.lang.Integer">
	   <![CDATA[
	   select count(*) from (
	      select k.kunnr as kunnr,
	             max(k.name1) as kunnrName,
	             max(ot.p_org_name) as orgProvince,
		         max(ot.org_name) as orgCity,
		         max(ot.rc_org_name) as orgRegion,
                 max(sku.sku_name) as skuName,
                 sku.sku_id as skuId,
                 t.matter_num as matterNum,
                 sum(t.quantity) as lastStock,
                 sum(t.on_way) as onWayNum,
                 sum(t.out_put_not) as outPutNotNum,
                 sum(t.out_put_not_check) as outPutNotCheck,
                 sum(t.box_num) as salesGoalA1
                 from crm.crm_tb_kunnr k 
                 left join 
                 (select s1.kunnr,
                         sku1.sku_sap_code as matter_num,
                         sum(s1.quantity) as quantity,
                         0 as on_way,
                         0 as out_put_not,
                         0 as out_put_not_check,
                         0 as box_num
                         from crm.crm_tb_kunnr_stock_total s1 
                         left join crm.crm_tb_sku sku1 on sku1.sku_id=s1.sku_id
                         where s1.check_time =#checkTime# and s1.flag in ('kunnr_week','kunnr_month') and s1.status='U'
                         group by s1.kunnr,s1.sku_id,s1.sku_category_id,s1.check_time,sku1.sku_sap_code
                             
                  union all
                             
                  select 
                        m1.kunnr,
                        m1.matter_num, 
                        0 as quantity,
                        m1.on_way,
                        m1.out_put_not,
                        m1.out_put_not_check,
                        0 as box_num
                        from crm.crm_tb_kunnr_stock_manager m1 
                        where m1.create_date=#dateNow#
                  
                  union all
                  
                  select 
                         p.kunnr,
                         s.sku_sap_code as matter_num,
                         0 as quantity,
                         0 as on_way,
                         0 as out_put_not,
                         0 as out_put_not_check,
                         p.box_num*t.sku_percent/100 as box_num
                         from crm.crm_tb_goal_production p
                         left join crm.crm_tb_cg c on c.sap_groups_code=p.matter_num
                         left join crm.crm_tb_sku s on s.sku_category_id = c.sku_category_id
                         left join crm.crm_tb_sku_percent t on s.sku_id=t.sku_id
                         where p.goal_type='A1' and p.status='U' and p.goal_month=#month# and p.goal_year=#year#
                  ) t  on t.kunnr=k.kunnr 
                  left join crm.crm_tb_sku sku on sku.sku_sap_code = t.matter_num
                  left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
                  where (t.quantity <>0  or t.on_way <>0  or t.out_put_not<>0 
                        or t.out_put_not_check<>0  or t.box_num<>0)
                        and k.status<>'2'
        ]]>
		    <dynamic>
            <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
		    <![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
			</dynamic>
			<![CDATA[ group by k.kunnr,t.matter_num,sku.sku_id 
			          order by k.kunnr )]]>
	</select>
	
	<select id="searchStockManager" parameterClass="stockManager" resultClass="stockManager">
	<include refid="global.paginationStart" />
	   <![CDATA[
	      select k.kunnr as kunnr,
	             max(k.name1) as kunnrName,
	             max(ot.p_org_name) as orgProvince,
		         max(ot.org_name) as orgCity,
		         max(ot.rc_org_name) as orgRegion,
                 max(sku.sku_name) as skuName,
                 sku.sku_id as skuId,
                 t.matter_num as matterNum,
                 sum(t.quantity) as lastStock,
                 sum(t.on_way) as onWayNum,
                 sum(t.out_put_not) as outPutNotNum,
                 sum(t.out_put_not_check) as outPutNotCheck,
                 sum(t.box_num) as salesGoalA1
                 from crm.crm_tb_kunnr k 
                 left join 
                 (select s1.kunnr,
                         sku1.sku_sap_code as matter_num,
                         sum(s1.quantity) as quantity,
                         0 as on_way,
                         0 as out_put_not,
                         0 as out_put_not_check,
                         0 as box_num
                         from crm.crm_tb_kunnr_stock_total s1 
                         left join crm.crm_tb_sku sku1 on sku1.sku_id=s1.sku_id
                         where s1.check_time =#checkTime# and s1.flag in ('kunnr_week','kunnr_month') and s1.status='U'
                         group by s1.kunnr,s1.sku_id,s1.sku_category_id,s1.check_time,sku1.sku_sap_code
                             
                  union all
                             
                  select 
                        m1.kunnr,
                        m1.matter_num, 
                        0 as quantity,
                        m1.on_way,
                        m1.out_put_not,
                        m1.out_put_not_check,
                        0 as box_num
                        from crm.crm_tb_kunnr_stock_manager m1 
                        where m1.create_date=#dateNow#
                  
                  union all
                  
                  select 
                         p.kunnr,
                         s.sku_sap_code as matter_num,
                         0 as quantity,
                         0 as on_way,
                         0 as out_put_not,
                         0 as out_put_not_check,
                         p.box_num*t.sku_percent/100 as box_num
                         from crm.crm_tb_goal_production p
                         left join crm.crm_tb_cg c on c.sap_groups_code=p.matter_num
                         left join crm.crm_tb_sku s on s.sku_category_id = c.sku_category_id
                         left join crm.crm_tb_sku_percent t on s.sku_id=t.sku_id
                         where p.goal_type='A1' and p.status='U' and p.goal_month=#month# and p.goal_year=#year#
                  ) t  on t.kunnr=k.kunnr 
                  left join crm.crm_tb_sku sku on sku.sku_sap_code = t.matter_num
                  left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
                  where (t.quantity <>0  or t.on_way <>0  or t.out_put_not<>0 
                        or t.out_put_not_check<>0  or t.box_num<>0)
                        and k.status<>'2'
        ]]>
		    <dynamic>
            <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
		    <![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
			</dynamic>
			<![CDATA[ group by k.kunnr,t.matter_num,sku.sku_id
			          order by k.kunnr]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="searchStockManagerReportCount" parameterClass="stockManager" resultClass="java.lang.Integer">
	   <![CDATA[
	   select count(*) from (
	      select k.kunnr as kunnr,
	             max(k.name1) as kunnrName,
	             max(ot.p_org_name) as orgProvince,
		         max(ot.org_name) as orgCity,
		         max(ot.rc_org_name) as orgRegion,
                 sum(t.quantity) as lastStock,
                 sum(t.on_way) as onWayNum,
                 sum(t.out_put_not) as outPutNotNum,
                 sum(t.out_put_not_check) as outPutNotCheck,
                 sum(t.box_num) as salesGoalA1
                 from crm.crm_tb_kunnr k 
                 left join 
                 (select nvl(kg1.kunag,s1.kunnr) as kunnr,
                         sum(s1.quantity) as quantity,
                         0 as on_way,
                         0 as out_put_not,
                         0 as out_put_not_check,
                         0 as box_num
                         from crm.crm_tb_kunnr_stock_total s1
                         left join crm.crm_tb_kunnr_kunag kg1 on s1.kunnr = kg1.kunnr 
                         where s1.check_time =#checkTime# and s1.flag in ('kunnr_week','kunnr_month') and s1.status='U'
                         group by nvl(kg1.kunag,s1.kunnr),s1.check_time
                             
                  union all
                             
                  select 
                        nvl(kg2.kunag,m1.kunnr) as kunnr,
                        0 as quantity,
                        sum(m1.on_way),
                        sum(m1.out_put_not),
                        sum(m1.out_put_not_check),
                        0 as box_num
                        from crm.crm_tb_kunnr_stock_manager m1
                        left join crm.crm_tb_kunnr_kunag kg2 on m1.kunnr = kg2.kunnr  
                        where m1.create_date=#dateNow#
                        group by nvl(kg2.kunag,m1.kunnr)
                  
                  union all
                  
                  select 
                         nvl(kg3.kunag,p.kunnr) as kunnr,
                         0 as quantity,
                         0 as on_way,
                         0 as out_put_not,
                         0 as out_put_not_check,
                         sum(p.box_num) as box_num
                         from crm.crm_tb_goal_production p
                         left join crm.crm_tb_kunnr_kunag kg3 on p.kunnr = kg3.kunnr
                         where p.goal_type='A1' and p.status='U' and p.goal_month=#month# and p.goal_year=#year#
                         group by nvl(kg3.kunag,p.kunnr)
                  ) t  on t.kunnr=k.kunnr 
                  left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
                  where (t.quantity <>0  or t.on_way <>0  or t.out_put_not<>0 
                        or t.out_put_not_check<>0  or t.box_num<>0)
                        and k.status<>'2'
        ]]>
		    <dynamic>
            <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
		    <![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
			</dynamic>
			<![CDATA[ group by k.kunnr
			          order by k.kunnr)]]>
	</select>
	
	<select id="searchStockManagerReport" parameterClass="stockManager" resultClass="stockManager">
	<include refid="global.paginationStart" />
	   <![CDATA[
	      select k.kunnr as kunnr,
	             max(k.name1) as kunnrName,
	             max(ot.p_org_name) as orgProvince,
		         max(ot.org_name) as orgCity,
		         max(ot.rc_org_name) as orgRegion,
                 sum(t.quantity) as lastStock,
                 sum(t.on_way) as onWayNum,
                 sum(t.out_put_not) as outPutNotNum,
                 sum(t.out_put_not_check) as outPutNotCheck,
                 sum(t.box_num) as salesGoalA1
                 from crm.crm_tb_kunnr k 
                 left join 
                 (select nvl(kg1.kunag,s1.kunnr) as kunnr,
                         sum(s1.quantity) as quantity,
                         0 as on_way,
                         0 as out_put_not,
                         0 as out_put_not_check,
                         0 as box_num
                         from crm.crm_tb_kunnr_stock_total s1
                         left join crm.crm_tb_kunnr_kunag kg1 on s1.kunnr = kg1.kunnr 
                         where s1.check_time =#checkTime# and s1.flag in ('kunnr_week','kunnr_month') and s1.status='U'
                         group by nvl(kg1.kunag,s1.kunnr),s1.check_time
                             
                  union all
                             
                  select 
                        nvl(kg2.kunag,m1.kunnr) as kunnr,
                        0 as quantity,
                        sum(m1.on_way),
                        sum(m1.out_put_not),
                        sum(m1.out_put_not_check),
                        0 as box_num
                        from crm.crm_tb_kunnr_stock_manager m1
                        left join crm.crm_tb_kunnr_kunag kg2 on m1.kunnr = kg2.kunnr  
                        where m1.create_date=#dateNow#
                        group by nvl(kg2.kunag,m1.kunnr)
                  
                  union all
                  
                  select 
                         nvl(kg3.kunag,p.kunnr) as kunnr,
                         0 as quantity,
                         0 as on_way,
                         0 as out_put_not,
                         0 as out_put_not_check,
                         sum(p.box_num) as box_num
                         from crm.crm_tb_goal_production p
                         left join crm.crm_tb_kunnr_kunag kg3 on p.kunnr = kg3.kunnr
                         where p.goal_type='A1' and p.status='U' and p.goal_month=#month# and p.goal_year=#year#
                         group by nvl(kg3.kunag,p.kunnr)
                  ) t  on t.kunnr=k.kunnr 
                  left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
                  where (t.quantity <>0  or t.on_way <>0  or t.out_put_not<>0 
                        or t.out_put_not_check<>0  or t.box_num<>0)
                        and k.status<>'2'
        ]]>
		    <dynamic>
            <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
		    <![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
			</dynamic>
			<![CDATA[ group by k.kunnr
			          order by k.kunnr]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="searchGoalCGByMatterNum" parameterClass="stockManager" resultClass="java.lang.Double">
	   <![CDATA[
	      select distinct p.box_num*t.sku_percent/100
                 from crm.crm_tb_goal_production p
                 left join crm.crm_tb_cg c on c.sap_groups_code=p.matter_num
                 left join crm.crm_tb_sku s on s.sku_category_id = c.sku_category_id
                 left join crm.crm_tb_sku_percent t on s.sku_id=t.sku_id
                 where p.goal_type='A1' and p.status='U'
       ]]>
		    <dynamic>
            <isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ s.sku_sap_code = #matterNum# ]]>
			</isNotEmpty>
            <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ p.kunnr = #kunnr# ]]>
			</isNotEmpty>
            <isNotEmpty property="year" prepend="and">
			<![CDATA[ p.goal_year = #year# ]]>
			</isNotEmpty>
            <isNotEmpty property="month" prepend="and">
			<![CDATA[ p.goal_month = #month# ]]>
			</isNotEmpty>
			</dynamic>
	</select>
	
	<select id="searchGoalCGByKunnr" parameterClass="stockManager" resultClass="java.lang.Double">
	   <![CDATA[
	      select sum(p.box_num)
                 from crm.crm_tb_goal_production p
                 where p.goal_type='A1' and p.status='U'
       ]]>
		    <dynamic>
            <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ p.kunnr = #kunnr# ]]>
			</isNotEmpty>
            <isNotEmpty property="year" prepend="and">
			<![CDATA[ p.goal_year = #year# ]]>
			</isNotEmpty>
            <isNotEmpty property="month" prepend="and">
			<![CDATA[ p.goal_month = #month# ]]>
			</isNotEmpty>
			</dynamic>
	</select>
	
	<select id="getGoalCGOrgBoxNumD" parameterClass="salesGoal" resultClass="java.lang.Double">
	  select a.box_num1-b.box_num2 
	  from 
       (select nvl(sum(t.box_num),0) as box_num1 from crm.crm_tb_goal_production t 
        where t.goal_type='A1' and t.goal_mark='N' and t.status='U'
        <dynamic>
            <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ t.org_id = #orgId# ]]>
			</isNotEmpty>
            <isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ t.goal_year = #goalYear# ]]>
			</isNotEmpty>
            <isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ t.goal_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ t.matter_num = #matterNum# ]]>
			</isNotEmpty>
		</dynamic>
        ) a
        ,
       (select nvl(sum(t.box_num),0) as box_num2 from crm.crm_tb_goal_production t 
       where t.goal_type='A1' and t.goal_mark='Y' and t.status='U'
       <dynamic>
            <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ t.org_id = #orgId# ]]>
			</isNotEmpty>
            <isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ t.goal_year = #goalYear# ]]>
			</isNotEmpty>
            <isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ t.goal_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ t.matter_num = #matterNum# ]]>
			</isNotEmpty>
		</dynamic>
		) b
	
	</select>
	
	<update id="updateGoalCGDetailBoxNumDToKunnr" parameterClass="java.util.Map">
	   <![CDATA[
	      update crm.crm_tb_goal_production p set p.kunnr=#kunnr#
                 where p.kunnr=#kunnrD#
       ]]>
	</update>
	
	<delete id="deleteGoalCGDetail" parameterClass="salesGoal">
	   <![CDATA[
	      update crm.crm_tb_goal_production t 
	      	set t.status='D',
	      		t.create_date=sysdate
           where t.goal_type='A1'
       ]]>
           <dynamic>
           <isNotEmpty property="kunnr" prepend="and">
             <![CDATA[ t.kunnr = #kunnr# ]]>
           </isNotEmpty>
           <isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ t.goal_year = #goalYear# ]]>
			</isNotEmpty>
            <isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ t.goal_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ t.matter_num = #matterNum# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ t.org_id = #orgId# ]]>
			</isNotEmpty>
            <isNotEmpty property="goalMark" prepend="and">
			<![CDATA[ t.goal_mark = #goalMark# ]]>
			</isNotEmpty>
            <isNotEmpty property="userId" prepend="and">
			<![CDATA[ t.user_id = #userId# ]]>
			</isNotEmpty>
           </dynamic>
	</delete>
	
	<update id="updateOperationUser" parameterClass="salesGoal">
	   <![CDATA[
	      update crm.crm_tb_goal_production t 
	      	set t.user_id = #userId#
           where t.goal_type='A1' and t.status='D' 
       ]]>
           <dynamic>
           <isNotEmpty property="kunnr" prepend="and">
             <![CDATA[ t.kunnr = #kunnr# ]]>
           </isNotEmpty>
           <isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ t.goal_year = #goalYear# ]]>
			</isNotEmpty>
            <isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ t.goal_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ t.matter_num = #matterNum# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ t.org_id = #orgId# ]]>
			</isNotEmpty>
            <isNotEmpty property="goalMark" prepend="and">
			<![CDATA[ t.goal_mark = #goalMark# ]]>
			</isNotEmpty>
           </dynamic>
	</update>
	
	<update id="updateGoalCGDetail" parameterClass="salesGoal">
	   <![CDATA[
	      update crm.crm_tb_goal_production p set p.box_num=#boxNum#
                 where p.goal_type='A1'
                 and p.org_id = #orgId#
                 and p.goal_year = #goalYear#
                 and p.goal_month = #goalMonth#
                 and p.goal_mark = #goalMark#
                 and p.matter_num = #matterNum#
       ]]>
           <dynamic>
           <isEmpty property="kunnr" prepend="and">
             <![CDATA[ p.kunnr is null ]]>
           </isEmpty>
           <isNotEmpty property="kunnr" prepend="and">
             <![CDATA[ p.kunnr = #kunnr# ]]>
           </isNotEmpty>
           </dynamic>
	</update>
	
	<select id="searchOrderCheckListCount" parameterClass="orderCheck" resultClass="java.lang.Integer">
	    <![CDATA[
	        select
	          count(*)
	          from crm.crm_tb_kunnr k
	          left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
	          left join (select max(l.create_date) as create_date,
	                            l.check_year,
	                            l.check_month,
	                            l.kunnr 
	                            from basis.basis_tb_orderreport_log l
	                            where 1=1
	    ]]>
	       <dynamic>
           <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when l.check_month>=10 
			                then to_char(to_date(l.check_year||l.check_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(l.check_year||0||l.check_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when l.check_month>=10 
			                then to_char(to_date(l.check_year||l.check_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(l.check_year||0||l.check_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="checkMonth" prepend="and">
             <![CDATA[ l.check_month = #checkMonth# ]]>
           </isNotEmpty>
           <isNotEmpty property="checkYear" prepend="and">
             <![CDATA[ l.check_year = #checkYear# ]]>
           </isNotEmpty>
           </dynamic>
	    <![CDATA[
	                            group by l.check_year,l.check_month,l.kunnr
	                            ) l on l.kunnr=k.kunnr
	          left join crm.crm_tb_order_check t on l.kunnr=t.kunnr and l.check_year=t.check_year and l.check_month=t.check_month
	          where k.status<>'2'
	    ]]>
	       <dynamic>
           <isNotEmpty property="kunnr" prepend="and">
             <![CDATA[ k.kunnr = #kunnr# ]]>
           </isNotEmpty>
           <isNotEmpty property="state" prepend="and">
             <![CDATA[ t.state = #state# ]]>
           </isNotEmpty>
           <isNotEmpty property="checkUser" prepend="and">
             <![CDATA[ t.check_user = #checkUser# ]]>
           </isNotEmpty>
           <isEqual property="lastCheckDate" compareValue="Y" prepend="and">
             <![CDATA[ l.create_date is not null ]]>
           </isEqual>
           <isEqual property="lastCheckDate" compareValue="N" prepend="and">
             <![CDATA[ l.create_date is null ]]>
           </isEqual>
           <isNotEmpty property="orgIds" prepend="and">
		    <![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id in ($orgIds$)
				         connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
           </dynamic>
	</select>
	
	<select id="searchOrderCheckList" parameterClass="orderCheck" resultClass="orderCheck">
	    <include refid="global.paginationStart" />
	    <![CDATA[
	        select
	          t.check_id as checkId,
	          k.kunnr as kunnr,
	          k.name1 as kunnrName,
	          ot.p_org_name as orgProvince,
		      ot.org_name as orgCity,
		      ot.rc_org_name as orgRegion,
	          k.status as kunnrStatus,
	          t.state as state,
	          t.description as checkDesc,
	          t.create_date as createDate,
	          t.check_user as checkUser,
	          t.ip ip,
	          l.check_year as checkYear,
	          l.check_month as checkMonth,
	          l.create_date as lastCheckDate
	          from crm.crm_tb_kunnr k
	          left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
	          left join (select max(l.create_date) as create_date,
	                            l.check_year,
	                            l.check_month,
	                            l.kunnr 
	                            from basis.basis_tb_orderreport_log l
	                            where 1=1
	    ]]>
	       <dynamic>
           <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when l.check_month>=10 
			                then to_char(to_date(l.check_year||l.check_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(l.check_year||0||l.check_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when l.check_month>=10 
			                then to_char(to_date(l.check_year||l.check_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(l.check_year||0||l.check_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="checkMonth" prepend="and">
             <![CDATA[ l.check_month = #checkMonth# ]]>
           </isNotEmpty>
           <isNotEmpty property="checkYear" prepend="and">
             <![CDATA[ l.check_year = #checkYear# ]]>
           </isNotEmpty>
           </dynamic>
	    <![CDATA[                        
	                            group by l.check_year,l.check_month,l.kunnr
	                            ) l on l.kunnr=k.kunnr
	          left join crm.crm_tb_order_check t on l.kunnr=t.kunnr and l.check_year=t.check_year and l.check_month=t.check_month
	          where k.status<>'2'
	    ]]>
	       <dynamic>
           <isNotEmpty property="kunnr" prepend="and">
             <![CDATA[ k.kunnr = #kunnr# ]]>
           </isNotEmpty>
           <isNotEmpty property="state" prepend="and">
             <![CDATA[ t.state = #state# ]]>
           </isNotEmpty>
           <isNotEmpty property="checkUser" prepend="and">
             <![CDATA[ t.check_user = #checkUser# ]]>
           </isNotEmpty>
           <isEqual property="lastCheckDate" compareValue="Y" prepend="and">
             <![CDATA[ l.create_date is not null ]]>
           </isEqual>
           <isEqual property="lastCheckDate" compareValue="N" prepend="and">
             <![CDATA[ l.create_date is null ]]>
           </isEqual>
           <isNotEmpty property="orgIds" prepend="and">
		    <![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id in ( $orgIds$)
				         connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
           </dynamic>
           <![CDATA[ order by t.state,l.create_date desc,k.kunnr  ]]>
           <include refid="global.paginationEnd" />
	</select>
	
	<insert id="createOrderCheck" parameterClass="orderCheck">
	    <selectKey resultClass="java.lang.Integer" keyProperty="checkId">
		<![CDATA[
			select crm.crm_seq_order_check.nextval as checkId from dual
		]]>
		</selectKey>
	    <![CDATA[
	        insert into crm.crm_tb_order_check
	        (check_id,
	         kunnr,
	         state,
	         description,
	         check_month,
	         check_year,
	         create_date,
	         check_user,
	         ip,
	         other_ip)
	         values
	         (#checkId#,
	          #kunnr#,
	          #state#,
	          #checkDesc#,
	          #checkMonth#,
	          #checkYear#,
	          sysdate,
	          #checkUser#,
	          #ip#,
	          #otherIp#)
	    ]]>
	</insert>
	
	<update id="updateOrderCheck" parameterClass="orderCheck">
	    <![CDATA[
	      update crm.crm_tb_order_check t 
	    ]]>
	    <dynamic prepend="set">
           <isNotEmpty property="checkUser" prepend=",">
             <![CDATA[ t.check_user = #checkUser# ]]>
           </isNotEmpty>
           <isNotEmpty property="checkDesc" prepend=",">
             <![CDATA[ t.description = #checkDesc# ]]>
           </isNotEmpty>
           <isNotEmpty property="state" prepend=",">
             <![CDATA[ t.state = #state# ]]>
           </isNotEmpty>
           <isNotEmpty property="createDate" prepend=",">
             <![CDATA[ t.create_date = #createDate# ]]>
           </isNotEmpty>
            <isNotEmpty property="ip" prepend=",">
             <![CDATA[ t.ip = #ip# ]]>
           </isNotEmpty>
            <isNotEmpty property="otherIp" prepend=",">
             <![CDATA[ t.other_ip = #otherIp# ]]>
           </isNotEmpty>
        </dynamic>
        <![CDATA[
            where t.check_id=#checkId#
        ]]>
	</update>
	
	<select id="getStationIdByUserId" parameterClass="java.lang.String" resultClass="orderCheck">
	    <![CDATA[
	        select 
	        s.station_id as stationId,
	        s.org_id as orgId
	        from basis.basis_tb_station_user s
	        where s.user_id=#userId#
	    ]]>
	</select>
	
	<select id="getRoleIdByUserId" parameterClass="java.lang.String" resultClass="java.lang.String">
	    <![CDATA[
	        select 
	        r.role_id
	        from basis.basis_tb_station_user s
	        left join basis.basis_tb_station_role r on r.station_id = s.station_id
	        where s.user_id=#userId#
	    ]]>
	</select>
	
	<select id="getStockTotalListCount" parameterClass="stockReport"
		resultClass="java.lang.Integer">
		<![CDATA[
		select count(*)
		       from crm.crm_vw_kunnr_stock s
		       left join crm.crm_tb_cg cg on cg.sku_category_id = s.sku_category_id
		       left join crm.crm_tb_kunnr k on k.kunnr = s.kunnr
		       left join basis.basis_vw_user_psw u on u.user_id = s.user_id
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       where s.status ='U'
		       ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ s.sku_category_id = #categoryId#]]>
		</isNotEmpty>
	    <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ s.create_date >= to_date(#startDate#,'yyyy-mm-dd')]]>
		</isNotEmpty>
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date <=to_date(#endDate#,'yyyy-mm-dd')+1]]>
		</isNotEmpty>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userName" prepend="and">
			<![CDATA[ u.user_name like #userName,handler=wildcard# escape '\']]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		<isNotEmpty property="kunnrs" prepend="and">
			<![CDATA[ s.kunnr in ]]>
			<iterate property="kunnrs" open="(" close=")" conjunction=",">#kunnrs[]#
		    </iterate>
		</isNotEmpty>
		<isNotEmpty property="checkTime" prepend="and">
			<![CDATA[ s.check_time = #checkTime#]]>
		</isNotEmpty>
		<isNotEmpty property="productionDate" prepend="and">
			<![CDATA[ s.production_date = #productionDate#]]>
		</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="getStockTotalList" parameterClass="stockReport"
		resultClass="stockReport">
		<include refid="global.paginationStart" />
		<![CDATA[
		select s.id as stockId,
		       s.kunnr as kunnr,
		       k.name1 as kunnrName,
		       s.sku_id as skuId,
		       sku.sku_name as skuName,
		       s.user_id as userId,
		       u.user_name as userName,
		       s.create_date as createDate,
		       s.production_date as productionDate,
		       s.check_time as checkTime,
		       s.sku_category_id as categoryId,
		       cg.category_name as categoryName,
		       s.quantity as quantity,
		       s.unitdesc as unitDesc,
		       s.flag as flag,
		       ot.p_org_name as orgProvince,
		       ot.org_name as orgCity,
		       ot.rc_org_name as orgRegion
		       from crm.crm_vw_kunnr_stock s
		       left join crm.crm_tb_cg cg on cg.sku_category_id = s.sku_category_id
		       left join crm.crm_tb_sku sku on sku.sku_id = s.sku_id
		       left join basis.basis_vw_user_psw u on u.user_id = s.user_id
		       left join crm.crm_tb_kunnr k on k.kunnr = s.kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
		       where s.status ='U'
		       ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ s.sku_category_id = #categoryId#]]>
		</isNotEmpty>
	    <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ s.create_date >= to_date(#startDate#,'yyyy-mm-dd')]]>
		</isNotEmpty>
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date <=to_date(#endDate#,'yyyy-mm-dd')+1]]>
		</isNotEmpty>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userName" prepend="and">
			<![CDATA[ u.user_name like #userName,handler=wildcard# escape '\']]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		<isNotEmpty property="kunnrs" prepend="and">
			<![CDATA[ s.kunnr in ]]>
			<iterate property="kunnrs" open="(" close=")" conjunction=",">#kunnrs[]#
		    </iterate>
		</isNotEmpty>
	    </dynamic>
			<![CDATA[order by s.create_date desc,s.kunnr,s.id]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="searchSalesGoalChallengeListCount" parameterClass="salesGoal" resultClass="java.lang.Integer">
	    <![CDATA[
	        select count(*)
			  from crm.crm_tb_change p
			  left join crm.crm_tb_kunnr k on k.kunnr = p.cust_id
			  left join basis.basis_tb_org o on o.org_id = p.org_id
			  left join crm.crm_tb_cg c on c.sap_groups_code=p.matter
			  left join basis.basis_tb_salesemp_info e on e.emp_id=p.user_id
			  where 1=1
		]]>
		<dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ p.cust_id = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ p.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
			</isNotEmpty>
			<isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ p.the_year = #goalYear# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ p.the_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ p.matter = #matterNum# ]]>
			</isNotEmpty>
			<isEqual property="flag" compareValue="Y" prepend="and">
			<![CDATA[ k.name1 is null ]]>
			</isEqual>
			<isEqual property="flag" compareValue="N" prepend="and">
			<![CDATA[ k.name1 is not null ]]>
			</isEqual>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ p.the_year||'-'||p.the_month >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ p.the_year||'-'||p.the_month <= #endDate# ]]>
			</isNotEmpty>
		 </dynamic>
	</select>
	
	<select id="searchSalesGoalChallengeList" parameterClass="salesGoal" resultClass="salesGoal">
	    <include refid="global.paginationStart" />
	    <![CDATA[
	        select p.cust_id as kunnr,
	               p.the_year as goalYear,
	               p.the_month as goalMonth,
	               o.org_name as orgName,
	               k.name1 as kunnrName,
	               p.matter as matterNum,
			       p.create_date as createDate,
			       p.user_id as userId,
			       e.emp_name as userName,
			       p.change_num as boxNum,
			       p.org_id as orgId,
			       c.category_name as matterName
			  from crm.crm_tb_change p
			  left join crm.crm_tb_kunnr k on k.kunnr = p.cust_id
			  left join basis.basis_tb_org o on o.org_id = p.org_id
			  left join crm.crm_tb_cg c on c.sap_groups_code=p.matter
			  left join basis.basis_tb_salesemp_info e on e.emp_id=p.user_id
			  where 1=1
		]]>
		<dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ p.cust_id = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ p.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
			</isNotEmpty>
			<isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ p.the_year = #goalYear# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ p.the_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ p.matter = #matterNum# ]]>
			</isNotEmpty>
			<isEqual property="flag" compareValue="Y" prepend="and">
			<![CDATA[ k.name1 is null ]]>
			</isEqual>
			<isEqual property="flag" compareValue="N" prepend="and">
			<![CDATA[ k.name1 is not null ]]>
			</isEqual>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ p.the_year||'-'||p.the_month >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ p.the_year||'-'||p.the_month <= #endDate# ]]>
			</isNotEmpty>
		 </dynamic>
		 <![CDATA[order by p.org_id,p.cust_id,p.the_year,p.the_month,p.matter  ]]>
		 <include refid="global.paginationEnd" />
	</select>
	
	<select id="searchSalesGoalChallengeListSum" parameterClass="salesGoal" resultClass="java.lang.String">
	    <![CDATA[
	        select to_char(sum(p.change_num))
			  from crm.crm_tb_change p
			  left join crm.crm_tb_kunnr k on k.kunnr = p.cust_id
			  left join basis.basis_tb_org o on o.org_id = p.org_id
			  left join crm.crm_tb_cg c on c.sap_groups_code=p.matter
			  left join basis.basis_tb_salesemp_info e on e.emp_id=p.user_id
			  where 1=1
		]]>
		<dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ p.cust_id = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ p.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
			</isNotEmpty>
			<isNotEmpty property="goalYear" prepend="and">
			<![CDATA[ p.the_year = #goalYear# ]]>
			</isNotEmpty>
			<isNotEmpty property="goalMonth" prepend="and">
			<![CDATA[ p.the_month = #goalMonth# ]]>
			</isNotEmpty>
			<isNotEmpty property="matterNum" prepend="and">
			<![CDATA[ p.matter = #matterNum# ]]>
			</isNotEmpty>
			<isEqual property="flag" compareValue="Y" prepend="and">
			<![CDATA[ k.name1 is null ]]>
			</isEqual>
			<isEqual property="flag" compareValue="N" prepend="and">
			<![CDATA[ k.name1 is not null ]]>
			</isEqual>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ p.the_year||'-'||p.the_month >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ p.the_year||'-'||p.the_month <= #endDate# ]]>
			</isNotEmpty>
		 </dynamic>
	</select>
	
	<update id="updateGoalChallenge" parameterClass="salesGoal">
	   <![CDATA[
	      update crm.crm_tb_change p set p.change_num=#boxNum#
                 where p.org_id = #orgId#
                 and p.the_year = #goalYear#
                 and p.the_month = #goalMonth#
                 and p.matter = #matterNum#
                 and p.cust_id = #kunnr#
       ]]>
	</update>
	
	<insert id="createSalesGoalChallenge" parameterClass="salesGoal">
	    <![CDATA[
	      insert into crm.crm_tb_change(
	             cust_id,
                 the_year,
                 the_month,
                 user_id,
                 create_date,
                 matter,
                 change_num,
                 org_id
                 )
                 values(
                 #kunnr#,
                 #goalYear#,
                 #goalMonth#,
                 #userId#,
                 sysdate,
                 #matterNum#,
                 #boxNum#,
                 #orgId#
                 )
	    ]]> 
	</insert>
	
	<select id="searchKunnrManagerDate" parameterClass="stockDate" resultClass="stockDate">
	    <![CDATA[ select t.id as id,
	                     t.check_time as checkTime,
	                     t.start_date as startDateStr,
	                     t.end_date as endDateStr,
	                     t.modify_date as modifyDate
	                     from crm.crm_tb_kunnr_manager_date t
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="id" prepend="and">
			<![CDATA[ t.id = #id# ]]>
			</isNotEmpty>
			<isNotEmpty property="modifyDate" prepend="and">
			<![CDATA[ t.start_date <= #modifyDate# and t.end_date>=#modifyDate#]]>
			</isNotEmpty>
		</dynamic> 
	</select>
	
	<select id="searchKunnrManagerDateCount" parameterClass="stockDate" resultClass="java.lang.Integer">
	    <![CDATA[ select count(*)
	                     from crm.crm_tb_kunnr_manager_date t
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="id" prepend="and">
			<![CDATA[ t.id = #id# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ to_date(t.check_time,'yyyy-MM-dd')+1 >= #startDate# ]]>
			</isNotEmpty>
		</dynamic> 
	</select>
	
	<update id="updateKunnrManagerDate" parameterClass="stockDate">
	    <![CDATA[ update crm.crm_tb_kunnr_manager_date t set t.modify_date = sysdate]]>
	    <dynamic>
			<isNotEmpty property="checkTime" prepend=",">
			<![CDATA[ t.check_time = #checkTime# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend=",">
			<![CDATA[ t.start_date = #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend=",">
			<![CDATA[ t.end_date = #endDate#]]>
			</isNotEmpty>
		</dynamic>
			<![CDATA[ where t.id=#id# ]]>
	</update>
	
	<select id="getStockSafetyByKunnr" parameterClass="kunnrManager" resultClass="kunnrManager">
	<![CDATA[select round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s.quantity,1) as stockSafety,
	                round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s1.quantity,1) as stockSafetyLimit
	                from crm.crm_tb_kunnr k
		            left join basis.basis_tb_org_temp ot on ot.org_id=k.org_id
	                left join crm.crm_tb_kunnr_stock_safety s on s.org_id=ot.rc_org_id
	                left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s1 on s1.org_id=s.org_id and s1.safety_year=s.safety_year and s1.safety_month=s.safety_month
	                left join (select g.kunnr,g.goal_year,g.goal_month,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U' and cg.sku_category_id=#cgId#
		                                   group by g.kunnr,g.goal_year,g.goal_month
		                                   ) g1 on g1.kunnr=k.kunnr
		                                        and g1.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g1.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		            where s.status='U' and s.is_limit='N'
	]]>
	    <dynamic>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="getKunnrManager" parameterClass="kunnrManager" resultClass="kunnrManager">
	<![CDATA[select ]]>
	<dynamic>
			<isNotEmpty property="monthQuery">
			<![CDATA[ m.sales_plan_next as salesPlanNext,
	                  m.sales_plan as salesPlan ]]>
			</isNotEmpty>
			<isNotEmpty property="month">
			<![CDATA[ sum(m.sales_plan_next) as salesPlanNext,
			          sum(m.sales_plan) as salesPlan ]]>
			</isNotEmpty>
	</dynamic>
	<![CDATA[       from crm.crm_tb_kunnr_manager m 
		            where m.status='U'
	]]>
	    <dynamic>
			<isNotEmpty property="yearQuery" prepend="and">
			<![CDATA[ m.manager_year = #yearQuery# ]]>
			</isNotEmpty>
			<isNotEmpty property="monthQuery" prepend="and">
			<![CDATA[ m.manager_month = #monthQuery# ]]>
			</isNotEmpty>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ m.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ m.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ m.manager_year < #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ m.manager_month < #month# ]]>
			</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="getHanaDistributionSku" parameterClass="kunnrManager" resultClass="java.lang.Double">
	<![CDATA[select ]]>
	<dynamic>
			<isNotEmpty property="monthQuery">
			<![CDATA[ s.actual ]]>
			</isNotEmpty>
			<isNotEmpty property="month">
			<![CDATA[ sum(s.actual) as actual]]>
			</isNotEmpty>
	</dynamic>
	<![CDATA[        from hana_distribution_sku s
		             where 1=1
	]]>
	    <dynamic>
			<isNotEmpty property="yearQuery" prepend="and">
			<![CDATA[ s.year = #yearQuery# ]]>
			</isNotEmpty>
			<isNotEmpty property="monthQuery" prepend="and">
			<![CDATA[ s.month = #monthQuery# ]]>
			</isNotEmpty>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ substr(lpad(s.kunnr,10,'0'),3,8) = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.year < #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.month < #month# ]]>
			</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="getStockSafetySum" parameterClass="kunnrManager" resultClass="java.lang.Double">
	<![CDATA[select sum(quantity * u.sku_unit_coefficient) 
	                from crm.crm_tb_kunnr_stock_safety s
	                left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
		            left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=s.sku_id
			        left join crm.crm_tb_cg cg on cg.sku_category_id=sku.sku_category_id 
		            where s.is_limit='N' and s.status='U'
	]]>
	    <dynamic>
			<isNotEmpty property="yearQuery" prepend="and">
			<![CDATA[ s.safety_year = #yearQuery# ]]>
			</isNotEmpty>
			<isNotEmpty property="monthQuery" prepend="and">
			<![CDATA[ s.safety_month = #monthQuery# ]]>
			</isNotEmpty>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ s.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ cg.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year < #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month < #month# ]]>
			</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="getKunnrManagerSum" parameterClass="kunnrManager" resultClass="kunnrManager">
	<![CDATA[select 
	                sum(m.sales_plan_next) as salesPlanNext,
			        sum(m.sales_plan) as salesPlan
			        from crm.crm_tb_kunnr_manager m
		            where m.status='U'
	]]>
	    <dynamic>
			<isNotEmpty property="yearQuery" prepend="and">
			<![CDATA[ m.manager_year = #yearQuery# ]]>
			</isNotEmpty>
			<isNotEmpty property="monthQuery" prepend="and">
			<![CDATA[ m.manager_month = #monthQuery# ]]>
			</isNotEmpty>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ m.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ m.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ m.manager_year <= #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ m.manager_month <= #month# ]]>
			</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="getHanaDistributionSkuSum" parameterClass="kunnrManager" resultClass="java.lang.Double">
	<![CDATA[select  sum(s.actual)
			         from hana_distribution_sku s
	                 left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
			         left join crm.crm_tb_cg cg on cg.sku_category_id=sku.sku_category_id
		             where 1=1
	]]>
	    <dynamic>
			<isNotEmpty property="yearQuery" prepend="and">
			<![CDATA[ s.year = #yearQuery# ]]>
			</isNotEmpty>
			<isNotEmpty property="monthQuery" prepend="and">
			<![CDATA[ s.month = #monthQuery# ]]>
			</isNotEmpty>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ substr(lpad(s.kunnr,10,'0'),3,8) = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ cg.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.year <= #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.month <= #month# ]]>
			</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="searchKunnrManagerCount" parameterClass="kunnrManager" resultClass="java.lang.Integer">
	    <![CDATA[ select count(*)
	                     from crm.crm_tb_kunnr_manager m
	                     where m.status='U'
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ m.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ m.manager_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ m.manager_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ m.sku_id = #skuId# ]]>
			</isNotEmpty>
		</dynamic> 
	</select>
	
	<select id="searchKunnrManagerListCount" parameterClass="kunnrManager" resultClass="java.lang.Integer">
	    <![CDATA[ select count(*)
	                     from (select cg.sku_category_id,cg.category_name,ss.org_id,ss.safety_year,ss.safety_month,ss.quantity 
	                                  from crm.crm_tb_cg cg , crm.crm_tb_kunnr_stock_safety ss  
	                                  where ss.status='U' and ss.is_limit='N'
                                      and cg.status='U' and cg.company_id='1' and cg.sap_groups_code is not null) s
                         left join basis.basis_tb_org_temp ot on ot.rc_org_id=s.org_id
                         left join crm.crm_tb_kunnr k on k.org_id=ot.org_id
	                     left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U') m on m.kunnr=k.kunnr and s.sku_category_id=m.sku_category_id and s.safety_year=m.manager_year and s.safety_month=m.manager_month
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		</dynamic> 
	</select>
	
	<select id="searchKunnrManagerList" parameterClass="kunnrManager" resultClass="kunnrManager">
	<include refid="global.paginationStart" />
	    <![CDATA[ select k.kunnr as kunnr,
	                     s.sku_category_id as cgId,
		                 s.category_name as categoryName,
	                     s.safety_year as year,
	                     s.safety_month as month,
	                     k.name1 as kunnrName,
	                     ot.p_org_name as orgProvince,
		                 ot.org_name as orgCity,
		                 ot.rc_org_name as orgRegion,
	                     nvl(m.sales_plan,g3.goal) as salesPlan,
	                     nvl(m.sales_plan_next,g4.goal) as salesPlanNext,
	                     st.quantity as lastEstimateStock,
		                 nvl(m.stock_safety,round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s.quantity,1)) as stockSafety,
		                 nvl(m.stock_safety_limit,round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s1.quantity,1)) as stockSafetyLimit,
		                 nvl(m.stock_safety_next_limit,round(g2.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2)),'dd'))*s2.quantity,1)) as stockSafetyNextLimit,
		                 nvl(m.stock_safety_next,round(g2.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2)),'dd'))*s3.quantity,1)) as stockSafetyNext,
		                 h1.actual as salesLastYearLast,
		                 h2.actual as salesLastYear,
		                 h3.actual as salesLastYearNext,
		                 m1.sales_plan_next as salesPlanLast,
		                 m.production_plan as productionPlan,
		                 m.production_plan_next as productionPlanNext,
		                 m1.production_plan_next as productionPlanLast
	                     from (select cg.sku_category_id,cg.category_name,ss.org_id,ss.safety_year,ss.safety_month,ss.quantity
	                                  from crm.crm_tb_cg cg , crm.crm_tb_kunnr_stock_safety ss  
	                                  where ss.status='U' and ss.is_limit='N'
                                      and cg.status='U' and cg.company_id='1' and cg.sap_groups_code is not null) s
                         left join basis.basis_tb_org_temp ot on ot.rc_org_id=s.org_id
                         left join crm.crm_tb_kunnr k on k.org_id=ot.org_id
	                     left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U') m on m.kunnr=k.kunnr and s.sku_category_id=m.sku_category_id and s.safety_year=m.manager_year and s.safety_month=m.manager_month
		                 left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s1 on s1.org_id=s.org_id and s1.safety_year=s.safety_year and s1.safety_month=s.safety_month
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s2 on s2.org_id=s.org_id 
                                                and s2.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))  
                                                and s2.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='N'
                                           ) s3 on s3.org_id=s.org_id 
                                                and s3.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))  
                                                and s3.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='N'
                                           ) s4 on s4.org_id=s.org_id 
                                                and s4.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))  
                                                and s4.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U'
                                           ) m1 on m1.kunnr=k.kunnr 
                                                and m1.sku_category_id=s.sku_category_id
                                                and m1.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and m1.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U'
                                           ) m2 on m2.kunnr=k.kunnr 
                                                and m2.sku_category_id=s.sku_category_id
                                                and m2.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
                                                and m2.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h1 on h1.kunnr=k.kunnr 
                                                and h1.sku_category_id=s.sku_category_id
                                                and h1.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'yyyy'))
                                                and h1.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h2 on h2.kunnr=k.kunnr 
                                                and h2.sku_category_id=s.sku_category_id
                                                and h2.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'yyyy'))
                                                and h2.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h3 on h3.kunnr=k.kunnr 
                                                and h3.sku_category_id=s.sku_category_id
                                                and h3.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'yyyy'))
                                                and h3.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'MM'))
                         left join (select t.kunnr,t.sku_category_id,to_number(substr(t.check_time,0,4)) year,to_number(substr(t.check_time,6,2)) month,sum(t.quantity*nvl(u.sku_unit_coefficient,1)) quantity
                                           from crm.crm_tb_kunnr_stock_total t
                                           left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=t.sku_id
                                           where t.flag='kunnr_month' and t.status='U'
                                           group by t.kunnr,t.sku_category_id,t.check_time
                                           ) st on st.kunnr=k.kunnr
                                                and st.sku_category_id=s.sku_category_id
                                                and st.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and st.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g1 on g1.kunnr=k.kunnr
		                                        and g1.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g1.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		                                        and g1.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g2 on g2.kunnr=k.kunnr
		                                        and g2.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2),'yyyy'))
		                                        and g2.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2),'MM'))
		                                        and g2.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g3 on g3.kunnr=k.kunnr
		                                        and g3.goal_year=s.safety_year
		                                        and g3.goal_month=s.safety_month
		                                        and g3.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g4 on g4.kunnr=k.kunnr
		                                        and g4.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g4.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		                                        and g4.sku_category_id=s.sku_category_id
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		</dynamic> 
		    <![CDATA[ order by k.kunnr,s.sku_category_id,s.safety_year,s.safety_month ]]>
		<include refid="global.paginationEnd" />
	</select>
	
	
	
	<select id="searchKunnrManagerListForExcel" parameterClass="kunnrManager" resultClass="kunnrManager">
	  <![CDATA[
	    select t.kunnr,
	           k.name1 kunnrName,
	           t.sku_category_id cgId,
	           cg.category_name categoryName,
	           ot.p_org_name as orgProvince,
		       ot.org_name as orgCity,
		       ot.rc_org_name as orgRegion,
	           t.manager_year year,
	           t.manager_month month,
	           t.sales_plan salesPlan,
	           t.sales_plan_next salesPlanNext,
	           t.production_plan productionPlan,
               t.production_plan_next productionPlanNext,
               t.stock_safety stockSafety,
               t.stock_safety_limit stockSafetyLimit,
               t.stock_safety_next stockSafetyNext,
               t.stock_safety_next_limit stockSafetyNextLimit
               from crm.crm_tb_kunnr_manager t
               left join crm.crm_tb_kunnr k on k.kunnr=t.kunnr
               left join basis.basis_tb_org_temp ot on ot.org_id=k.org_id
               left join crm.crm_tb_cg cg on cg.sku_category_id=t.sku_category_id
               where t.status='U'
      ]]>
      <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ t.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when t.manager_month>=10 
			                then to_char(to_date(t.manager_year||t.manager_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(t.manager_year||0||t.manager_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when t.manager_month>=10 
			                then to_char(to_date(t.manager_year||t.manager_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(t.manager_year||0||t.manager_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ t.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		</dynamic> 
      <![CDATA[  order by t.kunnr,t.sku_category_id ]]>
	</select>
	
	<select id="searchKunnrManagerListGroupByOrg" parameterClass="kunnrManager" resultClass="kunnrManager">
	    <![CDATA[ select 
	                     k.org_id,
	                     max(ot.p_org_name) as orgProvince,
		                 max(ot.org_name) as orgCity,
		                 max(ot.rc_org_name) as orgRegion,
		                 max(s.category_name) as categoryName,
	                     sum(nvl(m.sales_plan,g3.goal)) as salesPlan,
	                     sum(nvl(m.sales_plan_next,g4.goal)) as salesPlanNext,
	                     sum(st.quantity) as lastEstimateStock,
		                 sum(nvl(m.stock_safety,round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s.quantity,1))) as stockSafety,
		                 sum(nvl(m.stock_safety_limit,round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s1.quantity,1))) as stockSafetyLimit,
		                 sum(nvl(m.stock_safety_next_limit,round(g2.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2)),'dd'))*s2.quantity,1))) as stockSafetyNextLimit,
		                 sum(nvl(m.stock_safety_next,round(g2.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2)),'dd'))*s3.quantity,1))) as stockSafetyNext,
		                 sum(h1.actual) as salesLastYearLast,
		                 sum(h2.actual) as salesLastYear,
		                 sum(h3.actual) as salesLastYearNext,
		                 sum(m1.sales_plan_next) as salesPlanLast,
		                 sum(m.production_plan) as productionPlan,
		                 sum(m.production_plan_next) as productionPlanNext,
		                 sum(m1.production_plan_next) as productionPlanLast
	                     from (select cg.sku_category_id,cg.category_name,ss.org_id,ss.safety_year,ss.safety_month,ss.quantity
	                                  from crm.crm_tb_cg cg , crm.crm_tb_kunnr_stock_safety ss  
	                                  where ss.status='U' and ss.is_limit='N'
                                      and cg.status='U' and cg.company_id='1' and cg.sap_groups_code is not null) s
                         left join basis.basis_tb_org_temp ot on ot.rc_org_id=s.org_id
                         left join crm.crm_tb_kunnr k on k.org_id=ot.org_id
	                     left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U') m on m.kunnr=k.kunnr and s.sku_category_id=m.sku_category_id and s.safety_year=m.manager_year and s.safety_month=m.manager_month
		                 left join (select distinct uu.sku_unit_coefficient,sku.sku_category_id 
		                                            from crm.crm_tb_sku_unitcoefficient uu
		                                            left join crm.crm_tb_sku sku on uu.sku_id=sku.sku_id) u on u.sku_category_id=s.sku_category_id
		                 left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s1 on s1.org_id=s.org_id and s1.safety_year=s.safety_year and s1.safety_month=s.safety_month
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s2 on s2.org_id=s.org_id 
                                                and s2.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))  
                                                and s2.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='N'
                                           ) s3 on s3.org_id=s.org_id 
                                                and s3.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))  
                                                and s3.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='N'
                                           ) s4 on s4.org_id=s.org_id 
                                                and s4.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))  
                                                and s4.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U'
                                           ) m1 on m1.kunnr=k.kunnr 
                                                and m1.sku_category_id=s.sku_category_id
                                                and m1.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and m1.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U'
                                           ) m2 on m2.kunnr=k.kunnr 
                                                and m2.sku_category_id=s.sku_category_id
                                                and m2.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
                                                and m2.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h1 on h1.kunnr=k.kunnr 
                                                and h1.sku_category_id=s.sku_category_id
                                                and h1.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'yyyy'))
                                                and h1.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h2 on h2.kunnr=k.kunnr 
                                                and h2.sku_category_id=s.sku_category_id
                                                and h2.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'yyyy'))
                                                and h2.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h3 on h3.kunnr=k.kunnr 
                                                and h3.sku_category_id=s.sku_category_id
                                                and h3.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'yyyy'))
                                                and h3.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'MM'))
                         left join (select t.kunnr,t.sku_category_id,to_number(substr(t.check_time,0,4)) year,to_number(substr(t.check_time,6,2)) month,sum(t.quantity*nvl(u.sku_unit_coefficient,1)) quantity
                                           from crm.crm_tb_kunnr_stock_total t
                                           left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=t.sku_id
                                           where t.flag='kunnr_month' and t.status='U'
                                           group by t.kunnr,t.sku_category_id,t.check_time
                                           ) st on st.kunnr=k.kunnr
                                                and st.sku_category_id=s.sku_category_id
                                                and st.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and st.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select g.kunnr,g.goal_year,g.goal_month,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month
		                                   ) g1 on g1.kunnr=k.kunnr
		                                        and g1.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g1.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		                 left join (select g.kunnr,g.goal_year,g.goal_month,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month
		                                   ) g2 on g2.kunnr=k.kunnr
		                                        and g2.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2),'yyyy'))
		                                        and g2.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2),'MM'))
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g3 on g3.kunnr=k.kunnr
		                                        and g3.goal_year=s.safety_year
		                                        and g3.goal_month=s.safety_month
		                                        and g3.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g4 on g4.kunnr=k.kunnr
		                                        and g4.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g4.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		                                        and g4.sku_category_id=s.sku_category_id
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		</dynamic>
	</select>
	
	<select id="getKunnrManagerListSum" parameterClass="kunnrManager" resultClass="kunnrManager">
	    <![CDATA[ select 
	                     sum(nvl(m.sales_plan,g3.goal)) as salesPlan,
	                     sum(nvl(m.sales_plan_next,g4.goal)) as salesPlanNext,
	                     sum(st.quantity) as lastEstimateStock,
		                 sum(nvl(m.stock_safety,round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s.quantity,1))) as stockSafety,
		                 sum(nvl(m.stock_safety_limit,round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s1.quantity,1))) as stockSafetyLimit,
		                 sum(nvl(m.stock_safety_next_limit,round(g2.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2)),'dd'))*s2.quantity,1))) as stockSafetyNextLimit,
		                 sum(nvl(m.stock_safety_next,round(g2.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2)),'dd'))*s3.quantity,1))) as stockSafetyNext,
		                 sum(h1.actual) as salesLastYearLast,
		                 sum(h2.actual) as salesLastYear,
		                 sum(h3.actual) as salesLastYearNext,
		                 sum(m1.sales_plan_next) as salesPlanLast,
		                 sum(m.production_plan) as productionPlan,
		                 sum(m.production_plan_next) as productionPlanNext,
		                 sum(m1.production_plan_next) as productionPlanLast
	                     from (select cg.sku_category_id,cg.category_name,ss.org_id,ss.safety_year,ss.safety_month,ss.quantity
	                                  from crm.crm_tb_cg cg , crm.crm_tb_kunnr_stock_safety ss  
	                                  where ss.status='U' and ss.is_limit='N'
                                      and cg.status='U' and cg.company_id='1' and cg.sap_groups_code is not null) s
                         left join basis.basis_tb_org_temp ot on ot.rc_org_id=s.org_id
                         left join crm.crm_tb_kunnr k on k.org_id=ot.org_id
	                     left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U') m on m.kunnr=k.kunnr and s.sku_category_id=m.sku_category_id and s.safety_year=m.manager_year and s.safety_month=m.manager_month
		                 left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s1 on s1.org_id=s.org_id and s1.safety_year=s.safety_year and s1.safety_month=s.safety_month
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s2 on s2.org_id=s.org_id 
                                                and s2.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))  
                                                and s2.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='N'
                                           ) s3 on s3.org_id=s.org_id 
                                                and s3.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))  
                                                and s3.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='N'
                                           ) s4 on s4.org_id=s.org_id 
                                                and s4.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))  
                                                and s4.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U'
                                           ) m1 on m1.kunnr=k.kunnr 
                                                and m1.sku_category_id=s.sku_category_id
                                                and m1.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and m1.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U'
                                           ) m2 on m2.kunnr=k.kunnr 
                                                and m2.sku_category_id=s.sku_category_id
                                                and m2.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
                                                and m2.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h1 on h1.kunnr=k.kunnr 
                                                and h1.sku_category_id=s.sku_category_id
                                                and h1.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'yyyy'))
                                                and h1.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h2 on h2.kunnr=k.kunnr 
                                                and h2.sku_category_id=s.sku_category_id
                                                and h2.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'yyyy'))
                                                and h2.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h3 on h3.kunnr=k.kunnr 
                                                and h3.sku_category_id=s.sku_category_id
                                                and h3.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'yyyy'))
                                                and h3.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'MM'))
                         left join (select t.kunnr,t.sku_category_id,to_number(substr(t.check_time,0,4)) year,to_number(substr(t.check_time,6,2)) month,sum(t.quantity*nvl(u.sku_unit_coefficient,1)) quantity
                                           from crm.crm_tb_kunnr_stock_total t
                                           left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=t.sku_id
                                           where t.flag='kunnr_month' and t.status='U'
                                           group by t.kunnr,t.sku_category_id,t.check_time
                                           ) st on st.kunnr=k.kunnr
                                                and st.sku_category_id=s.sku_category_id
                                                and st.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and st.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g1 on g1.kunnr=k.kunnr
		                                        and g1.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g1.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		                                        and g1.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g2 on g2.kunnr=k.kunnr
		                                        and g2.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2),'yyyy'))
		                                        and g2.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2),'MM'))
		                                        and g2.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g3 on g3.kunnr=k.kunnr
		                                        and g3.goal_year=s.safety_year
		                                        and g3.goal_month=s.safety_month
		                                        and g3.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g4 on g4.kunnr=k.kunnr
		                                        and g4.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g4.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		                                        and g4.sku_category_id=s.sku_category_id
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		</dynamic>
	</select>
	
	<select id="searchKunnrManagerKunnrSumListCount" parameterClass="kunnrManager" resultClass="java.lang.Integer">
	    <![CDATA[ 
	    select count(*) from (
	                     select k.kunnr,
	                     s.safety_year,
	                     s.safety_month,
	                     sum(s.quantity)
	                     from (select cg.sku_category_id,cg.category_name,ss.org_id,ss.safety_year,ss.safety_month,ss.quantity
	                                  from crm.crm_tb_cg cg , crm.crm_tb_kunnr_stock_safety ss  
	                                  where ss.status='U' and ss.is_limit='N'
                                      and cg.status='U' and cg.company_id='1' and cg.sap_groups_code is not null) s
                         left join basis.basis_tb_org_temp ot on ot.rc_org_id=s.org_id
                         left join crm.crm_tb_kunnr k on k.org_id=ot.org_id
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		    <isEqual compareValue="Y" property="status" prepend="and">
			<![CDATA[ exists (select kunnr,manager_year,manager_month from crm.crm_tb_kunnr_manager where kunnr=k.kunnr and manager_year=s.safety_year and manager_month=s.safety_month) ]]>
			</isEqual>
			<isEqual compareValue="N" property="status" prepend="and">
			<![CDATA[ not exists (select kunnr,manager_year,manager_month from crm.crm_tb_kunnr_manager where kunnr=k.kunnr and manager_year=s.safety_year and manager_month=s.safety_month) ]]>
			</isEqual>
		</dynamic>
		<![CDATA[ group by k.kunnr,s.safety_year,s.safety_month ]]>
		)
	</select>
	
	<select id="searchKunnrManagerKunnrSumList" parameterClass="kunnrManager" resultClass="kunnrManager">
	<include refid="global.paginationStart" />
	    <![CDATA[ select k.kunnr as kunnr,
	                     s.safety_year as year,
	                     s.safety_month as month,
	                     max(k.name1) as kunnrName,
	                     max(ot.p_org_name) as orgProvince,
		                 max(ot.org_name) as orgCity,
		                 max(ot.rc_org_name) as orgRegion,
	                     sum(nvl(m.sales_plan,g3.goal)) as salesPlan,
	                     sum(nvl(m.sales_plan_next,g4.goal)) as salesPlanNext,
	                     sum(st.quantity) as lastEstimateStock,
		                 sum(nvl(m.stock_safety,round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s.quantity,1))) as stockSafety,
		                 sum(nvl(m.stock_safety_limit,round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s1.quantity,1))) as stockSafetyLimit,
		                 sum(nvl(m.stock_safety_next_limit,round(g2.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2)),'dd'))*s2.quantity,1))) as stockSafetyNextLimit,
		                 sum(nvl(m.stock_safety_next,round(g2.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2)),'dd'))*s3.quantity,1))) as stockSafetyNext,
		                 sum(h1.actual) as salesLastYearLast,
		                 sum(h2.actual) as salesLastYear,
		                 sum(h3.actual) as salesLastYearNext,
		                 sum(m1.sales_plan_next) as salesPlanLast,
		                 sum(m.production_plan) as productionPlan,
		                 sum(m.production_plan_next) as productionPlanNext,
		                 sum(m1.production_plan_next) as productionPlanLast
	                     from (select cg.sku_category_id,cg.category_name,ss.org_id,ss.safety_year,ss.safety_month,ss.quantity
	                                  from crm.crm_tb_cg cg , crm.crm_tb_kunnr_stock_safety ss  
	                                  where ss.status='U' and ss.is_limit='N'
                                      and cg.status='U' and cg.company_id='1' and cg.sap_groups_code is not null) s
                         left join basis.basis_tb_org_temp ot on ot.rc_org_id=s.org_id
                         left join crm.crm_tb_kunnr k on k.org_id=ot.org_id
	                     left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U') m on m.kunnr=k.kunnr and s.sku_category_id=m.sku_category_id and s.safety_year=m.manager_year and s.safety_month=m.manager_month
		                 left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s1 on s1.org_id=s.org_id and s1.safety_year=s.safety_year and s1.safety_month=s.safety_month
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s2 on s2.org_id=s.org_id 
                                                and s2.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))  
                                                and s2.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='N'
                                           ) s3 on s3.org_id=s.org_id 
                                                and s3.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))  
                                                and s3.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='N'
                                           ) s4 on s4.org_id=s.org_id 
                                                and s4.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))  
                                                and s4.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U'
                                           ) m1 on m1.kunnr=k.kunnr 
                                                and m1.sku_category_id=s.sku_category_id
                                                and m1.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and m1.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U'
                                           ) m2 on m2.kunnr=k.kunnr 
                                                and m2.sku_category_id=s.sku_category_id
                                                and m2.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
                                                and m2.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h1 on h1.kunnr=k.kunnr 
                                                and h1.sku_category_id=s.sku_category_id
                                                and h1.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'yyyy'))
                                                and h1.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h2 on h2.kunnr=k.kunnr 
                                                and h2.sku_category_id=s.sku_category_id
                                                and h2.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'yyyy'))
                                                and h2.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h3 on h3.kunnr=k.kunnr 
                                                and h3.sku_category_id=s.sku_category_id
                                                and h3.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'yyyy'))
                                                and h3.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'MM'))
                         left join (select t.kunnr,t.sku_category_id,to_number(substr(t.check_time,0,4)) year,to_number(substr(t.check_time,6,2)) month,sum(t.quantity*nvl(u.sku_unit_coefficient,1)) quantity
                                           from crm.crm_tb_kunnr_stock_total t
                                           left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=t.sku_id
                                           where t.flag='kunnr_month' and t.status='U'
                                           group by t.kunnr,t.sku_category_id,t.check_time
                                           ) st on st.kunnr=k.kunnr
                                                and st.sku_category_id=s.sku_category_id
                                                and st.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and st.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g1 on g1.kunnr=k.kunnr
		                                        and g1.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g1.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		                                        and g1.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g2 on g2.kunnr=k.kunnr
		                                        and g2.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2),'yyyy'))
		                                        and g2.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2),'MM'))
		                                        and g2.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g3 on g3.kunnr=k.kunnr
		                                        and g3.goal_year=s.safety_year
		                                        and g3.goal_month=s.safety_month
		                                        and g3.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g4 on g4.kunnr=k.kunnr
		                                        and g4.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g4.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		                                        and g4.sku_category_id=s.sku_category_id
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		    <isEqual compareValue="Y" property="status" prepend="and">
			<![CDATA[ exists (select kunnr,manager_year,manager_month from crm.crm_tb_kunnr_manager where kunnr=k.kunnr and manager_year=m.manager_year and manager_month=m.manager_month) ]]>
			</isEqual>
			<isEqual compareValue="N" property="status" prepend="and">
			<![CDATA[ not exists (select kunnr,manager_year,manager_month from crm.crm_tb_kunnr_manager where kunnr=k.kunnr and manager_year=s.safety_year and manager_month=s.safety_month) ]]>
			</isEqual>
		</dynamic>
		<![CDATA[ group by k.kunnr,s.safety_year,s.safety_month
		          order by k.kunnr,s.safety_year,s.safety_month ]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="searchKunnrManagerKunnrByOrgSumListCount" parameterClass="kunnrManager" resultClass="java.lang.Integer">
	    <![CDATA[ 
	    select count(*) from (
	                     select o.org_id,
	                     s.safety_year,
	                     s.safety_month,
	                     s.sku_category_id,
	                     sum(s.quantity)
	                     from (select cg.sku_category_id,cg.category_name,ss.org_id,ss.safety_year,ss.safety_month,ss.quantity
	                                  from crm.crm_tb_cg cg , crm.crm_tb_kunnr_stock_safety ss  
	                                  where ss.status='U' and ss.is_limit='N'
                                      and cg.status='U' and cg.company_id='1' and cg.sap_groups_code is not null) s
                         left join basis.basis_tb_org_temp ot on ot.rc_org_id=s.org_id ]]>
            <isEqual compareValue="C" property="sql" >
			<![CDATA[  left join basis.basis_tb_org o on o.org_id=ot.rc_org_id]]>
			</isEqual>
            <isEqual compareValue="D" property="sql" >
			<![CDATA[  left join basis.basis_tb_org o on o.org_id=ot.p_org_id]]>
			</isEqual>
			<isEqual compareValue="I" property="sql" >
			<![CDATA[  left join basis.basis_tb_org o on o.org_id=ot.org_id]]>
			</isEqual>
               <![CDATA[ 
                         left join crm.crm_tb_kunnr k on k.org_id=ot.org_id
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		    <isEqual compareValue="Y" property="status" prepend="and">
			<![CDATA[ exists (select kunnr,manager_year,manager_month from crm.crm_tb_kunnr_manager where kunnr=k.kunnr and manager_year=s.safety_year and manager_month=s.safety_month) ]]>
			</isEqual>
			<isEqual compareValue="N" property="status" prepend="and">
			<![CDATA[ not exists (select kunnr,manager_year,manager_month from crm.crm_tb_kunnr_manager where kunnr=k.kunnr and manager_year=s.safety_year and manager_month=s.safety_month) ]]>
			</isEqual>
		</dynamic>
		<![CDATA[ group by o.org_id,s.sku_category_id,s.safety_year,s.safety_month ]]>
		)
	</select>
	
	<select id="searchKunnrManagerKunnrByOrgSumList" parameterClass="kunnrManager" resultClass="kunnrManager" remapResults="true">
	<include refid="global.paginationStart" />
	    <![CDATA[ select o.org_id as orgId,
	                     s.safety_year as year,
	                     s.safety_month as month,
	                     s.sku_category_id as cgId,
		                 max(s.category_name) as categoryName, ]]>
	        <isEqual compareValue="C" property="sql" >
			<![CDATA[  max(ot.rc_org_name) as orgRegion,]]>
			</isEqual>
            <isEqual compareValue="D" property="sql" >
			<![CDATA[  max(ot.p_org_name) as orgProvince,
		               max(ot.rc_org_name) as orgRegion,]]>
			</isEqual>
			<isEqual compareValue="I" property="sql" >
			<![CDATA[  max(ot.p_org_name) as orgProvince,
		               max(ot.org_name) as orgCity,
		               max(ot.rc_org_name) as orgRegion,]]>
			</isEqual>
	            <![CDATA[
	                     sum(nvl(m.sales_plan,g3.goal)) as salesPlan,
	                     sum(nvl(m.sales_plan_next,g4.goal)) as salesPlanNext,
	                     sum(st.quantity) as lastEstimateStock,
		                 sum(nvl(m.stock_safety,round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s.quantity,1))) as stockSafety,
		                 sum(nvl(m.stock_safety_limit,round(g1.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1)),'dd'))*s1.quantity,1))) as stockSafetyLimit,
		                 sum(nvl(m.stock_safety_next_limit,round(g2.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2)),'dd'))*s2.quantity,1))) as stockSafetyNextLimit,
		                 sum(nvl(m.stock_safety_next,round(g2.goal/to_number(to_char(last_day(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2)),'dd'))*s3.quantity,1))) as stockSafetyNext,
		                 sum(h1.actual) as salesLastYearLast,
		                 sum(h2.actual) as salesLastYear,
		                 sum(h3.actual) as salesLastYearNext,
		                 sum(m1.sales_plan_next) as salesPlanLast,
		                 sum(m.production_plan) as productionPlan,
		                 sum(m.production_plan_next) as productionPlanNext,
		                 sum(m1.production_plan_next) as productionPlanLast
	                     from (select cg.sku_category_id,cg.category_name,ss.org_id,ss.safety_year,ss.safety_month,ss.quantity
	                                  from crm.crm_tb_cg cg , crm.crm_tb_kunnr_stock_safety ss  
	                                  where ss.status='U' and ss.is_limit='N'
                                      and cg.status='U' and cg.company_id='1' and cg.sap_groups_code is not null) s
                         left join basis.basis_tb_org_temp ot on ot.rc_org_id=s.org_id ]]>
            <isEqual compareValue="C" property="sql" >
			<![CDATA[  left join basis.basis_tb_org o on o.org_id=ot.rc_org_id]]>
			</isEqual>
            <isEqual compareValue="D" property="sql" >
			<![CDATA[  left join basis.basis_tb_org o on o.org_id=ot.p_org_id]]>
			</isEqual>
			<isEqual compareValue="I" property="sql" >
			<![CDATA[  left join basis.basis_tb_org o on o.org_id=ot.org_id]]>
			</isEqual>
               <![CDATA[ left join crm.crm_tb_kunnr k on k.org_id=ot.org_id
	                     left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U') m on m.kunnr=k.kunnr and s.sku_category_id=m.sku_category_id and s.safety_year=m.manager_year and s.safety_month=m.manager_month
		                 left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s1 on s1.org_id=s.org_id and s1.safety_year=s.safety_year and s1.safety_month=s.safety_month
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='Y'
                                           ) s2 on s2.org_id=s.org_id 
                                                and s2.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))  
                                                and s2.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='N'
                                           ) s3 on s3.org_id=s.org_id 
                                                and s3.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))  
                                                and s3.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select ss.quantity,ss.org_id,ss.safety_year,ss.safety_month
                                           from crm.crm_tb_kunnr_stock_safety ss 
                                           where ss.status='U' and ss.is_limit='N'
                                           ) s4 on s4.org_id=s.org_id 
                                                and s4.safety_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))  
                                                and s4.safety_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U'
                                           ) m1 on m1.kunnr=k.kunnr 
                                                and m1.sku_category_id=s.sku_category_id
                                                and m1.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and m1.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U'
                                           ) m2 on m2.kunnr=k.kunnr 
                                                and m2.sku_category_id=s.sku_category_id
                                                and m2.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
                                                and m2.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h1 on h1.kunnr=k.kunnr 
                                                and h1.sku_category_id=s.sku_category_id
                                                and h1.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'yyyy'))
                                                and h1.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h2 on h2.kunnr=k.kunnr 
                                                and h2.sku_category_id=s.sku_category_id
                                                and h2.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'yyyy'))
                                                and h2.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,sku.sku_category_id,sum(actual) actual
                                           from hana_distribution_sku s
                                           left join crm.crm_tb_sku sku on sku.sku_id=s.sku_id
                                           group by s.kunnr,s.year,s.month,sku.sku_category_id
                                           ) h3 on h3.kunnr=k.kunnr 
                                                and h3.sku_category_id=s.sku_category_id
                                                and h3.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'yyyy'))
                                                and h3.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'MM'))
                         left join (select t.kunnr,t.sku_category_id,to_number(substr(t.check_time,0,4)) year,to_number(substr(t.check_time,6,2)) month,sum(t.quantity*nvl(u.sku_unit_coefficient,1)) quantity
                                           from crm.crm_tb_kunnr_stock_total t
                                           left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=t.sku_id
                                           where t.flag='kunnr_month' and t.status='U'
                                           group by t.kunnr,t.sku_category_id,t.check_time
                                           ) st on st.kunnr=k.kunnr
                                                and st.sku_category_id=s.sku_category_id
                                                and st.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and st.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g1 on g1.kunnr=k.kunnr
		                                        and g1.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g1.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		                                        and g1.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g2 on g2.kunnr=k.kunnr
		                                        and g2.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2),'yyyy'))
		                                        and g2.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),2),'MM'))
		                                        and g2.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g3 on g3.kunnr=k.kunnr
		                                        and g3.goal_year=s.safety_year
		                                        and g3.goal_month=s.safety_month
		                                        and g3.sku_category_id=s.sku_category_id
		                 left join (select g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id,sum(g.box_num) goal
		                                   from crm.crm_tb_goal_production g
		                                   left join basis.basis_tb_org_temp ot on ot.org_id=g.org_id
		                                   left join crm.crm_tb_cg cg on cg.sap_groups_code=g.matter_num
		                                   where g.goal_mark='Y' and g.status='U'
		                                   group by g.kunnr,g.goal_year,g.goal_month,cg.sku_category_id
		                                   ) g4 on g4.kunnr=k.kunnr
		                                        and g4.goal_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'yyyy'))
		                                        and g4.goal_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),1),'MM'))
		                                        and g4.sku_category_id=s.sku_category_id
	                     where 1=1
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		    <isEqual compareValue="Y" property="status" prepend="and">
			<![CDATA[ exists (select kunnr,manager_year,manager_month from crm.crm_tb_kunnr_manager where kunnr=k.kunnr and manager_year=m.manager_year and manager_month=m.manager_month) ]]>
			</isEqual>
			<isEqual compareValue="N" property="status" prepend="and">
			<![CDATA[ not exists (select kunnr,manager_year,manager_month from crm.crm_tb_kunnr_manager where kunnr=k.kunnr and manager_year=s.safety_year and manager_month=s.safety_month) ]]>
			</isEqual>
		</dynamic>
		<![CDATA[ group by o.org_id,s.sku_category_id,s.safety_year,s.safety_month
		          order by o.org_id,s.sku_category_id,s.safety_year,s.safety_month ]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="searchKunnrManagerSkuListCount" parameterClass="kunnrManager" resultClass="java.lang.Integer">
	    <![CDATA[ select count(*)
	                     from (select cg.sku_category_id,cg.category_name,ss.org_id,ss.safety_year,ss.safety_month,ss.quantity 
	                                  from crm.crm_tb_cg cg , crm.crm_tb_kunnr_stock_safety ss  
	                                  where ss.status='U' and ss.is_limit='N'
                                      and cg.status='U' and cg.company_id='1' and cg.sap_groups_code is not null) s
                         left join basis.basis_tb_org_temp ot on ot.rc_org_id=s.org_id
                         left join crm.crm_tb_kunnr k on k.org_id=ot.org_id
                         left join crm.crm_tb_sku sku on sku.sku_category_id=s.sku_category_id
                         left join crm.crm_tb_kunnr_sku_percent p on p.sku_id=sku.sku_id and p.org_id=s.org_id
	                     left join (select mm.* from crm.crm_tb_kunnr_manager mm where mm.status='U') m on m.kunnr=k.kunnr and s.sku_category_id=m.sku_category_id and s.safety_year=m.manager_year and s.safety_month=m.manager_month
		                 left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=sku.sku_id
	                     where p.percent is not null
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ sku.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		</dynamic>
	</select>
	
	<select id="searchKunnrManagerSkuList" parameterClass="kunnrManager" resultClass="kunnrManager">
	<include refid="global.paginationStart" />
	    <![CDATA[ select k.kunnr as kunnr,
	                     sku.sku_id as skuId,
	                     sku.sku_name as skuName,
	                     s.sku_category_id as cgId,
	                     s.safety_year as year,
	                     s.safety_month as month,
	                     k.name1 as kunnrName,
	                     ot.p_org_name as orgProvince,
		                 ot.org_name as orgCity,
		                 ot.rc_org_name as orgRegion,
		                 s.category_name as categoryName,
		                 u.sku_unit_coefficient as skuUnitCoefficient,
		                 p.percent as percent,
	                     m.sales_plan as salesPlan,
	                     m.sales_plan_next as salesPlanNext,
	                     st.quantity as lastEstimateStock,
		                 m.stock_safety as stockSafety,
		                 m.stock_safety_limit as stockSafetyLimit,
		                 m.stock_safety_next_limit as stockSafetyNextLimit,
		                 m.stock_safety_next as stockSafetyNext,
		                 round(h1.actual/nvl(u.sku_unit_coefficient,1),1) as salesLastYearLast,
		                 round(h2.actual/nvl(u.sku_unit_coefficient,1),1) as salesLastYear,
		                 round(h3.actual/nvl(u.sku_unit_coefficient,1),1) as salesLastYearNext,
		                 round(m1.sales_plan_next,1) as salesPlanLast,
		                 m.production_plan as productionPlan,
		                 m.production_plan_next as productionPlanNext,
		                 round(m1.production_plan_next,1) as productionPlanLast
	                     from (select cg.sku_category_id,cg.category_name,ss.org_id,ss.safety_year,ss.safety_month,ss.quantity
	                                  from crm.crm_tb_cg cg , crm.crm_tb_kunnr_stock_safety ss  
	                                  where ss.status='U' and ss.is_limit='N'
                                      and cg.status='U' and cg.company_id='1' and cg.sap_groups_code is not null) s
                         left join basis.basis_tb_org_temp ot on ot.rc_org_id=s.org_id
                         left join crm.crm_tb_sku sku on sku.sku_category_id=s.sku_category_id
                         left join crm.crm_tb_kunnr_sku_percent p on p.sku_id=sku.sku_id and p.org_id=s.org_id
                         left join crm.crm_tb_kunnr k on k.org_id=ot.org_id
	                     left join (select mm.* from crm.crm_tb_kunnr_manager_sku mm where mm.status='U') m on m.kunnr=k.kunnr and sku.sku_id=m.sku_id and s.safety_year=m.manager_year and s.safety_month=m.manager_month
		                 left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=sku.sku_id
                         left join (select mm.* from crm.crm_tb_kunnr_manager_sku mm where mm.status='U'
                                           ) m1 on m1.kunnr=k.kunnr 
                                                and m1.sku_id=sku.sku_id
                                                and m1.manager_year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and m1.manager_month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,s.sku_id,s.actual
                                           from hana_distribution_sku s
                                           ) h1 on h1.kunnr=k.kunnr 
                                                and h1.sku_id=sku.sku_id
                                                and h1.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'yyyy'))
                                                and h1.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-13),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,s.sku_id,s.actual
                                           from hana_distribution_sku s
                                           ) h2 on h2.kunnr=k.kunnr 
                                                and h2.sku_id=sku.sku_id
                                                and h2.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'yyyy'))
                                                and h2.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-12),'MM'))
                         left join (select substr(lpad(s.kunnr,10,'0'),3,8) kunnr,s.year,s.month,s.sku_id,s.actual
                                           from hana_distribution_sku s
                                           ) h3 on h3.kunnr=k.kunnr 
                                                and h3.sku_id=sku.sku_id
                                                and h3.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'yyyy'))
                                                and h3.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-11),'MM'))
                         left join (select t.kunnr,t.sku_id,to_number(substr(t.check_time,0,4)) year,to_number(substr(t.check_time,6,2)) month,sum(t.quantity) quantity
                                           from crm.crm_tb_kunnr_stock_total t
                                           where t.flag='kunnr_month' and t.status='U'
                                           group by t.kunnr,t.sku_id,t.check_time
                                           ) st on st.kunnr=k.kunnr
                                                and st.sku_id=sku.sku_id
                                                and st.year=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'yyyy'))
                                                and st.month=to_number(to_char(add_months(to_date(s.safety_year||s.safety_month,'yyyyMM'),-1),'MM'))
	                     where p.percent is not null
	    ]]>
	    <dynamic>
			<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr# ]]>
			</isNotEmpty>
			<isNotEmpty property="year" prepend="and">
			<![CDATA[ s.safety_year = #year# ]]>
			</isNotEmpty>
			<isNotEmpty property="month" prepend="and">
			<![CDATA[ s.safety_month = #month# ]]>
			</isNotEmpty>
			<isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when s.safety_month>=10 
			                then to_char(to_date(s.safety_year||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(s.safety_year||0||s.safety_month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
			</isNotEmpty>
			<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ sku.sku_id = #skuId# ]]>
			</isNotEmpty>
			<isNotEmpty property="cgId" prepend="and">
			<![CDATA[ s.sku_category_id = #cgId# ]]>
			</isNotEmpty>
			<isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		</dynamic> 
		    <![CDATA[ order by k.kunnr,s.sku_category_id,sku.sku_id,s.safety_year,s.safety_month ]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<insert id="createKunnrManager" parameterClass="kunnrManager">
	    <![CDATA[
	      insert into crm.crm_tb_kunnr_manager(
	             kunnr,
                 sku_category_id,
                 manager_year,
                 manager_month,
                 sales_plan,
                 sales_plan_next,
                 production_plan,
                 production_plan_next,
                 stock_safety,
                 stock_safety_limit,
                 stock_safety_next,
                 stock_safety_next_limit,
                 create_date,
                 user_id,
                 status
                 )
                 values(
                 #kunnr#,
                 #cgId#,
                 #year#,
                 #month#,
                 #salesPlan#,
                 #salesPlanNext#,
                 #productionPlan#,
                 #productionPlanNext#,
                 #stockSafety#,
                 #stockSafetyLimit#,
                 #stockSafetyNext#,
                 #stockSafetyNextLimit#,
                 sysdate,
                 #userId#,
                 'U'
                 )
	    ]]> 
	</insert>
	
	<insert id="createKunnrManagerSku" parameterClass="kunnrManager">
	    <![CDATA[
	      insert into crm.crm_tb_kunnr_manager_sku(
	             kunnr,
                 sku_id,
                 manager_year,
                 manager_month,
                 sales_plan,
                 sales_plan_next,
                 production_plan,
                 production_plan_next,
                 stock_safety,
                 stock_safety_limit,
                 stock_safety_next,
                 stock_safety_next_limit,
                 create_date,
                 user_id,
                 status
                 )
                 values(
                 #kunnr#,
                 #skuId#,
                 #year#,
                 #month#,
                 #salesPlan#,
                 #salesPlanNext#,
                 #productionPlan#,
                 #productionPlanNext#,
                 #stockSafety#,
                 #stockSafetyLimit#,
                 #stockSafetyNext#,
                 #stockSafetyNextLimit#,
                 sysdate,
                 #userId#,
                 'U'
                 )
	    ]]> 
	</insert>
	
	<update id="updateKunnrManager" parameterClass="kunnrManager">
	   <![CDATA[
	      update crm.crm_tb_kunnr_manager s set
	      s.create_date=sysdate
	   ]]>
	   <dynamic>
	       <isNotEmpty property="salesPlan" prepend=",">
	          <![CDATA[ s.sales_plan = #salesPlan# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="salesPlanNext" prepend=",">
	          <![CDATA[ s.sales_plan_next = #salesPlanNext# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="productionPlan" prepend=",">
	          <![CDATA[ s.production_plan = #productionPlan# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="productionPlanNext" prepend=",">
	          <![CDATA[ s.production_plan_next = #productionPlanNext# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="stockSafety" prepend=",">
	          <![CDATA[ s.stock_safety = #stockSafety# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="stockSafetyLimit" prepend=",">
	          <![CDATA[ s.stock_safety_limit = #stockSafetyLimit# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="stockSafetyNext" prepend=",">
	          <![CDATA[ s.stock_safety_next = #stockSafetyNext# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="stockSafetyNextLimit" prepend=",">
	          <![CDATA[ s.stock_safety_next_limit = #stockSafetyNextLimit# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="userId" prepend=",">
	          <![CDATA[ s.user_id = #userId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="status" prepend=",">
	          <![CDATA[ s.status = #status# ]]>
	       </isNotEmpty>
	    </dynamic>
	    <![CDATA[ where 1=1 ]]>
           <dynamic>
	       <isNotEmpty property="kunnr" prepend="and">
	          <![CDATA[ s.kunnr = #kunnr# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="cgId" prepend="and">
	          <![CDATA[ s.sku_category_id = #cgId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="year" prepend="and">
	          <![CDATA[ s.manager_year = #year# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="month" prepend="and">
	          <![CDATA[ s.manager_month = #month# ]]>
	       </isNotEmpty>
	    </dynamic>
	</update>
	
	<update id="updateKunnrManagerSku" parameterClass="kunnrManager">
	   <![CDATA[
	      update crm.crm_tb_kunnr_manager_sku s set
	      s.create_date=sysdate
	   ]]>
	   <dynamic>
	       <isNotEmpty property="salesPlan" prepend=",">
	          <![CDATA[ s.sales_plan = #salesPlan# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="salesPlanNext" prepend=",">
	          <![CDATA[ s.sales_plan_next = #salesPlanNext# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="productionPlan" prepend=",">
	          <![CDATA[ s.production_plan = #productionPlan# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="productionPlanNext" prepend=",">
	          <![CDATA[ s.production_plan_next = #productionPlanNext# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="stockSafety" prepend=",">
	          <![CDATA[ s.stock_safety = #stockSafety# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="stockSafetyLimit" prepend=",">
	          <![CDATA[ s.stock_safety_limit = #stockSafetyLimit# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="stockSafetyNext" prepend=",">
	          <![CDATA[ s.stock_safety_next = #stockSafetyNext# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="stockSafetyNextLimit" prepend=",">
	          <![CDATA[ s.stock_safety_next_limit = #stockSafetyNextLimit# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="userId" prepend=",">
	          <![CDATA[ s.user_id = #userId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="status" prepend=",">
	          <![CDATA[ s.status = #status# ]]>
	       </isNotEmpty>
	    </dynamic>
	    <![CDATA[ where 1=1 ]]>
           <dynamic>
	       <isNotEmpty property="kunnr" prepend="and">
	          <![CDATA[ s.kunnr = #kunnr# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="skuId" prepend="and">
	          <![CDATA[ s.sku_id = #skuId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="year" prepend="and">
	          <![CDATA[ s.manager_year = #year# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="month" prepend="and">
	          <![CDATA[ s.manager_month = #month# ]]>
	       </isNotEmpty>
	    </dynamic>
	</update>
	
	<select id="getKunnrManagerCount" parameterClass="kunnrManager" resultClass="java.lang.Integer">
	    <![CDATA[
	        select count(*)
	        from crm.crm_tb_kunnr_manager s
	        where s.status='U'
	    ]]>
	    <dynamic>
	       <isNotEmpty property="kunnr" prepend="and">
	          <![CDATA[ s.kunnr = #kunnr# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="cgId" prepend="and">
	          <![CDATA[ s.sku_category_id = #cgId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="year" prepend="and">
	          <![CDATA[ s.manager_year = #year# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="month" prepend="and">
	          <![CDATA[ s.manager_month = #month# ]]>
	       </isNotEmpty>
	    </dynamic>
	</select>
	
	<insert id="createSkuUnitCoefficient" parameterClass="skuUnit">
	    <![CDATA[
	      insert into crm.crm_tb_sku_unitcoefficient(
                 sku_id,
                 sku_unit_coefficient,
                 create_date,
                 volum
                 )
                 values(
                 #skuId#,
                 #unitCoefficient#,
                 sysdate,
                 #volum#
                 )
	    ]]> 
	</insert>
	
	<delete id="deleteSkuUnitCoefficient">
	    <![CDATA[ delete crm.crm_tb_sku_unitcoefficient ]]>
	</delete>
	
	<select id="searchSkuUnitCoefficientListCount" parameterClass="skuUnit" resultClass="java.lang.Integer">
	    <![CDATA[
	        select count(*)
	        from crm.crm_tb_sku s 
            left join crm.crm_tb_cg c on c.sku_category_id=s.sku_category_id
            left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=s.sku_id
            where s.sku_company='1' and s.product_type='1'
	    ]]>
	    <dynamic>
	       <isNotEmpty property="skuId" prepend="and">
	          <![CDATA[ u.sku_id = #skuId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="skuName" prepend="and">
	          <![CDATA[ s.sku_name like #skuName,handler=wildcard# escape '\']]>
	       </isNotEmpty>
	       <isNotEmpty property="cgId" prepend="and">
	          <![CDATA[ c.sku_category_id = #cgId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="categoryName" prepend="and">
	          <![CDATA[ c.category_name like #categoryName,handler=wildcard# escape '\']]>
	       </isNotEmpty>
	       <isNotEmpty property="status" prepend="and">
	          <![CDATA[ s.status = #status# ]]>
	       </isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="searchSkuUnitCoefficientList" parameterClass="skuUnit" resultClass="skuUnit">
	<include refid="global.paginationStart" />
	    <![CDATA[
	        select s.sku_id as skuId,
	               s.sku_name as skuName,
	               c.sku_category_id as cgId,
	               c.category_name as categoryName,
	               s.sku_sap_code as matterNum,
	               u.sku_unit_coefficient as unitCoefficient,
	               s.status
	        from crm.crm_tb_sku s 
            left join crm.crm_tb_cg c on c.sku_category_id=s.sku_category_id
            left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=s.sku_id
            where s.sku_company='1' and s.product_type='1'
	    ]]>
	    <dynamic>
	       <isNotEmpty property="skuId" prepend="and">
	          <![CDATA[ u.sku_id = #skuId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="skuName" prepend="and">
	          <![CDATA[ s.sku_name like #skuName,handler=wildcard# escape '\']]>
	       </isNotEmpty>
	       <isNotEmpty property="cgId" prepend="and">
	          <![CDATA[ c.sku_category_id = #cgId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="categoryName" prepend="and">
	          <![CDATA[ c.category_name like #categoryName,handler=wildcard# escape '\']]>
	       </isNotEmpty>
	       <isNotEmpty property="status" prepend="and">
	          <![CDATA[ s.status = #status# ]]>
	       </isNotEmpty>
	    </dynamic>
	    <![CDATA[ order by u.sku_id ]]>
	    <include refid="global.paginationEnd" />
	</select>
	<select id="searchFactQuantity" parameterClass="java.util.Map"
		resultClass="stockReport">
		<![CDATA[
		select year searchYear,
		       month searchMonth,
		       kunnr kunnr,
		       sku_id skuId,
		       latest_stock quantity
		       from hana_distribution_sku
		       where 1 =1
		       ]]>
		<dynamic>
	    <isNotEmpty property="year" prepend="and">
			<![CDATA[ year=#year#]]>
		</isNotEmpty>
		<isNotEmpty property="month" prepend="and">
			<![CDATA[ month = #month#]]>
		</isNotEmpty>
	    <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ sku_id = #skuId#]]>
		</isNotEmpty>
	    </dynamic>
	</select>
	
	<insert id="createOrderStatusSap">
	<![CDATA[
	   insert into crm.crm_tb_order_status(
       KUNNR,
       MATNR,
	   ERDAT,
       AUDAT,
       VBELN1,
       POSNR1,
       KWMENG,
       PEDTR,
       TKNUM,
       VBELN2,
       POSNR2,
       WADAT_IST,
       PODAT,
       VBELN3,
       POSNR3,
       WBSTK,
       PDSTK,
       create_date)
       values
       (#kunnr#,
       #MATNR#,
	   #ERDAT#,
       #AUDAT#,
       #VBELN1#,
       #POSNR1#,
       #KWMENG#,
       #PEDTR#,
       #TKNUM#,
       #VBELN2#,
       #POSNR2#,
       #WADAT_IST#,
       #PODAT#,
       #VBELN3#,
       #POSNR3#,
       #WBSTK#,
       #PDSTK#,
       #createDateStr#)
	]]>
	</insert>
	
	<delete id="deleteOrderStatusSap">
	<![CDATA[
	    delete crm.crm_tb_order_status s
	    where s.kunnr=#kunnr#
	          and s.MATNR=#MATNR#
	          and s.VBELN1=#VBELN1#
	          and s.POSNR1=#POSNR1#
	]]>
	</delete>
	
	<select id="searchOrderStatusSapCount" parameterClass="orderFollow" resultClass="orderFollow">
	<![CDATA[
	    select k.kunnr 
	    from crm.crm_tb_kunnr k
	    where k.kunnr not in
	    (select distinct s.kunnr 
	            from crm.crm_tb_order_status s
	            where s.create_date=#createDateStr#
	     )
	]]>
	    <dynamic>
	       <isNotEmpty property="kunnr" prepend="and">
	          <![CDATA[ k.kunnr= #kunnr# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="searchOrderFollowListCount" parameterClass="orderFollow" resultClass="java.lang.Integer">
	    <![CDATA[
	        select 
	              count(*)
	        from crm.crm_tb_order_status t
	        left join crm.crm_tb_kunnr k on t.kunnr=k.kunnr
	        left join crm.crm_tb_kunnr_kunag kk on kk.kunnr=t.kunnr
	        left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
	        left join crm.crm_tb_sku s on t.MATNR=s.sku_sap_code
            left join crm.crm_tb_cg c on c.sku_category_id=s.sku_category_id
            where s.sku_sap_code is not null
	    ]]>
	    <dynamic>
	       <isNotEmpty property="kunnr" prepend="and">
	          <![CDATA[ t.kunnr= #kunnr# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="kunag" prepend="and">
	          <![CDATA[ nvl(kk.kunag,t.kunnr) = #kunag# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="skuId" prepend="and">
	          <![CDATA[ s.sku_id = #skuId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="categoryId" prepend="and">
	          <![CDATA[ c.sku_category_id = #categoryId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		   </isNotEmpty>
		   <isNotEmpty property="startDate" prepend="and">
	          <![CDATA[ t.ERDAT >= #startDate# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="endDate" prepend="and">
	          <![CDATA[ t.ERDAT <= #endDate# ]]>
	       </isNotEmpty>
	       <isEqual compareValue="1" property="orderState" prepend="and">
	          <![CDATA[ t.PEDTR is null ]]>
	       </isEqual>
	       <isEqual compareValue="2" property="orderState" prepend="and">
	          <![CDATA[  t.WBSTK<>'C' and t.PEDTR is not null ]]>
	       </isEqual>
	       <isEqual compareValue="3" property="orderState" prepend="and">
	          <![CDATA[ t.WBSTK='C' and t.PDSTK<>'C' ]]>
	       </isEqual>
	       <isEqual compareValue="4" property="orderState" prepend="and">
	          <![CDATA[ t.PDSTK='C' and t.VBELN3 is null ]]>
	       </isEqual>
	       <isEqual compareValue="5" property="orderState" prepend="and">
	          <![CDATA[ t.VBELN3 is not null ]]>
	       </isEqual>
	       <isEqual compareValue="6" property="orderState" prepend="and">
	          <![CDATA[ (t.PDSTK<>'C' or t.PDSTK is null) and t.VBELN3 is null ]]>
	       </isEqual>
	    </dynamic>
	</select>

	<select id="searchOrderFollowList" parameterClass="orderFollow" resultClass="orderFollow">
	<include refid="global.paginationStart" />
	    <![CDATA[
	        select 
	              k.kunnr,
	              k.name1 as kunnrName,
	              ot.p_org_name as orgProvince,
		          ot.org_name as orgCity,
		          ot.rc_org_name as orgRegion,
	              s.sku_id as skuId,
	              s.sku_name as skuName,
	              s.sku_sap_code as MATNR,
	              t.ERDAT,
	              t.AUDAT,
	              t.VBELN1,
	              t.POSNR1,
	              t.KWMENG,
	              t.PEDTR,
	              t.TKNUM,
	              t.VBELN2,
	              t.POSNR2,
	              t.WADAT_IST,
	              t.PODAT,
	              t.VBELN3,
	              t.POSNR3,
	              t.WBSTK,
	              t.PDSTK,
	              trunc(sysdate-to_date(t.PEDTR,'yyyy_mm-dd')) as outOfDate
	        from crm.crm_tb_order_status t
	        left join crm.crm_tb_kunnr k on t.kunnr=k.kunnr
	        left join crm.crm_tb_kunnr_kunag kk on kk.kunnr=t.kunnr
	        left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
	        left join crm.crm_tb_sku s on t.MATNR=s.sku_sap_code
            left join crm.crm_tb_cg c on c.sku_category_id=s.sku_category_id
            where s.sku_sap_code is not null
	    ]]>
	    <dynamic>
	       <isNotEmpty property="kunnr" prepend="and">
	          <![CDATA[ t.kunnr= #kunnr# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="kunag" prepend="and">
	          <![CDATA[ nvl(kk.kunag,t.kunnr) = #kunag# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="skuId" prepend="and">
	          <![CDATA[ s.sku_id = #skuId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="categoryId" prepend="and">
	          <![CDATA[ c.sku_category_id = #categoryId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		   <isNotEmpty property="startDate" prepend="and">
	          <![CDATA[ t.ERDAT >= #startDate# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="endDate" prepend="and">
	          <![CDATA[ t.ERDAT <= #endDate# ]]>
	       </isNotEmpty>
	       <isEqual compareValue="1" property="orderState" prepend="and">
	          <![CDATA[ t.PEDTR is null ]]>
	       </isEqual>
	       <isEqual compareValue="2" property="orderState" prepend="and">
	          <![CDATA[  t.WBSTK<>'C' and t.PEDTR is not null ]]>
	       </isEqual>
	       <isEqual compareValue="3" property="orderState" prepend="and">
	          <![CDATA[ t.WBSTK='C' and t.PDSTK<>'C' ]]>
	       </isEqual>
	       <isEqual compareValue="4" property="orderState" prepend="and">
	          <![CDATA[ t.PDSTK='C' and t.VBELN3 is null ]]>
	       </isEqual>
	       <isEqual compareValue="5" property="orderState" prepend="and">
	          <![CDATA[ t.VBELN3 is not null ]]>
	       </isEqual>
	       <isEqual compareValue="6" property="orderState" prepend="and">
	          <![CDATA[ (t.PDSTK<>'C'  or t.PDSTK is null) and t.VBELN3 is null ]]>
	       </isEqual>
	    </dynamic>
	    <![CDATA[ order by t.kunnr,s.sku_id ]]>
	    <include refid="global.paginationEnd" />
	</select>
	
	<select id="getOrderFollowSum" parameterClass="orderFollow" resultClass="orderFollow">
	    <![CDATA[
	        select 
	              sum(t.KWMENG) as POSNR1,
	              sum(t.KWMENG*nvl(u.sku_unit_coefficient,1)) as POSNR2
	        from crm.crm_tb_order_status t
	        left join crm.crm_tb_kunnr k on t.kunnr=k.kunnr
	        left join crm.crm_tb_kunnr_kunag kk on kk.kunnr=t.kunnr
	        left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
	        left join crm.crm_tb_sku s on t.MATNR=s.sku_sap_code
            left join crm.crm_tb_cg c on c.sku_category_id=s.sku_category_id
            left join crm.crm_tb_sku_unitcoefficient u on u.sku_id=s.sku_id
            where s.sku_sap_code is not null
	    ]]>
	    <dynamic>
	       <isNotEmpty property="kunnr" prepend="and">
	          <![CDATA[ t.kunnr= #kunnr# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="kunag" prepend="and">
	          <![CDATA[ nvl(kk.kunag,t.kunnr) = #kunag# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="skuId" prepend="and">
	          <![CDATA[ s.sku_id = #skuId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="categoryId" prepend="and">
	          <![CDATA[ c.sku_category_id = #categoryId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				      start with b.org_id = #orgId#
				      connect by prior b.org_id= b.org_parent_id)]]>
		    </isNotEmpty>
		   <isNotEmpty property="startDate" prepend="and">
	          <![CDATA[ t.ERDAT >= #startDate# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="endDate" prepend="and">
	          <![CDATA[ t.ERDAT <= #endDate# ]]>
	       </isNotEmpty>
	       <isEqual compareValue="1" property="orderState" prepend="and">
	          <![CDATA[ t.PEDTR is null ]]>
	       </isEqual>
	       <isEqual compareValue="2" property="orderState" prepend="and">
	          <![CDATA[  t.WBSTK<>'C' and t.PEDTR is not null ]]>
	       </isEqual>
	       <isEqual compareValue="3" property="orderState" prepend="and">
	          <![CDATA[ t.WBSTK='C' and t.PDSTK<>'C' ]]>
	       </isEqual>
	       <isEqual compareValue="4" property="orderState" prepend="and">
	          <![CDATA[ t.PDSTK='C' and t.VBELN3 is null ]]>
	       </isEqual>
	       <isEqual compareValue="5" property="orderState" prepend="and">
	          <![CDATA[ t.VBELN3 is not null ]]>
	       </isEqual>
	       <isEqual compareValue="6" property="orderState" prepend="and">
	          <![CDATA[ (t.PDSTK<>'C' or t.PDSTK is null) and t.VBELN3 is null ]]>
	       </isEqual>
	    </dynamic>
	</select>

	<delete id="deleteStockStateManager">
	     <![CDATA[ delete crm.crm_tb_stock_manager_temp ]]>
	</delete>
	<insert id="createStockStateManager" parameterClass="StockReport">
	    <selectKey resultClass="java.lang.Integer" keyProperty="stockId">
		<![CDATA[
			select crm.crm_seq_stock_manager_temp.nextval as stockId from dual
		]]>
		</selectKey>
		 <![CDATA[
		insert into crm.crm_tb_stock_manager_temp
      (temp_id,
       kunnr,
       kunnrName,
       skuId,
       skuName,
       categoryId,
       categoryName,
       safeQuantityMax,
       safeQuantityMin,
       quantity,
       onWayNum,
       planNotSend,
       notPlan,
       needPlan,
       needOrder,
       coefficient,
       flag,
       userId,
       userName,
       createDate
       )
       values 
       (#stockId#,
       #kunnr#,
       #kunnrName#,
       #skuId#,
       #skuName#,
       #categoryId#,
       #categoryName#,
       #safeQuantityMax#,
       #safeQuantityMin#,
       #quantity#,
       #onWayNum#,
       #planNotSend#,
       #notPlan#,
       #needPlan#,
       #needOrder#,
       #coefficient#,
       #flag#,
       #userId#,
       #userName#,
       sysdate)
     ]]>
	</insert>

	<select id="searchStockStateManagerCount" parameterClass="stockReport" resultClass="java.lang.Integer">
		<![CDATA[
		select count(*)
			   from crm.crm_tb_stock_manager_temp mt
               left join crm.crm_tb_kunnr k on k.kunnr = mt.kunnr
	           left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
               where 1=1
         ]]>
         <dynamic>
         <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<!-- 
	    <isNotEmpty property="flag" prepend="and">
			<![CDATA[ mt.flag =#flag#]]>
		</isNotEmpty>
		 -->
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ mt.kunnr = #kunnr#]]>
		</isNotEmpty>
		<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ mt.skuId = #skuId#]]>
		</isNotEmpty>
		<isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ mt.categoryId = #categoryId#]]>
		</isNotEmpty>
	    </dynamic>
	    <![CDATA[order by ot.rc_org_name,ot.p_org_name,ot.org_name, mt.kunnrName]]>
	
	</select>
	
	<select id="searchStockStateManagerList" parameterClass="stockReport"
		resultClass="stockReport">
		<include refid="global.paginationStart" />
		<![CDATA[
		select ot.rc_org_name as orgRegion,
		       ot.rc_org_id as orgRegionId,
               ot.p_org_name as orgProvince,
               ot.p_org_id as orgProvinceId,
               ot.org_name as orgCity,
               ot.org_id as orgCityId,
       mt.kunnr,
       mt.kunnrName,
       mt.skuId,
       mt.skuName,
       mt.categoryId,
       mt.categoryName,
       mt.safeQuantityMax,
       mt.safeQuantityMin,
       mt.quantity,
       mt.onWayNum,
       mt.planNotSend,
       mt.notPlan,
       mt.needPlan,
       mt.needOrder,
       mt.coefficient,
       mt.flag,
       mt.userId,
       mt.userName,
       mt.createDate
       from crm.crm_tb_stock_manager_temp mt
       left join crm.crm_tb_kunnr k on k.kunnr = mt.kunnr
	   left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
         where 1=1
         ]]>
         <dynamic>
         <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<!-- 
	    <isNotEmpty property="flag" prepend="and">
			<![CDATA[ mt.flag =#flag#]]>
		</isNotEmpty>
		 -->
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ mt.kunnr = #kunnr#]]>
		</isNotEmpty>
		<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ mt.skuId = #skuId#]]>
		</isNotEmpty>
		<isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ mt.categoryId = #categoryId#]]>
		</isNotEmpty>
	    </dynamic>
			<![CDATA[order by ot.rc_org_name,ot.p_org_name,ot.org_name, mt.kunnr]]>
		<include refid="global.paginationEnd" />
	</select>
	<select id="searchStockStateManagerTotal" parameterClass="stockReport"
		resultClass="stockReport">
		<![CDATA[
		select sum(s.safeQuantityMax) as safeQuantityMax,
         sum(s.safeQuantityMin) as safeQuantityMin,
         sum(s.quantity) as quantity,
         sum(s.onWayNum) as onWayNum,
         sum(s.planNotSend) as planNotSend,
         sum(s.notPlan)as notPlan,
         sum(s.needPlan) as needPlan,
         sum(s.needOrder) as needOrder
         from
         (select mt.kunnr ,
          mt.safeQuantityMax*nvl(mt.coefficient,1) safeQuantityMax,
          mt.safeQuantityMin*nvl(mt.coefficient,1) safeQuantityMin,
          mt.quantity*nvl(mt.coefficient,1) quantity,
          mt.onWayNum*nvl(mt.coefficient,1) onWayNum,
          mt.planNotSend*nvl(mt.coefficient,1) planNotSend,
          mt.notPlan*nvl(mt.coefficient,1) notPlan,
          mt.needPlan*nvl(mt.coefficient,1) needPlan,
          mt.needOrder*nvl(mt.coefficient,1) needOrder
          from crm.crm_tb_stock_manager_temp mt
          left join crm.crm_tb_kunnr k on k.kunnr = mt.kunnr
	      left join basis.basis_tb_org_temp ot on ot.org_id = k.org_id
	      where 1=1
         ]]>
         <dynamic>
         <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ k.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<!-- 
	    <isNotEmpty property="flag" prepend="and">
			<![CDATA[ mt.flag =#flag#]]>
		</isNotEmpty>
		 -->
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ mt.kunnr = #kunnr#]]>
		</isNotEmpty>
		<isNotEmpty property="skuId" prepend="and">
			<![CDATA[ mt.skuId = #skuId#]]>
		</isNotEmpty>
		<isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ mt.categoryId = #categoryId#]]>
		</isNotEmpty>
		<![CDATA[ ) s ]]>
	    </dynamic>
	</select>
	<select id="searchBusinessManager" parameterClass="stockReport"
		resultClass="stockReport">
		<![CDATA[
		  select kb.kunnr as kunnr,
          kb.business_manager as businessManager,
          kb.manager_mobile as managerMobile
          from crm.crm_tb_kunnrbusiness kb 
          where 1=1
         ]]>
         <dynamic>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ kb.kunnr = #kunnr#]]>
		</isNotEmpty>
	    </dynamic>
	</select>
	<select id="searchProvinceManager" parameterClass="stockReport"
		resultClass="stockReport">
		<![CDATA[
		  select 
          k.kunnr as kunnr,
          e.emp_id as userId,
          e.org_id as orgId,
          e.emp_name as provinceManager,
          nvl(e.bus_mobilephone,e.emp_mobile_phone) as provinceMobile
          from crm.crm_tb_kunnr k
          left join basis.basis_tb_station_user su on su.org_id=k.org_id
          left join basis.basis_tb_salesemp_info e on e.emp_id=su.user_id
          where su.station_id='h_sjjl'and e.emp_state in ('Y','S')
         ]]>
         <dynamic>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ k.kunnr = #kunnr#]]>
		</isNotEmpty>
	    </dynamic>
	</select>
	
	<insert id="createSalesPlanChangeDetail" parameterClass="skuDistribution">
	<![CDATA[
	    insert into crm.crm_tb_sku_distribution_detail
	    (detail_id,
	     kunnr,
	     sku_id,
	     year,
	     month,
	     user_id,
	     detail_id_to,
	     quantity,
	     create_date,
	     flag,
	     event_id)
	     values
	    (#detailId#,
	     #kunnr#,
	     #skuId#,
	     #year#,
	     #month#,
	     #userId#,
	     #detailIdTo#,
	     #quantity#,
	     sysdate,
	     'T',
	     #eventId#)
	]]>
	</insert>
	
	<update id="updateSalesPlanChangeDetail" parameterClass="skuDistribution">
	<![CDATA[
	    update crm.crm_tb_sku_distribution_detail d set d.create_date=sysdate
	]]>
	    <dynamic>
		  <isNotEmpty property="quantity" prepend=",">
			<![CDATA[ d.quantity = #quantity#]]>
		  </isNotEmpty>
		  <isNotEmpty property="flag" prepend=",">
			<![CDATA[ d.flag = #flag#]]>
		  </isNotEmpty>
	    </dynamic>
	<![CDATA[
	    where 1=1
	]]>
	    <dynamic>
		  <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ d.kunnr = #kunnr#]]>
		  </isNotEmpty>
		  <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ d.sku_id = #skuId#]]>
		  </isNotEmpty>
		  <isNotEmpty property="year" prepend="and">
			<![CDATA[ d.year = #year#]]>
		  </isNotEmpty>
		  <isNotEmpty property="month" prepend="and">
			<![CDATA[ d.month = #month#]]>
		  </isNotEmpty>
		  <isNotEmpty property="detailId" prepend="and">
			<![CDATA[ d.detail_id = #detailId#]]>
		  </isNotEmpty>
		  <isNotEmpty property="eventId" prepend="and">
			<![CDATA[ d.event_id = #eventId#]]>
		  </isNotEmpty>
	    </dynamic>
	</update>
	
	<select id="searchSalesPlanChangeDetailCount" parameterClass="skuDistribution" resultClass="java.lang.Integer">
	<![CDATA[
	    select count(*)
	           from (select dd.detail_id,dd.kunnr,kk.org_id,kk.name1,oo.org_name,dd.sku_id,dd.year,dd.month,
	                        dd.user_id,dd.detail_id_to,dd.quantity,dd.create_date,dd.flag,dd.event_id 
	                 from crm.crm_tb_sku_distribution_detail dd
	                 left join crm.crm_tb_kunnr kk on kk.kunnr=dd.kunnr
	                 left join basis.basis_tb_org oo on oo.org_id=kk.org_id
	                 where dd.detail_id_to is not null) d
	           left join (select ddd.detail_id,ddd.kunnr,kk.org_id,kk.name1,oo.org_name,ddd.year,ddd.month,ddd.quantity
	                 from crm.crm_tb_sku_distribution_detail ddd 
	                 left join crm.crm_tb_kunnr kk on kk.kunnr=ddd.kunnr
	                 left join basis.basis_tb_org oo on oo.org_id=kk.org_id
	                 where ddd.detail_id_to is null) d1 on d.detail_id_to=d1.detail_id
	           left join basis.basis_tb_salesemp_info i on i.emp_id=d.user_id
	           left join basis.basis_tb_org o on o.org_id=i.org_id
	           left join crm.crm_tb_sku s on d.sku_id=s.sku_id
	           where 1=1 
	]]>
	    <dynamic>
		  <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ (d.kunnr = #kunnr# or d1.kunnr = #kunnr#)]]>
		  </isNotEmpty>
		  <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ d.sku_id = #skuId#]]>
		  </isNotEmpty>
		  <isNotEmpty property="year" prepend="and">
			<![CDATA[ d.year = #year#]]>
		  </isNotEmpty>
		  <isNotEmpty property="month" prepend="and">
			<![CDATA[ d.month = #month#]]>
		  </isNotEmpty>
		  <isNotEmpty property="detailId" prepend="and">
			<![CDATA[ d.detail_id = #detailId#]]>
		  </isNotEmpty>
		  <isNotEmpty property="eventId" prepend="and">
			<![CDATA[ d.event_id = #eventId#]]>
		  </isNotEmpty>
		  <isNotEmpty property="flag" prepend="and">
			<![CDATA[ d.flag = #flag#]]>
		  </isNotEmpty>
		  <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ (d.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)
				       or
				       d1.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id))]]>
		  </isNotEmpty>
		  <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when d.month>=10 
			                then to_char(to_date(d.year||d.month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(d.year||0||d.month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate# ]]>
		  </isNotEmpty>
		  <isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when d.month>=10 
			                then to_char(to_date(d.year||d.month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(d.year||0||d.month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
		  </isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="searchSalesPlanChangeDetail" parameterClass="skuDistribution" resultClass="skuDistribution">
		<include refid="global.paginationStart" />
	<![CDATA[
	    select d.detail_id_to detailId,
	           d.kunnr kunnrTo,
	           d.name1 kunnrNameTo,
	           d.org_name orgNameTo,
	           d.sku_id skuId,
	           d.year yearTo,
	           d.month monthTo,
	           d.user_id userId,
	           d.detail_id detailIdTo,
	           d.create_date createDate,
	           d.flag flag,
	           d.event_id,
	           d1.quantity quantity,
	           d1.kunnr kunnr,
	           d1.name1 kunnrName,
	           d1.org_name orgName,
	           d1.year year,
	           d1.month month,
	           i.emp_name userName,
	           o.org_name orgNameUser,
	           s.sku_name skuName,
	           d.event_id eventId
	           from (select dd.detail_id,dd.kunnr,kk.name1,kk.org_id,oo.org_name,dd.sku_id,dd.year,dd.month,
	                        dd.user_id,dd.detail_id_to,dd.quantity,dd.create_date,dd.flag,dd.event_id 
	                 from crm.crm_tb_sku_distribution_detail dd
	                 left join crm.crm_tb_kunnr kk on kk.kunnr=dd.kunnr
	                 left join basis.basis_tb_org oo on oo.org_id=kk.org_id
	                 where dd.detail_id_to is not null) d
	           left join (select ddd.detail_id,ddd.kunnr,kk.name1,kk.org_id,oo.org_name,ddd.year,ddd.month,ddd.quantity
	                 from crm.crm_tb_sku_distribution_detail ddd 
	                 left join crm.crm_tb_kunnr kk on kk.kunnr=ddd.kunnr
	                 left join basis.basis_tb_org oo on oo.org_id=kk.org_id
	                 where ddd.detail_id_to is null) d1 on d.detail_id_to=d1.detail_id
	           left join basis.basis_tb_salesemp_info i on i.emp_id=d.user_id
	           left join basis.basis_tb_org o on o.org_id=i.org_id
	           left join crm.crm_tb_sku s on d.sku_id=s.sku_id
	           where 1=1 
	]]>
	    <dynamic>
		  <isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ (d.kunnr = #kunnr# or d1.kunnr = #kunnr#)]]>
		  </isNotEmpty>
		  <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ d.sku_id = #skuId#]]>
		  </isNotEmpty>
		  <isNotEmpty property="year" prepend="and">
			<![CDATA[ d.year = #year#]]>
		  </isNotEmpty>
		  <isNotEmpty property="month" prepend="and">
			<![CDATA[ d.month = #month#]]>
		  </isNotEmpty>
		  <isNotEmpty property="detailId" prepend="and">
			<![CDATA[ d.detail_id = #detailId#]]>
		  </isNotEmpty>
		  <isNotEmpty property="eventId" prepend="and">
			<![CDATA[ d.event_id = #eventId#]]>
		  </isNotEmpty>
		  <isNotEmpty property="flag" prepend="and">
			<![CDATA[ d.flag = #flag#]]>
		  </isNotEmpty>
		  <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ (d.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)
				       or
				       d1.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id))]]>
		  </isNotEmpty>
		  <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ (case when d.month>=10 
			                then to_char(to_date(d.year||d.month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(d.year||0||d.month,'yyyyMM'),'yyyy-MM') 
			                end) >= #startDate#]]>
		  </isNotEmpty>
		  <isNotEmpty property="endDate" prepend="and">
			<![CDATA[ (case when d.month>=10 
			                then to_char(to_date(d.year||d.month,'yyyyMM'),'yyyy-MM') 
			                else to_char(to_date(d.year||0||d.month,'yyyyMM'),'yyyy-MM') 
			                end) <= #endDate# ]]>
		  </isNotEmpty>
	    </dynamic>
	    <![CDATA[ order by d.event_id,d.kunnr]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<select id="getSkuDistributionDetailId" resultClass="java.lang.Long">
	<![CDATA[select crm.crm_seq_sku_distribution.nextval from dual]]>
	</select>
	
	<select id="getEmpListByOrgId" parameterClass="java.lang.Long" 
		resultClass="user">
	<![CDATA[
		select distinct a.emp_id       as userId,
						   a.emp_name     as userName,
						   a.org_id       as orgId,
						   c.station_name as posName
		  from basis.basis_tb_salesemp_info a
		  left join basis.basis_tb_station_user b on a.emp_id = b.user_id
		  left join basis.basis_tb_stations c on b.station_id = c.station_id
		 where a.emp_state='Y' and a.org_id = #org_id#
	]]>
	</select>
	
	<select id="getEmpListByUserName" parameterClass="sta" 
		resultClass="sta">
	<![CDATA[
		   select distinct a.emp_id       userId,
				 a.emp_name     as userName,
				 a.org_id       as orgId,
				 c.station_name as posName
			 from basis.basis_tb_salesemp_info a
			  left join basis.basis_tb_station_user b on a.emp_id = b.user_id
			 left join basis.basis_tb_stations c on b.station_id = c.station_id  
			  where  a.emp_state in ('S','Y') and a.emp_name like #userName,handler=wildcard# escape '\' 
	]]>
	</select>
	
	<select id="getWorkFlowStation" parameterClass="java.lang.Long" resultClass="user">
	    select r.role_id roleIds,
	           i.emp_name userName,
	           o.org_name orgName
	           from workflow.workflow_tb_event_detail d
	           left join workflow.workflow_tb_event_total t on t.event_id=d.event_id
	           left join basis.basis_tb_station_user u on u.user_id=d.cur_user_id
	           left join basis.basis_tb_station_role r on r.station_id=u.station_id
	           left join basis.basis_tb_salesemp_info i on i.emp_id=t.initator
	           left join basis.basis_tb_org o on o.org_id=i.org_id
	           where d. event_dtl_id =
	           (select max(dd.event_dtl_id) from workflow.workflow_tb_event_detail dd where dd.event_id=#eventId#)
	</select>
	
	<select id="getOrgCityByOrgId" parameterClass="java.lang.Long" resultClass="java.lang.Integer">
	<![CDATA[
	    select t.org_level
	    from basis.basis_tb_org t 
	    where t.state='Y' and t.org_id=#orgId#
	]]>
	</select>
	
	<select id="searchCustomerStockListCount" parameterClass="stockReport"
		resultClass="java.lang.Integer">
		<![CDATA[
		select count(*)
		       from crm.crm_tb_customer_stock s
		       left join crm.crm_tb_cg cg on cg.sku_category_id = s.sku_category_id
		       left join crm.crm_tb_sku sku on sku.sku_id = s.sku_id
		       left join basis.basis_tb_salesemp_info si on si.emp_id = s.user_id
		       left join crm.crm_tb_customer c on c.cust_id = s.cust_id
		       left join crm.crm_tb_kunnr k on k.kunnr = c.cust_kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = c.org_id
		       left join crm.crm_tb_channel cl on cl.channel_id=c.channel_id
		       where s.status ='U'
		       ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ c.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ c.cust_kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ s.sku_category_id = #categoryId#]]>
		</isNotEmpty>
	    <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ s.create_date >= to_date(#startDate#,'yyyy-mm-dd')]]>
		</isNotEmpty>
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date <=to_date(#endDate#,'yyyy-mm-dd')+1]]>
		</isNotEmpty>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userName" prepend="and">
			<![CDATA[ si.emp_name like #userName,handler=wildcard# escape '\']]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		<isNotEmpty property="custId" prepend="and">
			<![CDATA[ s.cust_id = #custId#]]>
		</isNotEmpty>
		<isNotEmpty property="channelId" prepend="and">
			<![CDATA[ c.channel_id = #channelId#]]>
		</isNotEmpty>
		<isNotEmpty property="kunnrs" prepend="and">
			<![CDATA[ s.kunnr in ]]>
			<iterate property="kunnrs" open="(" close=")" conjunction=",">#kunnrs[]#
		    </iterate>
		</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="searchCustomerStockList" parameterClass="stockReport"
		resultClass="stockReport">
		<include refid="global.paginationStart" />
		<![CDATA[
		select s.id as stockId,
		       s.cust_id as custId,
		       c.cust_kunnr as kunnr,
		       c.cust_name as custName,
		       c.cust_state as custState,
		       cl.channel_name as channelName,
		       k.name1 as kunnrName,
		       s.sku_id as skuId,
		       sku.sku_name as skuName,
		       s.user_id as userId,
		       si.emp_name as userName,
		       s.create_date as createDate,
		       s.production_date as productionDate,
		       s.check_time as checkTime,
		       s.sku_category_id as categoryId, 
		       cg.category_name as categoryName,
		       s.quantity as quantity,
		       s.unitdesc as unitDesc,
		       s.flag as flag,
		       ot.p_org_name as orgProvince,
		       ot.org_name as orgCity,
		       ot.rc_org_name as orgRegion
		       from crm.crm_tb_customer_stock s
		       left join crm.crm_tb_cg cg on cg.sku_category_id = s.sku_category_id
		       left join crm.crm_tb_sku sku on sku.sku_id = s.sku_id
		       left join basis.basis_tb_salesemp_info si on si.emp_id = s.user_id
		       left join crm.crm_tb_customer c on c.cust_id = s.cust_id
		       left join crm.crm_tb_kunnr k on k.kunnr = c.cust_kunnr
		       left join basis.basis_tb_org_temp ot on ot.org_id = c.org_id
		       left join crm.crm_tb_channel cl on cl.channel_id=c.channel_id
		       where s.status ='U'
		       ]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ c.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ c.cust_kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ s.sku_category_id = #categoryId#]]>
		</isNotEmpty>
	    <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ s.create_date >= to_date(#startDate#,'yyyy-mm-dd')]]>
		</isNotEmpty>
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date <=to_date(#endDate#,'yyyy-mm-dd')+1]]>
		</isNotEmpty>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userName" prepend="and">
			<![CDATA[ si.emp_name like #userName,handler=wildcard# escape '\']]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		<isNotEmpty property="custId" prepend="and">
			<![CDATA[ s.cust_id = #custId#]]>
		</isNotEmpty>
		<isNotEmpty property="channelId" prepend="and">
			<![CDATA[ c.channel_id = #channelId#]]>
		</isNotEmpty>
		<isNotEmpty property="kunnrs" prepend="and">
			<![CDATA[ s.kunnr in ]]>
			<iterate property="kunnrs" open="(" close=")" conjunction=",">#kunnrs[]#
		    </iterate>
		</isNotEmpty>
	    </dynamic>
			<![CDATA[order by s.create_date,s.cust_id,s.id]]>
		<include refid="global.paginationEnd" />
	</select>
	
	<insert id="createCustomerStock" parameterClass="stockReport">
		<selectKey resultClass="java.lang.Integer" keyProperty="stockId">
		<![CDATA[
			select crm.crm_seq_customer_stock.nextval as stockId from dual
		]]>
		</selectKey>
	<![CDATA[
	insert into crm.crm_tb_customer_stock
      (id,
       cust_id,
       sku_id,
       sku_category_id,
       production_date,
       check_time,
       unitdesc,
       quantity,
       flag,
       status,
       create_date,
       user_id,
       user_type)
    values
      (#stockId#,
       #custId#,
       #skuId#,
       #categoryId#,
       #productionDate#,
       #checkTime#,
       #unitDesc#,
       #quantity#,
       #flag#,
       'U',
       sysdate,
       #userId#,
       #userType#)
	]]>
	</insert>
	
	<insert id="createOrUpdateCustomerStock" parameterClass="stockReport">
		<selectKey resultClass="java.lang.Integer" keyProperty="stockId">
		<![CDATA[
			select crm.crm_seq_customer_stock.nextval as stockId from dual
		]]>
		</selectKey>
	<![CDATA[
	    merge into crm.crm_tb_customer_stock s1
	    using (select #stockId# as id,
	                  #custId# as cust_id,
	                  #skuId# as sku_id,
	                  #checkTime# as check_time,
	                  #quantity# as quantity,
		              #categoryId# as sku_category_id,
		              #productionDate# as production_date,
		              #unitDesc# as unitdesc,
		              #flag# as flag,
		              'U' as status,
		              sysdate as create_date,
		              #userId# as user_id,
		              #userType# as user_type
	                  from dual) s2
	    on (s1.cust_id = s2.cust_id and s1.sku_id=s2.sku_id and s1.check_time=s2.check_time and s1.status=s2.status)
	    when matched then
	    update set s1.quantity=s2.quantity
	    when not matched then
		insert
		  values
		  (s2.id,
		   s2.cust_id,
		   s2.sku_id,
		   s2.sku_category_id,
		   s2.production_date,
		   s2.check_time,
		   s2.unitdesc,
		   s2.quantity,
		   s2.flag,
		   s2.status,
		   s2.create_date,
		   s2.user_id,
		   s2.user_type)
	]]>
	</insert>
	
	<update id="updateCustomerStock" parameterClass="stockReport">
	    <![CDATA[ update crm.crm_tb_customer_stock s ]]>
	    <dynamic prepend="set">
	    <isNotEmpty property="quantity" prepend=",">
			<![CDATA[ s.quantity=#quantity#]]>
		</isNotEmpty>
		<isNotEmpty property="status" prepend=",">
			<![CDATA[ s.status=#status#]]>
		</isNotEmpty>
		</dynamic>
	    <![CDATA[ where s.id=#stockId# ]]>
	</update>
	
	<insert id="createSkuUnitSap" parameterClass="skuUnit">
	    <![CDATA[
	      insert into crm.crm_tb_sku_unit_sap(
                 sku_sap_code,
                 MEINH,
                 MEINS,
                 UMREZ,
                 UMREN,
                 create_date
                 )
                 values(
                 #matterNum#,
                 #MEINH#,
                 #MEINS#,
                 #UMREZ#,
                 #UMREN#,
                 sysdate
                 )
	    ]]> 
	</insert>
	
	<delete id="deleteSkuUnitSap">
	    <![CDATA[ delete crm.crm_tb_sku_unit_sap]]>
	</delete>
	
	<select id="searchSkuUnitListCount" parameterClass="skuUnit" resultClass="java.lang.Integer">
	    <![CDATA[
	        select count(*)
	        from crm.crm_tb_sku s 
            left join crm.crm_tb_cg c on c.sku_category_id=s.sku_category_id
            left join crm.crm_tb_sku_unit u on u.sku_id=s.sku_id
            where s.sku_company='1' and s.product_type='1' and s.status='U'
	    ]]>
	    <dynamic>
	       <isNotEmpty property="skuId" prepend="and">
	          <![CDATA[ u.sku_id = #skuId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="skuName" prepend="and">
	          <![CDATA[ s.sku_name like #skuName,handler=wildcard# escape '\']]>
	       </isNotEmpty>
	       <isNotEmpty property="cgId" prepend="and">
	          <![CDATA[ c.sku_category_id = #cgId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="categoryName" prepend="and">
	          <![CDATA[ c.category_name like #categoryName,handler=wildcard# escape '\']]>
	       </isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="searchSkuUnitList" parameterClass="skuUnit" resultClass="skuUnit">
	<include refid="global.paginationStart" />
	    <![CDATA[
	        select s.sku_id as skuId,
	               s.sku_name as skuName,
	               c.sku_category_id as cgId,
	               c.category_name as categoryName,
	               s.sku_sap_code as matterNum,
	               u.sku_unit as skuUnit,
	               u.sku_unit_coefficient as unitCoefficient,
	               s.sku_code as skuCode
	        from crm.crm_tb_sku s 
            left join crm.crm_tb_cg c on c.sku_category_id=s.sku_category_id
            left join crm.crm_tb_sku_unit u on u.sku_id=s.sku_id
            where s.sku_company='1' and s.product_type='1' and s.status='U'
	    ]]>
	    <dynamic>
	       <isNotEmpty property="skuId" prepend="and">
	          <![CDATA[ s.sku_id = #skuId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="skuName" prepend="and">
	          <![CDATA[ s.sku_name like #skuName,handler=wildcard# escape '\']]>
	       </isNotEmpty>
	       <isNotEmpty property="cgId" prepend="and">
	          <![CDATA[ c.sku_category_id = #cgId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="categoryName" prepend="and">
	          <![CDATA[ c.category_name like #categoryName,handler=wildcard# escape '\']]>
	       </isNotEmpty>
	    </dynamic>
	    <![CDATA[ order by s.sku_id ]]>
	    <include refid="global.paginationEnd" />
	</select>
	
	<select id="searchSkuUnitSap" parameterClass="skuUnit" resultClass="skuUnit">
	    <![CDATA[
	        select s.sku_id as skuId,
	               s.sku_name as skuName,
	               s.sku_sap_code as matterNum,
	               u.MEINH,
                   u.MEINS,
                   round(u.UMREZ/u.UMREN,2) as unitCoefficient
	        from crm.crm_tb_sku s
            left join crm.crm_tb_sku_unit_sap u on u.sku_sap_code=s.sku_sap_code
            where s.sku_company='1' and s.product_type='1' and s.status='U'
	    ]]>
	    <dynamic>
	       <isNotEmpty property="skuId" prepend="and">
	          <![CDATA[ s.sku_id = #skuId# ]]>
	       </isNotEmpty>
	       <isNotEmpty property="skuUnit" prepend="and">
	          <![CDATA[ u.MEINH = #skuUnit#]]>
	       </isNotEmpty>
	    </dynamic>
	</select>
	
	<insert id="createSkuUnit" parameterClass="skuUnit">
	    <![CDATA[
	        insert into crm.crm_tb_sku_unit
	        (sku_id,
	         sku_unit,
	         sku_unit_coefficient,
	         create_date)
	         values
	        (#skuId#,
	         #skuUnit#,
	         #unitCoefficient#,
	         sysdate)
	    ]]>
	</insert>
	
	<update id="updateSkuUnit" parameterClass="skuUnit">
	    <![CDATA[ update crm.crm_tb_sku_unit s ]]>
	    <dynamic prepend="set">
	    <isNotEmpty property="skuUnit" prepend=",">
			<![CDATA[ s.sku_unit=#skuUnit#]]>
		</isNotEmpty>
		<isNotEmpty property="unitCoefficient" prepend=",">
			<![CDATA[ s.sku_unit_coefficient=#unitCoefficient#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend=",">
			<![CDATA[ s.flag=#flag#]]>
		</isNotEmpty>
		</dynamic>
	    <![CDATA[ where s.sku_id=#skuId# ]]>
	</update>
	
	<select id="searchCustomerStockByDateListCount" parameterClass="stockReport" resultClass="java.lang.Integer">
	    <![CDATA[
	    select count(*) from (
	        select
		       s.cust_id as custId,
		       s.sku_id as skuId,
		       s.unitdesc as unitDesc
	        from crm.crm_tb_customer_stock s
		    left join crm.crm_tb_sku sku on sku.sku_id = s.sku_id
		    left join crm.crm_tb_customer c on c.cust_id = s.cust_id
		    left join crm.crm_tb_kunnr k on k.kunnr = c.cust_kunnr
		    left join basis.basis_tb_org_temp ot on ot.org_id = c.org_id
		    left join crm.crm_tb_channel cl on cl.channel_id=c.channel_id
		    left join crm.crm_tb_dict d on d.item_id = c.cust_system
		    where s.status ='U'
		]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ c.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ c.cust_kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ s.sku_category_id = #categoryId#]]>
		</isNotEmpty>
	    <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ s.create_date >= to_date(#startDate#,'yyyy-mm-dd')]]>
		</isNotEmpty>
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date <=to_date(#endDate#,'yyyy-mm-dd')+1]]>
		</isNotEmpty>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		<isNotEmpty property="custId" prepend="and">
			<![CDATA[ s.cust_id = #custId#]]>
		</isNotEmpty>
		<isNotEmpty property="channelId" prepend="and">
			<![CDATA[ c.channel_id = #channelId#]]>
		</isNotEmpty>
	    </dynamic>
		<![CDATA[   group by s.cust_id,s.sku_id,s.unitdesc)
	    ]]>
	</select>
	
	<select id="searchCustomerStockByDateList" parameterClass="stockReport" resultClass="stockReport">
	<include refid="global.paginationStart" />
	    <![CDATA[
	        select
		       s.cust_id as custId,
		       s.sku_id as skuId,
		       s.unitdesc as unitDesc,
		       max(c.cust_kunnr) as kunnr,
		       max(c.cust_name) as custName,
		       max(c.cust_state) as custState,
		       max(cl.channel_name) as channelName,
		       max(k.name1) as kunnrName,
		       max(sku.sku_name) as skuName,
		       max(ot.p_org_name) as orgProvince,
		       max(ot.org_name) as orgCity,
		       max(ot.rc_org_name) as orgRegion,
		       max(d.item_name) as custSystem,
		       max(c.cust_address) as custAddress,
		       sum(s.quantity) as daySum,
	        sum(decode(substr(s.check_time,9,10),'01',s.quantity,'')) as day1,
            sum(decode(substr(s.check_time,9,10),'02',s.quantity,'')) as day2,
            sum(decode(substr(s.check_time,9,10),'03',s.quantity,'')) as day3,
            sum(decode(substr(s.check_time,9,10),'04',s.quantity,'')) as day4,
            sum(decode(substr(s.check_time,9,10),'05',s.quantity,'')) as day5,
            sum(decode(substr(s.check_time,9,10),'06',s.quantity,'')) as day6,
            sum(decode(substr(s.check_time,9,10),'07',s.quantity,'')) as day7,
            sum(decode(substr(s.check_time,9,10),'08',s.quantity,'')) as day8,
            sum(decode(substr(s.check_time,9,10),'09',s.quantity,'')) as day9,
            sum(decode(substr(s.check_time,9,10),'10',s.quantity,'')) as day10,
            sum(decode(substr(s.check_time,9,10),'11',s.quantity,'')) as day11,
            sum(decode(substr(s.check_time,9,10),'12',s.quantity,'')) as day12,
            sum(decode(substr(s.check_time,9,10),'13',s.quantity,'')) as day13,
            sum(decode(substr(s.check_time,9,10),'14',s.quantity,'')) as day14,
            sum(decode(substr(s.check_time,9,10),'15',s.quantity,'')) as day15,
            sum(decode(substr(s.check_time,9,10),'16',s.quantity,'')) as day16,
            sum(decode(substr(s.check_time,9,10),'17',s.quantity,'')) as day17,
            sum(decode(substr(s.check_time,9,10),'18',s.quantity,'')) as day18,
            sum(decode(substr(s.check_time,9,10),'19',s.quantity,'')) as day19,
            sum(decode(substr(s.check_time,9,10),'20',s.quantity,'')) as day20,
            sum(decode(substr(s.check_time,9,10),'21',s.quantity,'')) as day21,
            sum(decode(substr(s.check_time,9,10),'22',s.quantity,'')) as day22,
            sum(decode(substr(s.check_time,9,10),'23',s.quantity,'')) as day23,
            sum(decode(substr(s.check_time,9,10),'24',s.quantity,'')) as day24,
            sum(decode(substr(s.check_time,9,10),'25',s.quantity,'')) as day25,
            sum(decode(substr(s.check_time,9,10),'26',s.quantity,'')) as day26,
            sum(decode(substr(s.check_time,9,10),'27',s.quantity,'')) as day27,
            sum(decode(substr(s.check_time,9,10),'28',s.quantity,'')) as day28,
            sum(decode(substr(s.check_time,9,10),'29',s.quantity,'')) as day29,
            sum(decode(substr(s.check_time,9,10),'30',s.quantity,'')) as day30,
            sum(decode(substr(s.check_time,9,10),'31',s.quantity,'')) as day31
	        from crm.crm_tb_customer_stock s
		    left join crm.crm_tb_sku sku on sku.sku_id = s.sku_id
		    left join crm.crm_tb_customer c on c.cust_id = s.cust_id
		    left join crm.crm_tb_kunnr k on k.kunnr = c.cust_kunnr
		    left join basis.basis_tb_org_temp ot on ot.org_id = c.org_id
		    left join crm.crm_tb_channel cl on cl.channel_id=c.channel_id
		    left join crm.crm_tb_dict d on d.item_id = c.cust_system
		    where s.status ='U'
		]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ c.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ c.cust_kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ s.sku_category_id = #categoryId#]]>
		</isNotEmpty>
	    <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ s.create_date >= to_date(#startDate#,'yyyy-mm-dd')]]>
		</isNotEmpty>
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date <=to_date(#endDate#,'yyyy-mm-dd')+1]]>
		</isNotEmpty>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		<isNotEmpty property="custId" prepend="and">
			<![CDATA[ s.cust_id = #custId#]]>
		</isNotEmpty>
		<isNotEmpty property="channelId" prepend="and">
			<![CDATA[ c.channel_id = #channelId#]]>
		</isNotEmpty>
	    </dynamic>
		<![CDATA[   group by s.cust_id,s.sku_id,s.unitdesc
		            order by s.cust_id,s.sku_id,s.unitdesc
	    ]]>
	    <include refid="global.paginationEnd" />
	</select>
	
	<select id="searchCustomerStockByDateDescList" parameterClass="stockReport" resultClass="stockReport">
	<include refid="global.paginationStart" />
	    <![CDATA[
	        select
		       s.cust_id as custId,
		       s.sku_id as skuId,
		       max(u2.MEINH) as unitDesc,
		       max(c.cust_kunnr) as kunnr,
		       max(c.cust_name) as custName,
		       max(c.cust_state) as custState,
		       max(cl.channel_name) as channelName,
		       max(k.name1) as kunnrName,
		       max(sku.sku_name) as skuName,
		       max(ot.p_org_name) as orgProvince,
		       max(ot.org_name) as orgCity,
		       max(ot.rc_org_name) as orgRegion,
		       max(d.item_name) as custSystem,
		       max(c.cust_address) as custAddress,
		       to_char(sum(s.quantity * (u1.num/u2.num)),'fm9999999990.00') as daySum,
	        to_char(sum(decode(substr(s.check_time,9,10),'01',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day1,
            to_char(sum(decode(substr(s.check_time,9,10),'02',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day2,
            to_char(sum(decode(substr(s.check_time,9,10),'03',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day3,
            to_char(sum(decode(substr(s.check_time,9,10),'04',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day4,
            to_char(sum(decode(substr(s.check_time,9,10),'05',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day5,
            to_char(sum(decode(substr(s.check_time,9,10),'06',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day6,
            to_char(sum(decode(substr(s.check_time,9,10),'07',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day7,
            to_char(sum(decode(substr(s.check_time,9,10),'08',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day8,
            to_char(sum(decode(substr(s.check_time,9,10),'09',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day9,
            to_char(sum(decode(substr(s.check_time,9,10),'10',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day10,
            to_char(sum(decode(substr(s.check_time,9,10),'11',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day11,
            to_char(sum(decode(substr(s.check_time,9,10),'12',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day12,
            to_char(sum(decode(substr(s.check_time,9,10),'13',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day13,
            to_char(sum(decode(substr(s.check_time,9,10),'14',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day14,
            to_char(sum(decode(substr(s.check_time,9,10),'15',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day15,
            to_char(sum(decode(substr(s.check_time,9,10),'16',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day16,
            to_char(sum(decode(substr(s.check_time,9,10),'17',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day17,
            to_char(sum(decode(substr(s.check_time,9,10),'18',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day18,
            to_char(sum(decode(substr(s.check_time,9,10),'19',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day19,
            to_char(sum(decode(substr(s.check_time,9,10),'20',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day20,
            to_char(sum(decode(substr(s.check_time,9,10),'21',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day21,
            to_char(sum(decode(substr(s.check_time,9,10),'22',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day22,
            to_char(sum(decode(substr(s.check_time,9,10),'23',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day23,
            to_char(sum(decode(substr(s.check_time,9,10),'24',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day24,
            to_char(sum(decode(substr(s.check_time,9,10),'25',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day25,
            to_char(sum(decode(substr(s.check_time,9,10),'26',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day26,
            to_char(sum(decode(substr(s.check_time,9,10),'27',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day27,
            to_char(sum(decode(substr(s.check_time,9,10),'28',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day28,
            to_char(sum(decode(substr(s.check_time,9,10),'29',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day29,
            to_char(sum(decode(substr(s.check_time,9,10),'30',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day30,
            to_char(sum(decode(substr(s.check_time,9,10),'31',s.quantity * (u1.num/u2.num),'')),'fm9999999990.00') as day31
	        from crm.crm_tb_customer_stock s
		    left join crm.crm_tb_sku sku on sku.sku_id = s.sku_id
		    left join crm.crm_tb_customer c on c.cust_id = s.cust_id
		    left join crm.crm_tb_kunnr k on k.kunnr = c.cust_kunnr
		    left join basis.basis_tb_org_temp ot on ot.org_id = c.org_id
		    left join crm.crm_tb_channel cl on cl.channel_id=c.channel_id
		    left join crm.crm_tb_dict d on d.item_id = c.cust_system
		    left join (select u.sku_sap_code,u.MEINH,u.UMREZ/u.UMREN as num 
		                      from crm.crm_tb_sku_unit_sap u where u.MEINH<>'±êÏä') u1 
		                      on u1.sku_sap_code=sku.sku_sap_code and u1.MEINH=s.unitdesc
		    left join (select u.sku_sap_code,u.MEINH,u.UMREZ/u.UMREN as num 
		                      from crm.crm_tb_sku_unit_sap u where u.MEINH='±êÏä') u2 
		                      on u2.sku_sap_code=sku.sku_sap_code
		    where s.status ='U'
		]]>
		<dynamic>
	    <isNotEmpty property="orgId" prepend="and">
			<![CDATA[ c.org_id in (select b.org_id from basis.basis_tb_org b 
				         start with b.org_id = #orgId#
				         connect by prior b.org_id= b.org_parent_id)]]>
		</isNotEmpty>
		<isNotEmpty property="kunnr" prepend="and">
			<![CDATA[ c.cust_kunnr = #kunnr#]]>
		</isNotEmpty>
	    <isNotEmpty property="skuId" prepend="and">
			<![CDATA[ s.sku_id = #skuId#]]>
		</isNotEmpty>
	    <isNotEmpty property="categoryId" prepend="and">
			<![CDATA[ s.sku_category_id = #categoryId#]]>
		</isNotEmpty>
	    <isNotEmpty property="startDate" prepend="and">
			<![CDATA[ s.create_date >= to_date(#startDate#,'yyyy-mm-dd')]]>
		</isNotEmpty>
		<isNotEmpty property="endDate" prepend="and">
			<![CDATA[ s.create_date <=to_date(#endDate#,'yyyy-mm-dd')+1]]>
		</isNotEmpty>
		<isNotEmpty property="productionStartDate" prepend="and">
			<![CDATA[ s.check_time >= #productionStartDate#]]>
		</isNotEmpty>
		<isNotEmpty property="productionEndDate" prepend="and">
			<![CDATA[ s.check_time <= #productionEndDate#]]>
		</isNotEmpty>
		<isNotEmpty property="flag" prepend="and">
			<![CDATA[ s.flag = #flag#]]>
		</isNotEmpty>
		<isNotEmpty property="userType" prepend="and">
			<![CDATA[ s.user_type = #userType#]]>
		</isNotEmpty>
		<isNotEmpty property="custId" prepend="and">
			<![CDATA[ s.cust_id = #custId#]]>
		</isNotEmpty>
		<isNotEmpty property="channelId" prepend="and">
			<![CDATA[ c.channel_id = #channelId#]]>
		</isNotEmpty>
	    </dynamic>
		<![CDATA[   group by s.cust_id,s.sku_id
		            order by s.cust_id,s.sku_id
	    ]]>
	    <include refid="global.paginationEnd" />
	</select>
	
	<select id="getKunnrIdByKunag" parameterClass="java.lang.String" resultClass="java.lang.String">
	<![CDATA[
	select distinct t.kunnr
	    from (
	    select k.kunnr
	           from crm.crm_tb_kunnr_kunag k
	           where k.kunag=#kunnr#
	           
	    union all
	    
	    select k.kunnr
	           from crm.crm_tb_kunnr_kunag k
	           where k.kunnr=#kunnr#
	           ) t
	]]>
	</select>
	
	<select id="getSysdate" resultClass="java.util.Date">
	<![CDATA[
	    select sysdate from dual
	]]>
	</select>
	
	<select id="getKunnrImportant" parameterClass="java.lang.String" resultClass="java.lang.String">
	<![CDATA[
	    select b.is_important
	           from crm.crm_tb_kunnr k
	           left join crm.crm_tb_kunnrbusiness b on b.kunnr=k.kunnr
	           where k.kunnr=#kunnr#
	]]>
	</select>
</sqlMap>